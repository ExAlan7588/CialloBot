
;FileName_SHOP.ERB -------------------------------- Rev1.00
;RESULT_104(设定) 处理
;CALL		SYSTEM
;ARG		VOID
;RETURN		VOID
;COMMENT	
;----------------------------------------------------------
@SCHEDULE
PRINTFORML [0] - 起床时间设定（现在：%时刻表示(TIME:3)%）
PRINTFORML [1] - 私室设定（现在：%NAME_FROM_PLACE(CFLAG:MASTER:初始位置)%）
;SIF FLAG:住宿人物== 0
;	PRINTL [2] - 住宿
PRINTFORML [3] - 只睡四小时（现在：\@ FLAG:睡四小时 ? ON # OFF \@）
PRINTFORML [4] - 居家工作（现在：\@ FLAG:居家工作 ? ON # OFF \@）
PRINTFORML [5] - 改名
PRINTFORML [6] - 移动酒虫之瓶（现在：\@ !MAIN_MAP ? %STR:据点_酒虫% # %STR:(据点_酒虫 + 8000)% \@）
SIF ITEM:祭坛
	PRINTFORML [7] - 自动结缘（现在的对象：\@ FLAG:自动结缘 ? %NAME_OUTPUT_TRANSLATION("CALLNAME", (FLAG:自动结缘))%# 无\@）
;#;PRINTFORML [-99] - デ背包用、函数呼び出しぼたん
PRINTL [100] - 返回
INPUT
IF RESULT == 100
	RETURN 0
ELSEIF RESULT == 0
	CALL 起床时间设定()
ELSEIF RESULT == 1
	CALL 恋慕ルーム
	PRINTFORML 设定为%NAME_FROM_PLACE(CFLAG:MASTER:初始位置)%了
	PRINTFORMW 变更会从翌日起生效
ELSEIF RESULT == 3
	FLAG:睡四小时 = !FLAG:睡四小时
	IF FLAG:睡四小时
		PRINTFORMW 就寝时会只睡四小时
	ELSE
		PRINTFORMW 关闭了
	ENDIF
ELSEIF RESULT == 4
	FLAG:居家工作 = !FLAG:居家工作
	IF FLAG:居家工作
		PRINTFORMW 就寝时会用剩余的TSP来进行居家工作了
	ELSE
		PRINTFORMW 居家工作关闭了
	ENDIF
ELSEIF RESULT == 5
	CALL NAME_CUSTOM(MASTER)
ELSEIF RESULT == 6
	CALL 酒虫引っ越し
ELSEIF RESULT == 7 && ITEM:祭坛
	CALL AUTO_ENMUSUBI
ELSEIF RESULT == -99
	;この项目ではなく
	;@TEST_动作テスト用の中身をいじって下さいね
	;#; CALL TEST_动作テスト用
ENDIF
RETURN 1

[SKIPSTART]
函数の动作テスト用
PRINTFORMをコピペすれば口上表示时のウェイトの频度调整程度の用途には使える
注意点
・使用できるタイミングが限られる（ので、判定内容によっては挙动が变わる）
・CFLAGの操作などを行った场合にはセーブせずにそのままEmueraを结束したほうが无难
・使い终わったら白纸に戻しておきましょう
[SKIPEND]
@TEST_动作テスト用
;好きに书け

[SKIPSTART]
;さんぷる构文、梦精イベントの动作テスト
DO
	PRINTFORMW 正在待机中
	CALL DAILY_EV2
LOOP 1
[SKIPEND]


@酒虫引っ越し
#DIMS 引っ越し先名称
#DIM 引っ越し先地点
PRINTFORML 要移动到哪里？
FOR LOCAL,1,100
	IF ROOMDATA:LOCAL & 场所_厨房
		IF MAIN_MAP == 0
			LOCALS = %STR:LOCAL%
		ELSE
			LOCALS = %STR:(LOCAL + 8000 + MAIN_MAP * 100)%
		ENDIF
		IF LOCAL == 据点_酒虫 % 100
			SETCOLOR C_AQUA
		ELSEIF PRIVATEROOM:LOCAL && !TALENT:(PRIVATEROOM:LOCAL):恋慕
			SETCOLOR 100, 100, 100
		ENDIF
		PRINTFORML [{LOCAL}] %LOCALS%
		RESETCOLOR
	ENDIF
NEXT
DRAWLINE
PRINTFORML [100] 还是算了
INPUT
IF INRANGE(RESULT,1,99) && ROOMDATA:RESULT & 场所_厨房
	IF PRIVATEROOM:RESULT && !TALENT:(PRIVATEROOM:RESULT):恋慕
		PRINTFORMW 再怎么说放在那里也不是个好主意的吧
		RESTART
	ENDIF
	引っ越し先地点 = RESULT
	IF MAIN_MAP == 0
		引っ越し先名称 = %STR:引っ越し先地点%
	ELSE
		引っ越し先名称 = %STR:(引っ越し先地点 + 8000 + MAIN_MAP * 100)%
		引っ越し先地点 += MAIN_MAP * 100
	ENDIF
	
	PRINTFORML 把瓶子搬到了%引っ越し先名称%
	PRINTFORML 搬运里面全是水的瓶子是相当费劲的重劳动……
	CALL COLORMESSAGE(@"酒虫移动到了%引っ越し先名称%",C_YELLOW,2)
	据点_酒虫 = 引っ越し先地点
ENDIF

;时间(ARG)に起床する场合どれだけ睡眠するかを算出
@睡眠时间预测(ARG)
#FUNCTION
LOCAL = CFLAG:MASTER:就寝时间 - DAY * 1440
IF ARG >= LOCAL
	RETURNF ARG - LOCAL
ELSE
	RETURNF 1440 + ARG - LOCAL
ENDIF

@AUTO_ENMUSUBI
PRINTFORML 如果那天没有祈愿的话、在睡觉前会自动地和对象结缘祈求。
PRINTFORML 请选择对象
FOR LOCAL,1,CHARANUM
	SIF TALENT:LOCAL:路人
		CONTINUE
	SIF CFLAG:LOCAL:出禁
		CONTINUE
	SIF FLAG:自动结缘 == LOCAL
		SETCOLOR C_YELLOW
	PRINTFORMLC [{LOCAL}] %NAME_OUTPUT_TRANSLATION("CALLNAME", LOCAL)%
	RESETCOLOR
NEXT
PRINTFORML 
DRAWLINE
PRINTFORML [999] 放弃
INPUT
IF RESULT == 999
	FLAG:自动结缘 = 0
ELSEIF INRANGE(RESULT,1,CHARANUM)
	FLAG:自动结缘 = RESULT
ENDIF

@最低睡眠时间设定
TIME:3 = (CFLAG:MASTER:就寝时间 - DAY * 1440) + 240
SIF TIME:3 >= 1440
	TIME:3 -= 1440
SIF TIME:3 < 0
	TIME:3 = 0

@起床时间设定
#DIM 同居人
#DIM 前日就寝时间
前日就寝时间 = CFLAG:MASTER:就寝时间 - DAY * 1440
同居人 = 0
FOR LOCAL,1,CHARANUM
	IF CFLAG:LOCAL:初始位置 == CFLAG:MASTER:初始位置
		同居人 = LOCAL
		BREAK
	ENDIF
NEXT
DO
	PRINTFORML 要几点起床呢？（前日就寝时间：%时刻表示(前日就寝时间)%）（睡眠时间：{睡眠时间预测(TIME:3) / 60}时间{睡眠时间预测(TIME:3) % 60}分）
	PRINTBUTTON "┏━ △ ", 60
	PRINTBUTTON "━△", 10
	PRINTBUTTON "△━┓", 1
	PRINTL 
	PRINT ┃　
	SIF TIME:3 < 600
		PRINT ０
	PRINTFORM %TOFULL(TOSTR(TIME:3 / 60))%：
	SIF TIME:3 % 60 < 10
		PRINT ０
	PRINTFORM %TOFULL(TOSTR(TIME:3 % 60))%　
	PRINTBUTTON "□", 5555
	PRINTL 
	PRINTBUTTON "┗━ ▽ ", -60
	PRINTBUTTON "━▽", -10
	PRINTBUTTON "▽━┛", -1
	PRINTL 
	SIF 同居人 < CHARANUM && 同居人
		PRINTFORM [2222] - 和同居中的%NAME_OUTPUT_TRANSLATION("CALLNAME", 同居人)%的起床时间同步
	PRINTL 
	PRINT [3333] - 日历
	PRINT 　
	PRINTL [4444] - 直接输入
	IF 睡眠时间预测(TIME:3) < 240
		PRINTFORM [5555] - 
		CALL COLORMESSAGE("至少需要睡4个小时以上", C_ORANGE, 1)
	ELSE
		PRINTFORML [{0,4}] - 结束
	ENDIF
	INPUT
	IF RESULT == 0 && 睡眠时间预测(TIME:3) >= 240
		PRINTFORM 把闹钟设定为
		CALL COLORMESSAGE(@"%时刻表示(TIME:3)%", C_YELLOW)
		PRINTFORMW 了。
		RETURN 1
	ELSEIF RESULT == 2222 && 同居人 < CHARANUM && 同居人
		TIME:3 = CFLAG:同居人:起床时间
	ELSEIF RESULT == 3333
		CALL 日历()
	ELSEIF RESULT == 4444
		CALL 起床时间入力()
	ELSEIF RESULT == 5555
		CALL 最低睡眠时间设定()
	ELSEIF INRANGE(RESULT, -1360, 1360)
		TIME:3 += RESULT
		IF TIME:3 >= 1440
			TIME:3 -= 1440
		ELSEIF TIME:3 < 0
			TIME:3 += 1440
		ENDIF
		CLEARLINE 8
	ENDIF
LOOP 1
[SKIPSTART]
	;前のがいいってなったらこっちを戻して
	VARSET LOCAL
	FOR LOCAL, 0, 24
		IF 睡眠时间预测(LOCAL * 60) < 240
			SETCOLOR 50, 50, 50
			PRINTPLAINFORM [{LOCAL, 2}]
		ELSE
			SIF TIME:3 == LOCAL * 60
				SETCOLOR C_AQUA
			PRINTFORM [{LOCAL, 2}]
		ENDIF
		RESETCOLOR
		SIF LOCAL % 12 == 11
			PRINTL 
	NEXT
	IF 同居人 < CHARANUM && 同居人
		LOCAL:1 = CFLAG:同居人:起床时间 / 60
		DRAWLINE
		PRINTFORML [{LOCAL:1, 2}] - 同居中の%NAME_OUTPUT_TRANSLATION("CALLNAME", 同居人)%の起床时间
	ENDIF
	$INPUT_LOOP
	INPUT
	SIF RESULT < 0 || RESULT > 23 || 睡眠时间预测(RESULT * 60) < 240
		GOTO INPUT_LOOP
	TIME:3 = RESULT * 60
	PRINTFORM 把闹钟设定为
	CALL COLORMESSAGE(@"%时刻表示(TIME:3)%", C_YELLOW)
	PRINTFORMW 设定好了。（{睡眠时间预测(TIME:3) / 60}时间{睡眠时间预测(TIME:3) % 60}分睡觉）
[SKIPEND]
;;------------------------------------------------------------
;;案２　睡眠时间を直接指定する方法、起床时间を自动で设定してくれる
;	$INPUT_LOOP_0
;	PRINTL 最低でも4时间は寝る必要があり、12时间以上は自然に目が醒めてしまいます
;	PRINTFORML 何时间寝ますか？(4~12を入力してください)(8时间が平均的な睡眠时间です)
;	$INPUT_LOOP_1
;	INPUT
;	SIF RESULT < 4 || RESULT > 12
;		GOTO INPUT_LOOP_1
;	TIME:3 = ((LOCAL:1 / 60) + RESULT) * 60
;	SIF (LOCAL:1 % 60)
;		TIME:3 += 60
;	SIF TIME:3 >= 1440
;		TIME:3 -= 1440
;	PRINTFORML 起床时间は（%时刻表示(TIME:3)%）になります
;	PRINTL 可以吗？
;	PRINTL  [0] 是
;	PRINTL  [1] 否
;	$INPUT_LOOP_2
;	INPUT
;	IF RESULT == 0
;		PRINTFORMW 起床时间设定为（%时刻表示(TIME:3)%）了
;	ELSEIF RESULT == 1
;		GOTO INPUT_LOOP_0
;	ELSE
;		GOTO INPUT_LOOP_2
;	ENDIF

@起床时间入力
#DIM 时间
#DIM 分数
PRINTL 请用hhmm格式输入起床时间（输入范围hh=0 ~ 23,mm=0 ~ 59，对象外的值输入取消）
PRINTL [2400] - 中止
INPUT
时间 = RESULT / 100
分数 = RESULT % 100
IF 0 <= 时间 && 时间 < 24 && 0 <= 分数 && 分数 < 60
	TIME:3 = 时间 * 60 + 分数
	CALL COLORMESSAGE(@"%时刻表示(TIME:3)%", C_YELLOW)
	PRINTFORMW 了。
ENDIF

@恋慕ルーム
DRAWLINE
IF SLEEPTOGETHER
	PRINTL 可以和恋慕、爱欲的角色住在同一个房间
ELSE
	PRINTL 可以和恋慕的角色住在同一个房间
ENDIF
SIF CFLAG:MASTER:初始位置 == 默认初始位置
	SETCOLOR C_AQUA
PRINTFORML [  0] - %NAME_FROM_PLACE(默认初始位置)%（默认）
RESETCOLOR
FOR LOCAL, 1, CHARANUM
	SIF !CFLAG:LOCAL:神社在住
		CONTINUE
	SIF CFLAG:MASTER:初始位置 == CFLAG:LOCAL:初始位置
		SETCOLOR C_AQUA
	SIF IS_LOVER(LOCAL) || (SLEEPTOGETHER && TALENT:LOCAL:爱欲)
		PRINTFORML [{LOCAL, 3}] - %NAME_FROM_PLACE(CFLAG:LOCAL:初始位置)%
	RESETCOLOR
NEXT
DRAWLINE
PRINTFORML [999] - 中止
INPUT
IF RESULT == 999
	RETURN
ELSEIF RESULT == 0
	;初期主人公私室
	CFLAG:MASTER:初始位置 = 默认初始位置
	PRINTFORML 设定为%NAME_FROM_PLACE(CFLAG:MASTER:初始位置)%了
	PRINTFORMW 变更会从翌日起生效
	RETURN
ELSEIF RESULT == [[针妙丸]] && TALENT:MASTER:体型 >= -4 && IS_LOVER(RESULT)
	PRINTFORMW 因为不是小人所以不能一起睡觉…
ELSEIF IS_LOVER(RESULT) && CFLAG:RESULT:神社在住
	CFLAG:MASTER:初始位置 = CFLAG:RESULT:初始位置
	CALL KOJO_MESSAGE_SEND("EVENT", 19, RESULT, 3, 0)
	PRINTFORML 设定为%NAME_FROM_PLACE(CFLAG:MASTER:初始位置)%了
	PRINTFORMW 变更会从翌日起生效
	RETURN
ENDIF
RESTART
