;随时存档，顾名思义即使在任何时候都能调用的存档功能，不过事实上是给游戏过程中用的，睡觉时候本来就有了也不需要这个，所以睡觉时不能调用（那还叫什么随时）
;不确定tw能不能支持，如果能就好了，不能随时存档还是挺麻烦的，能用把这句话刪了
;我稍微优化了下逻辑,删掉了我感觉冗余的东西,同时加上了默认存档信息
;见你漏写了很多PRINTFORM,不想查了,全给你换成FORM了
@Real_Time_Save(操作模式 = 1001, IS_REAL_TIME_SAVE = 0)
#DIM 最大存档数量
#DIM 存档编号
#DIM 操作模式               ;1001为存档，1002为读档，1003为刪档，默认模式为存档
#DIM 最大页数               ;每页显示20个存档位加一个99号自动存档位
#DIM 页码 = 1
#DIM 行数
#DIM 选择的存档位
#DIM 彩蛋计数器              ;图一乐	原理精精液液一下午就是为了写这个啊
#DIM PREV_REDRAW
#DIM IS_REAL_TIME_SAVE

;魔改添加非就寝时段存档执行开关
PREV_REDRAW = CURRENTREDRAW()
REDRAW 0
;SAVENOS 最大存档数量
最大存档数量 = 1000
最大页数 = 最大存档数量 / 40
SIF 最大存档数量 % 40
    最大页数 ++
行数 = LINECOUNT
彩蛋计数器 = 0
$开始位置
CUSTOMDRAWLINE ━
PRINT 请选择要
SELECTCASE 操作模式
    CASE 1001
        PRINT 存储
    CASE 1002
        PRINT 读取
    CASE 1003
        PRINT 刪除
    CASEELSE
        THROW 模式错误，无法进行对存档的操作
ENDSELECT
PRINTFORML 的存档位置 - 第{页码}/{最大页数}页
DRAWLINE
IF 操作模式 == 1001
	SETCOLOR C_YELLOW
	PRINT [存档]
	RESETCOLOR
ELSE
	PRINTBUTTON "[存档]", 1001
ENDIF
IF 操作模式 == 1002
	SETCOLOR C_YELLOW
	PRINT [读档]
	RESETCOLOR
ELSE
	PRINTBUTTON "[读档]", 1002
ENDIF
IF 操作模式 == 1003
	SETCOLOR C_YELLOW
	PRINT [刪档]
	RESETCOLOR
ELSE
	PRINTBUTTON "[刪档]", 1003
ENDIF
IF Real_Time_Save == 1
    PRINTFORML
    SETCOLOR C_RED
    PRINTFORML 温馨提示：非就寢时段存档目前处于测试阶段，且非就寢时段存档的读取会有较长的读取时间，若有任何问题请反馈
    RESETCOLOR
ENDIF
CUSTOMDRAWLINE ━
FOR 存档编号, 40 * (页码 - 1), MIN(40 * 页码, 最大存档数量)
    VARSET RESULT:0
    RESULTS:0 = 
	CALL saveColor(存档编号)
    SIF STRFIND(RESULTS:0, "自动存档") != -1
        SETCOLOR C_GREEN
    SIF NEW_SAVE_MARK:存档编号 == 1
        FONTSTYLE 1
	PRINTFORML \@ NEW_SAVE_MARK:存档编号 == 1 ? %"[NEW!]", 6%# %" " * 6, 6%\@[{存档编号, 4}] - %RESULTS:0%
    FONTSTYLE 0
	RESETCOLOR
NEXT
;自动存档编号为99
VARSET RESULT:0
RESULTS:0 = 
CALL saveColor(1000)
SIF STRFIND(RESULTS:0, "自动存档") != -1
    SETCOLOR C_GREEN
SIF NEW_SAVE_MARK:1000 == 1
    FONTSTYLE 1
PRINTFORML \@ NEW_SAVE_MARK:1000 == 1 ? %"[NEW!]", 6%# %" " * 6, 6%\@[{1000, 4}] - %RESULTS:0%
FONTSTYLE 0
RESETCOLOR
IF 页码 == 1
    {
    HTML_PRINT @"<nonbutton title = '跳转至首页'>　　［　＜＜＜　］　　</nonbutton>
    <nonbutton title = '上十页'>　　［　＜＜　］　　</nonbutton>
    <nonbutton title = '上一页'>　　［　＜　］　　</nonbutton>
    <button title = '下一页' value = '9997'>　　［　＞　］　　</button>
    <button title = '下十页' value = '9998'>　　［　＞＞　］　　</button>
    <button title = '跳转至尾页' value = '9999'>　　［　＞＞＞　］　　</button>"
    }
ELSEIF 页码 == 最大页数
    {
    HTML_PRINT @"<button title = '跳转至首页' value = '9994'>　　［　＜＜＜　］　　</button>
    <button title = '上十页' value = '9995'>　　［　＜＜　］　　</button>
    <button title = '上一页' value = '9996'>　　［　＜　］　　</button>
    <nonbutton title = '下一页'>　　［　＞　］　　</nonbutton>
    <nonbutton title = '下十页'>　　［　＞＞　］　　</nonbutton>
    <nonbutton title = '跳转至尾页'>　　［　＞＞＞　］　　</nonbutton>"
    }
ELSEIF INRANGE(页码, 11, 最大页数 - 11)
    {
    HTML_PRINT @"<button title = '跳转至首页' value = '9994'>　　［　＜＜＜　］　　</button>
    <button title = '上十页' value = '9995'>　　［　＜＜　］　　</button>
    <button title = '上一页' value = '9996'>　　［　＜　］　　</button>
    <button title = '下一页' value = '9997'>　　［　＞　］　　</button>
    <button title = '下十页' value = '9998'>　　［　＞＞　］　　</button>
    <button title = '跳转至尾页' value = '9999'>　　［　＞＞＞　］　　</button>"
    }
ELSEIF INRANGE(页码, 1, 10)
    {
    HTML_PRINT @"<button title = '跳转至首页' value = '9994'>　　［　＜＜＜　］　　</button>
    <nonbutton title = '上十页'>　　［　＜＜　］　　</nonbutton>
    <button title = '上一页' value = '9996'>　　［　＜　］　　</button>
    <button title = '下一页' value = '9997'>　　［　＞　］　　</button>
    <button title = '下十页' value = '9998'>　　［　＞＞　］　　</button>
    <button title = '跳转至尾页' value = '9999'>　　［　＞＞＞　］　　</button>"
    }
ELSEIF INRANGE(页码, 最大页数 - 11, 最大页数)
    {
    HTML_PRINT @"<button title = '跳转至首页' value = '9994'>　　［　＜＜＜　］　　</button>
    <button title = '上十页' value = '9995'>　　［　＜＜　］　　</button>
    <button title = '上一页' value = '9996'>　　［　＜　］　　</button>
    <button title = '下一页' value = '9997'>　　［　＞　］　　</button>
    <nonbutton title = '下十页'>　　［　＞＞　］　　</nonbutton>
    <button title = '跳转至尾页' value = '9999'>　　［　＞＞＞　］　　</button>"
    }
ENDIF
HTML_PRINT @"<button value = '10000' title = '退出'>　　［ＥＸＩＴ］　　</button>"
CUSTOMDRAWLINE ━
INPUT
SELECTCASE RESULT
    CASE 9994
        页码 = 1
    CASE 9995
        页码 -= 10
    CASE 9996
        页码 --
    CASE 9997
        页码 ++
    CASE 9998
        页码 += 10
    CASE 9999
        页码 = 最大页数
    CASE 10000
        CLEARLINE LINECOUNT - 行数
        REDRAW PREV_REDRAW
        RETURN 1
    CASE 1001
        SIF 操作模式 != 1001
            操作模式 = 1001
    CASE 1002
        SIF 操作模式 != 1002
            操作模式 = 1002
    CASE 1003
        SIF 操作模式 != 1003
            操作模式 = 1003
    CASEELSE
        IF INRANGE(RESULT, 0, 最大存档数量)
            选择的存档位 = RESULT
            VARSET RESULT:0
            RESULTS:0 = 
            CHKDATA 选择的存档位
            IF RESULT != 1
                PRINTFORM 已存在存档{选择的存档位}，备注信息：
                PRINTFORML %RESULTS:0%
                PRINT 是否要
                SELECTCASE 操作模式
                    CASE 1001
						SETCOLOR 0xff5050
                        PRINTFORML 替换该存档？
						RESETCOLOR
                        CALL ASK_YN
                        IF !RESULT
							;两个代码都一样,应该考虑做成函数,减少篇幅,方便维护
							;存档
							CALL saveManageSaveGame(选择的存档位, IS_REAL_TIME_SAVE)
                        ELSE
                            PRINTFORMW 未替换存档
                        ENDIF
                    CASE 1002
                        PRINTFORML 读取该存档？
                        CALL ASK_YN
                        IF !RESULT
                            REDRAW PREV_REDRAW
                            LOADDATA 选择的存档位
                        ELSE
                            PRINTFORMW 未读取存档
                        ENDIF
                    CASE 1003
                        PRINTFORML 刪除该存档？
                        CALL ASK_YN
                        IF !RESULT
                            SETCOLOR C_RED
                            PRINTFORML 注意：你正在执行刪除存档的操作，此操作不可逆
                            PRINTFORML 确定要刪除存档{选择的存档位}吗？
                            CALL ASK_YN
                            RESETCOLOR
                            IF !RESULT
                                PRINTFORML 刪除存档{选择的存档位}
                                DELDATA 选择的存档位
                                NEW_SAVE_MARK:选择的存档位 = 0
                                PRINTFORMW 存档{选择的存档位}刪除完成
                            ELSE
                                PRINTFORMW 未刪除存档
                            ENDIF
                        ELSE
                            PRINTFORMW 未刪除存档
                        ENDIF
                    CASEELSE
                        THROW 模式错误，无法进行存档操作
                ENDSELECT
            ELSE
                SELECTCASE 操作模式
                    CASE 1001
                        PRINTFORML 要将存档存储在{选择的存档位}吗？
                        CALL ASK_YN
                        IF !RESULT
							;存档
							CALL saveManageSaveGame(选择的存档位, IS_REAL_TIME_SAVE)
                        ELSE
                            PRINTFORMW 未存储存档
                        ENDIF
                    CASE 1002
                        PRINTFORMW 此处没有存档文件
                    CASE 1003
                        PRINTFORMW 此处没有存档文件
                ENDSELECT
            ENDIF
        ELSE
            IF INRANGE(彩蛋计数器, 0, 3)
                PRINTFORMW 超出最大存档范围
                彩蛋计数器 ++
            ELSEIF INRANGE(彩蛋计数器, 4, 8)
                PRINTFORML 不去和少女们卿卿我我而是在这里玩存档？
                PRINTFORMW 存档有啥好玩的
                PRINTFORMW 赶紧存好档退出去啦
                彩蛋计数器 ++
            ELSEIF 彩蛋计数器 == 9
                SETCOLOR C_RED
                PRINTFORMW 试图把我激怒
                RESETCOLOR
                彩蛋计数器 ++
            ELSEIF 彩蛋计数器 >= 10
                PRINTFORMW 服了你了，对着存档能玩这么久，
                PRINTFORMW 恭喜你发现一个小彩蛋
                CALL CHOICE("选择想打开的彩蛋吧", "猪", "狗", "猴")
                SELECTCASE RESULT
                    CASE 0
                        PRINTFORML .
                        TWAIT 100, 0
                        PRINTFORML ..
                        TWAIT 200, 0
                        PRINTFORML ...
                        TWAIT 300, 0
                        PRINTFORML ....
                        TWAIT 400, 0
                        PRINTFORML .....
                        TWAIT 500, 0
                        PRINTFORML ......
                        TWAIT 600, 0
                        PRINTFORML 操！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！
                        PRINTFORML 我的原子弹回来啦！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！
                        PRINTFORML 嗷！！！！！！！！！！！！！！
                        PRINTFORML 原子弹！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！
                        PRINTFORML 菲尔米诺！！！！！！！
                        PRINTFORML 蕪！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！
                        PRINTFORML 完美的铲球！！！！！！！
                        PRINTFORML 超！！！！！！！
                        PRINTFORML 好冷静啊我这脚踢的！！！！！！！！！！！！！！！！！！！
                        PRINTFORML 我超我踢的好冷静啊！！！！！！！
                        PRINTFORML 蕪！！！！！！！！！！完美的配合！！！！！！！！！！！！！
                        PRINTFORML 蕪！完美的头球，马内！！！！！！！
                        PRINTFORML 我们给他来个绝杀吧？
                        PRINTFORML 卧槽！！！！！
                        PRINTFORMW 别！！！！！！！！！！！！！！！！！！！！！！！！！！！！
                    CASE 1
                        PRINTFORML 就，之前，可能还，有人，对我的s，s6登顶，没有什么概念
                        TWAIT 300, 0
                        PRINTFORML 我今天再给大伙讲一次
                        TWAIT 300, 0
                        PRINTFORML 首先
                        PRINTFORML 你要知道
                        PRINTFORML 现在的
                        PRINTFORML S11了
                        PRINTFORML 好像已经S11了
                        PRINTFORML 我跟你说我当年的s登顶
                        PRINTFORML 前十都是什么样的人
                        PRINTFORMW 这就要打开我的文本了
                        PRINTFORML OK，前十是谁呢
                        TWAIT 500, 0
                        PRINTFORML JKL
                        TWAIT 100, 0
                        PRINTFORML MING
                        TWAIT 100, 0
                        PRINTFORML NING
                        TWAIT 100, 0
                        PRINTFORML DOPA
                        TWAIT 100, 0
                        PRINTFORML THESHY
                        TWAIT 100, 0
                        PRINTFORML RUO
                        TWAIT 100, 0
                        PRINTFORML XIYE
                        TWAIT 100, 0
                        PRINTFORML MLXG
                        TWAIT 100, 0
                        PRINTFORML 白色风车
                        TWAIT 100, 0
                        PRINTFORML XIAOHU
                        PRINTFORMW 这样的人
                        PRINTFORML 个个都是顶天立地，s赛，是吧
                        PRINTFORML 要么就是顶天立地的路人选手
                        PRINTFORMW 要么就是s赛大杀四方的人
                        PRINTFORMW 现在的s11呢，国服前十都是谁
                        PRINTFORMW 惹
                        PRINTFORMW 完全看不出来谁顶天立地了
                        PRINTFORML 你告诉我
                        PRINTFORML 含金量来说
                        PRINTFORML 一二三四，五，六七八，九十这十个人的含金量
                        PRINTFORML 跟这十个人的含金量
                        PRINTFORML 我觉得
                        PRINTFORML 这里面随便出来一个人
                        PRINTFORMW 他们的含金量都碾压这十个人
                        PRINTFORML 这就是
                        PRINTFORMW s6和s5的含，金，量
                        PRINTFORMW 懂了吗^^_
                        PRINTFORML 这就是龙哥，当年这个登顶的含金量有多足
                        PRINTFORML 为什么这些人
                        PRINTFORML 他现在不来国服登顶了
                        PRINTFORMW 为什么呢
                        PRINTFORMW 因为现在的国服
                        PRINTFORMW 它没有含，金，量
                        PRINTFORMW 没问题吧^^_
                        PRINTFORMW 龙哥的表达能力很，很显而易懂吧^^_
                    CASE 2
                        PRINTFORML 瑟提！
                        TWAIT 1000, 0
                        PRINTFORML 这把是不是你打的有问题？！
                        TWAIT 1000, 0
                        PRINTFORML 瑟提说对嗯嗯嗯是我打的有问题
                        TWAIT 1000, 0
                        PRINTFORML 弹幕还得合计呢
                        TWAIT 1000, 0
                        PRINTFORML 欸主播你是不是给人泼脏水啊
                        TWAIT 1000, 0
                        PRINTFORML 就他
                        TWAIT 1000, 0
                        PRINTFORML 承认了自己打得很垃圾
                        TWAIT 1000, 0
                        PRINTFORML 为什么你们这帮XX还是要会人洗呢
                        TWAIT 1000, 0
                        PRINTFORML 为什么现在还不Q？
                        TWAIT 500, 0
                        PRINTFORML 为什么不Q？
                        TWAIT 1000, 0
                        PRINTFORML 现在为什么还不Q？
                        TWAIT 500, 0
                        PRINTFORML 为什么还不Q？
                        TWAIT 1000, 0
                        PRINTFORML A一下
                        TWAIT 400, 0
                        PRINTFORML AQ
                        TWAIT 300, 0
                        PRINTFORML Q呢Q呢
                        TWAIT 800, 0
                        PRINTFORML 为什么不Q这个人？
                        TWAIT 1000, 0
                        PRINTFORML Q打断别人的E呀！
                        TWAIT 2000, 0
                        FONTBOLD
                        PRINTFORML 我闡释你的梦！！！！！！！
                        TWAIT 2000, 0
                        PRINTFORMW 哇襖！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！
                        FONTREGULAR
                ENDSELECT
            ENDIF
        ENDIF
ENDSELECT
;放到最后面处理,不仅可以减少代码数量,还可以防止漏写
CLEARLINE LINECOUNT - 行数
GOTO 开始位置

;根据存档状况上色
@saveColor(saveId)
	#DIM saveId
    SELECTCASE CHKDATA(saveId)
        CASE 1
            SETCOLOR C_L_GRAY
        CASE 2
            SETCOLOR C_RED
        CASE 3
            SETCOLOR C_ORANGE
        CASE 4
            SETCOLOR C_P_PURPLE
    ENDSELECT

;存档
@saveManageSaveGame(选择的存档位, MODE = 0)
	#DIM 选择的存档位
	#DIMS 存档备注信息
    #DIM MODE
	GETTIME
	存档备注信息 '= @"%RESULTS% "
    IF MODE == 2
        存档备注信息 += createSaveInfo(MODE)
        SAVEDATA 选择的存档位, 存档备注信息
    ELSE
        PRINTFORML 需要添加备注信息吗？
        CALL ASK_YN
        IF !RESULT
            存档备注信息 += @"{DAY:0, 3, RIGHT}日"  
            INPUTS
            存档备注信息 += RESULTS
            SIF MODE == 1
                存档备注信息 += " ⭐即时存档⭐ "
        ELSE
            存档备注信息 += createSaveInfo(MODE)
        ENDIF
        SIF MODE == 1
            SaveDataInTrain = 1
        SAVEDATA 选择的存档位, 存档备注信息
        PRINTFORMW 已存档{选择的存档位}，存档备注信息：%存档备注信息%
    ENDIF
    IF STRFIND(存档备注信息, "⭐即时存档⭐") == -1
        NEW_SAVE_MARK:选择的存档位 = 1
        SAVEGLOBAL
    ENDIF