;-----------------------------------------------------------
;据点Mapの存在判定
;现在は0～10まで全て揃ったのであまり意味はない
;-----------------------------------------------------------
@GET_EXISTMAP(ARG)
#FUNCTION
SIF GROUPMATCH(ARG, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10)
	RETURNF 1

;-----------------------------------------------------------
;对象Mapの呼び名文字列を返す
;ARG     MAPID
;-----------------------------------------------------------
@GET_MAPNAME(ARG)
#FUNCTIONS
#DIMS PNAME
SELECTCASE ARG
	CASE 0
		PNAME = 博丽神社
	CASE 1
		PNAME = 命莲寺
	CASE 2
		PNAME = 人间之里
	CASE 3
		PNAME = 雾之湖～红魔馆
	CASE 4
		PNAME = 迷途竹林
	CASE 5
		PNAME = 魔法之森
	CASE 6
		PNAME = 三途之川～冥界
	CASE 7
		PNAME = 妖怪之山 (山麓)
	CASE 8
		PNAME = 妖怪之山 (山顶)
	CASE 9
		PNAME = 地底
	CASE 10
		PNAME = 梦之世界～月
	CASEELSE
		PNAME = 谜之领域
ENDSELECT
RETURNF PNAME

;-----------------------------------------------------------
;据点内の场所ARGへCHARAが移动できるかを返す函数
;键や危险地带・幻影地带など
;ARG    场所ID
;CHARA  角色ID,省略すると0=MASTER,现状角色移动以外では使いません
;-----------------------------------------------------------
@MAP_CAN_MOVE(ARG, CHARA)
#FUNCTION
#DIM CHARA
#DIM 家主
#DIM 在宅
;ワンルーム共通处理
IF ROOMDATA:(ARG % 100) & 场所_ワンルーム
	家主 = PRIVATEROOM:(ARG % 100)
	RETURNF MAP_CAN_MOVE_ONEROOM(ARG, CHARA, 家主)
ENDIF

;未登录地点
IF STR:(8000 + ARG) == ""
	TFLAG:移动不能信息 = 998
	RETURNF 0
ENDIF
;房间上锁
SIF FLAG:房间上锁 && ARG == CFLAG:MASTER:初始位置 && CHARA != MASTER && ARG != CFLAG:CHARA:初始位置
	RETURNF 0
;以降は据点ごとに设定
SELECTCASE MAIN_MAP
	CASE 0
		RETURNF MAP_CAN_MOVE_0(ARG, CHARA)
	CASE 1
		RETURNF MAP_CAN_MOVE_1(ARG, CHARA)
	CASE 2
		RETURNF MAP_CAN_MOVE_2(ARG, CHARA)
	CASE 3
		RETURNF MAP_CAN_MOVE_3(ARG, CHARA)
	CASE 4
		RETURNF MAP_CAN_MOVE_4(ARG, CHARA)
	CASE 5
		RETURNF MAP_CAN_MOVE_5(ARG, CHARA)
	CASE 6
		RETURNF MAP_CAN_MOVE_6(ARG, CHARA)
	CASE 7
		RETURNF MAP_CAN_MOVE_7(ARG, CHARA)
	CASE 8
		RETURNF MAP_CAN_MOVE_8(ARG, CHARA)
	CASE 9
		RETURNF MAP_CAN_MOVE_9(ARG, CHARA)
	CASE 10
		RETURNF MAP_CAN_MOVE_10(ARG, CHARA)
ENDSELECT
RETURNF 1

@MAP_CAN_MOVE_ONEROOM(ARG, CHARA, 家主)
#FUNCTION
#DIM CHARA
#DIM 家主
#DIM 在宅
在宅 = 0
;你
IF CHARA == MASTER
	;自宅なら可能
	IF ARG == 默认初始位置
		RETURNF 1
	;同行か恋慕なら入れる（家主睡眠中も可
	ELSEIF CFLAG:家主:同行 || TALENT:家主:恋慕
		在宅 = 1
	;家主がいて起きてる
	ELSEIF CFLAG:家主:当前位置 == ARG
		SIF SHIRAHU(家主)
			在宅 = 1
	;家主以外の谁かがいる,この人物は寝てたりしても良い
	ELSEIF IN_ROOM_NUMBER(ARG)
		在宅 = 1
	ENDIF
;家主は入れる
ELSEIF CHARA == 家主
	在宅 = 1
;そうでない角色は相性が100を超えていないとダメ
ELSEIF RELATION:家主:CHARA > 100
	在宅 = 1
ENDIF
IF !在宅
	IF FINDCHARA(CFLAG:初始位置, ARG, 1) != -1 && FINDCHARA(CFLAG:初始位置, ARG, 1) != 家主
		家主 = FINDCHARA(CFLAG:初始位置, ARG, 1)
		RESTART
	ENDIF
	TFLAG:移动不能信息 = 999
	RETURNF 0
ENDIF
RETURNF 1
;-----------------------------------------------------------
;地点の接续设定
;ARG    基准の地点
;ARG:1  对象の地点
;RETURNF 0=移动できない,见えない
;        1=移动できる,见えない
;        2=移动できない,见える
;        3=移动できる,见える（直通）
;-----------------------------------------------------------
@CAN_MOVE(ARG, ARG:1)
#FUNCTION

IF MAIN_MAP == GET_MAPID(ARG)
	SELECTCASE MAIN_MAP
		CASE 0
			RETURNF CAN_MOVE_0(ARG, ARG:1)
		CASE 1
			RETURNF CAN_MOVE_1(ARG, ARG:1)
		CASE 2
			RETURNF CAN_MOVE_2(ARG, ARG:1)
		CASE 3
			RETURNF CAN_MOVE_3(ARG, ARG:1)
		CASE 4
			RETURNF CAN_MOVE_4(ARG, ARG:1)
		CASE 5
			RETURNF CAN_MOVE_5(ARG, ARG:1)
		CASE 6
			RETURNF CAN_MOVE_6(ARG, ARG:1)
		CASE 7
			RETURNF CAN_MOVE_7(ARG, ARG:1)
		CASE 8
			RETURNF CAN_MOVE_8(ARG, ARG:1)
		CASE 9
			RETURNF CAN_MOVE_9(ARG, ARG:1)
		CASE 10
			RETURNF CAN_MOVE_10(ARG, ARG:1)
	ENDSELECT
ENDIF
RETURNF 0

;-----------------------------------------------------------
;场所IDの名前文字列を返す函数
;ARG  场所ID
;-----------------------------------------------------------
@NAME_FROM_PLACE(ARG)
#FUNCTIONS
#DIM MAPID
#DIMS PNAME
PNAME = 
MAPID = GET_MAPID(ARG)
IF TFLAG:妄想中 == 1
	PNAME =素敌空间
ELSEIF ARG == OMANEKIBEYA()
	;待客室の名前处理
	RETURNF OMANEKI_PLACE()
ELSEIF ARG == ROAD_TO(MAPID)
	PNAME = %GET_MAPNAME(MAPID)%への道中
ELSEIF MAPID == MAIN_MAP
	;物件Map内の名前处理
	SELECTCASE MAPID
		CASE 0
			PNAME = %MAP_PLACENAME_0(ARG)%
		CASE 1
			PNAME = %MAP_PLACENAME_1(ARG)%
		CASE 2
			PNAME = %MAP_PLACENAME_2(ARG)%
		CASE 3
			PNAME = %MAP_PLACENAME_3(ARG)%
		CASE 4
			PNAME = %MAP_PLACENAME_4(ARG)%
		CASE 5
			PNAME = %MAP_PLACENAME_5(ARG)%
		CASE 6
			PNAME = %MAP_PLACENAME_6(ARG)%
		CASE 7
			PNAME = %MAP_PLACENAME_7(ARG)%
		CASE 8
			PNAME = %MAP_PLACENAME_8(ARG)%
		CASE 9
			PNAME = %MAP_PLACENAME_9(ARG)%
		CASE 10
			PNAME = %MAP_PLACENAME_10(ARG)%
	ENDSELECT
ELSEIF ARG < 2000
	;おでかけMapの方
	PNAME = %STR:(6000 + ARG / 10)%
ELSE
	;道中他、其他范围
	PNAME = %STR:(ARG)%
ENDIF
RETURNF PNAME

;-----------------------------------------------------------
;据点の场所IDをお出かけMap上の场所IDに置换する函数
;ARG      对象の场所ID（据点Map）
;RETURNF  差し替え场所ID（お出かけMap）
;-----------------------------------------------------------
@GET_MAP_REPLACEMENT(ARG)
#FUNCTION
#DIM 对象Map
#DIM OUTID
OUTID = 0
对象Map =  GET_MAPID(ARG)
SIF MAIN_MAP == 对象Map
	RETURNF ARG

SELECTCASE 对象Map
	CASE 0
		OUTID = MAP_SEARCH_REPLACEMENT_0(ARG)
	CASE 1
		OUTID = MAP_SEARCH_REPLACEMENT_1(ARG)
	CASE 2
		OUTID = MAP_SEARCH_REPLACEMENT_2(ARG)
	CASE 3
		OUTID = MAP_SEARCH_REPLACEMENT_3(ARG)
	CASE 4
		OUTID = MAP_SEARCH_REPLACEMENT_4(ARG)
	CASE 5
		OUTID = MAP_SEARCH_REPLACEMENT_5(ARG)
	CASE 6
		OUTID = MAP_SEARCH_REPLACEMENT_6(ARG)
	CASE 7
		OUTID = MAP_SEARCH_REPLACEMENT_7(ARG)
	CASE 8
		OUTID = MAP_SEARCH_REPLACEMENT_8(ARG)
	CASE 9
		OUTID = MAP_SEARCH_REPLACEMENT_9(ARG)
	CASE 10
		OUTID = MAP_SEARCH_REPLACEMENT_10(ARG)
	CASEELSE
		OUTID = ARG
ENDSELECT

SIF OUTID > 0
	RETURNF OUTID

;-----------------------------------------------------------
;お出かけ先のMap设定を返す函数
;ARG   对象の地点
;ARGS  判定文字典数
;-----------------------------------------------------------
@ODEKAKEMAP_SETTING(ARG, ARGS)
#FUNCTION
;待客室と隙间はスルー,0もスルー
SIF GROUPMATCH(ARG, OMANEKIBEYA(), SUKIMA(), 0)
	RETURNF 0
;MAIN_MAPを对象にしていた场合はエラーを吐く
SIF GET_MAPID(ARG) == MAIN_MAP
;	RETURNF ODEKAKEMAP_SETTING_0(ARG, ARGS)
	THROW 
;文字典数を省いた场合もエラー
SIF ARGS == ""
;	RETURNF ODEKAKEMAP_SETTING_0(ARG, ARGS)
	THROW 
SELECTCASE GET_MAPID(ARG)
	CASE 0
		RETURNF ODEKAKEMAP_SETTING_0(ARG, ARGS)
	CASE 1
		RETURNF ODEKAKEMAP_SETTING_1(ARG, ARGS)
	CASE 2
		RETURNF ODEKAKEMAP_SETTING_2(ARG, ARGS)
	CASE 3
		RETURNF ODEKAKEMAP_SETTING_3(ARG, ARGS)
	CASE 4
		RETURNF ODEKAKEMAP_SETTING_4(ARG, ARGS)
	CASE 5
		RETURNF ODEKAKEMAP_SETTING_5(ARG, ARGS)
	CASE 6
		RETURNF ODEKAKEMAP_SETTING_6(ARG, ARGS)
	CASE 7
		RETURNF ODEKAKEMAP_SETTING_7(ARG, ARGS)
	CASE 8
		RETURNF ODEKAKEMAP_SETTING_8(ARG, ARGS)
	CASE 9
		RETURNF ODEKAKEMAP_SETTING_9(ARG, ARGS)
	CASE 10
		RETURNF ODEKAKEMAP_SETTING_10(ARG, ARGS)
	CASEELSE
		THROW
ENDSELECT

;-----------------------------------------------------------
;Mapのエリア番号を返す函数,エリア番号はTFLAG:地图切换のMap番号
;ARG    MAPID
;ARG:1  判定する场所ID（0ならMASTERの当前位置）
;-----------------------------------------------------------
@MAP_AREASELECT(ARG, ARG:1)
#FUNCTION
SIF !ARG:1
	ARG:1 = CFLAG:MASTER:当前位置
SELECTCASE ARG
	CASE 0
		RETURNF MAP_AREASELECT_0(ARG:1)
	CASE 1
		RETURNF MAP_AREASELECT_1(ARG:1)
	CASE 2
		RETURNF MAP_AREASELECT_2(ARG:1)
	CASE 3
		RETURNF MAP_AREASELECT_3(ARG:1)
	CASE 4
		RETURNF MAP_AREASELECT_4(ARG:1)
	CASE 5
		RETURNF MAP_AREASELECT_5(ARG:1)
	CASE 6
		RETURNF MAP_AREASELECT_6(ARG:1)
	CASE 7
		RETURNF MAP_AREASELECT_7(ARG:1)
	CASE 8
		RETURNF MAP_AREASELECT_8(ARG:1)
	CASE 9
		RETURNF MAP_AREASELECT_9(ARG:1)
	CASE 10
		RETURNF MAP_AREASELECT_10(ARG:1)
ENDSELECT

;-----------------------------------------------------------
;描画するMapの函数名を返す函数
;MAP_X.ERB参照
;ARG    MAPID
;-----------------------------------------------------------
@MAP_VIEWING_NAME(ARG)
#FUNCTIONS
SELECTCASE ARG
	CASE 0
		RETURNF MAP_VIEWING_NAME_0()
	CASE 1
		RETURNF MAP_VIEWING_NAME_1()
	CASE 2
		RETURNF MAP_VIEWING_NAME_2()
	CASE 3
		RETURNF MAP_VIEWING_NAME_3()
	CASE 4
		RETURNF MAP_VIEWING_NAME_4()
	CASE 5
		RETURNF MAP_VIEWING_NAME_5()
	CASE 6
		RETURNF MAP_VIEWING_NAME_6()
	CASE 7
		RETURNF MAP_VIEWING_NAME_7()
	CASE 8
		RETURNF MAP_VIEWING_NAME_8()
	CASE 9
		RETURNF MAP_VIEWING_NAME_9()
	CASE 10
		RETURNF MAP_VIEWING_NAME_10()
ENDSELECT

;-----------------------------------------------------------
;内部构造がある场所の内部の判定
;表示するMap（TFLAG:地图切换）によって变化するので注意
;ARG    MAPID
;ARG:1  表示场所ID
;ARG:2  内部场所ID
;-----------------------------------------------------------
@GETMAP_BUILDING(ARG, ARG:1, ARG:2)
#FUNCTION
SELECTCASE ARG
	CASE 0
		RETURNF GETMAP_BUILDING_0(ARG:1, ARG:2)
	CASE 1
		RETURNF GETMAP_BUILDING_1(ARG:1, ARG:2)
	CASE 2
		RETURNF GETMAP_BUILDING_2(ARG:1, ARG:2)
	CASE 3
		RETURNF GETMAP_BUILDING_3(ARG:1, ARG:2)
	CASE 4
		RETURNF GETMAP_BUILDING_4(ARG:1, ARG:2)
	CASE 5
		RETURNF GETMAP_BUILDING_5(ARG:1, ARG:2)
	CASE 6
		RETURNF GETMAP_BUILDING_6(ARG:1, ARG:2)
	CASE 7
		RETURNF GETMAP_BUILDING_7(ARG:1, ARG:2)
	CASE 8
		RETURNF GETMAP_BUILDING_8(ARG:1, ARG:2)
	CASE 9
		RETURNF GETMAP_BUILDING_9(ARG:1, ARG:2)
	CASE 10
		RETURNF GETMAP_BUILDING_10(ARG:1, ARG:2)
ENDSELECT

;-----------------------------------------
;私室に最も近い共用澡堂を判定する函数
;木浴缸の效果を付与する际の判定に利用
;ARG =1のときは设置场所を表记する时に利用する
;基本は=0
;-----------------------------------------
@NEAR_BATH(ARG = 0)
#FUNCTION
RETURNF 0

;とりあえず冻结
[SKIPSTART]
;据点でなければ判定しない
SIF !IN_HOME(CFLAG:MASTER:当前位置) && ARG == 0
	RETURNF 0
SELECTCASE CFLAG:MASTER:初始位置
	CASE 35, 32, 33, 34;博丽神社・三妖精之家地下室　三妖精の私室→30三妖精之家・澡堂
		RETURNF 30
	CASE 51, 43, 44;梦幻遗迹・仓库　梦美千百合私室→39梦幻遗迹・浴室
		RETURNF 39
	CASE 53, 15, 16, 17, 18, 19, 52, 54, 55;博丽神社・仓库　ほか、博丽神社内私室→13澡堂
		RETURNF 13
	CASE 58,61 to 66;大别墅
		RETURNF 57
	CASE 108, 109, 113 TO 120;命莲寺・别馆　ほか命莲寺内私室→112浴室
		RETURNF 112
	CASE 134, 125, 127, 128;神灵庙・藏　ほか道场内私室→133浴室
		RETURNF 133
	CASE 230, 226, 221, 224, 225, 231 TO 235;人里・主人公的房间　ほか私室→228包场浴场
		RETURNF 228
	CASE 304, 303, 311, 312, 320, 321, 326, 329, 331;雾之湖～红魔馆・空的小屋　ほか私室→333大浴场
		RETURNF 333
	CASE 340 TO 342, 344 TO 346, 348;废洋馆と雾之湖周りの私室→338废洋馆・澡堂
		RETURNF 338
	CASE 410 TO 414, 423, 424, 427, 428, 430;永远亭・空的房间or二层空的房间　ほか、私室→420澡堂
		RETURNF 
	CASE 442, 432, 437, 439, 440, 443, 445;迷途竹林・空的小屋　ほか、私室→441温泉
		RETURNF 441
	CASE 460, 451, 452, 457, 459, 463;梦幻馆 空室　ほか、私室→454梦幻馆 澡堂
		RETURNF 454
	CASE 515, 512, 541 TO 544;魔法之森・魔理沙宅・仓库　ほか、森の私室→514魔理沙宅・澡堂
		RETURNF 514
	CASE 531, 521, 522, 523;魔法之森・人偶洋馆・空的房间　ほか私室→526人偶洋馆・澡堂
		RETURNF 526
	CASE 536, 535;魔法之森・艾伦宅・仓库　艾伦私室→537艾伦宅・澡堂
		RETURNF 537
	CASE 618, 608, 609, 615, 616;是非直曲厅・空的房间　ほか、私室→617澡堂
		RETURNF 617
	CASE 625, 623, 624;冥界・主人公的房间　妖梦、幽幽子私室→627澡堂
		RETURNF 627
	CASE 634, 633, 635, 638;八云邸空房间　紫蓝橙私室→636澡堂
		RETURNF 636
	CASE 644, 645;袿姫、磨弓私室→643灵长园的澡堂
		RETURNF 643
	CASE 648;八千慧宅的寝室→646八千慧宅的澡堂
		RETURNF 646
	CASE 651;早鬼宅的寝室→652早鬼宅的澡堂
		RETURNF 652
	CASE 719, 734, 704, 706, 717, 733, 736;妖怪之山・山麓・秋姊妹的家・会客室or小屋　ほか私室→735游泳场
		RETURNF 735
	CASE 728, 727;仙人的宅邸・空的房间　华扇私室→721仙人的宅邸・澡堂
		RETURNF 721
	CASE 810, 823, 807, 808, 809, 817, 818, 820;妖怪之山・山顶・山小屋or空室→825澡堂
		RETURNF 825
	CASE 842, 839, 840, 841;比那名居邸库房　ほか、私室→837比那名居邸澡堂
		RETURNF 837
	CASE 916, 943, 911, 912, 918, 919;地底・库房orあばら家→921澡堂
		RETURNF 921
	CASE 1006 TO 1009, 1032, 1033, 1041, 1042;月之都と绵月亭→1030绵月亭 澡堂
		RETURNF 1030
	CASE 1051, 1052;哆来咪宅→1042哆来咪宅 澡堂
		RETURNF 1054
	CASE 1063, 1064, 1071, 1072;纯狐邸→1049纯狐邸 澡堂
		RETURNF 1067
	CASEELSE
		RETURNF 0
ENDSELECT
[SKIPEND]
