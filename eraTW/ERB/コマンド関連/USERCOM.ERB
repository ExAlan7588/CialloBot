;FileName_USERCOM.ERB ------------------------------ Rev1.00
;指令判定处理
;CALL		SYSTEM
;ARG		VOID
;RETURN		VOID
;COMMENT	
;-----------------------------------------------------------
@USERCOM
#DIM 能力表示用ダミー
#DIM 装备部位
#DIM 胖次消费
#DIM なだめ判定
#DIM DYNAMIC CAN_BE_UNLOKED_ROOM_SAVE
$LOOP_USERCOM
;生动记忆补丁
SIF MEETCHECKDLC
	MEETTIME:0:TARGET = DAY
;催眠发动
IF RESULT == 666 && ( (BASE:MASTER:TSP >= 500 && !FLAG:70) || FLAG:催眠强度)
	CALL 催眠发动
ELSEIF RESULT == 900
	CALL event_sex_tattoo_manage
;一般指令(COMF)
ELSEIF RESULT >= 0 && RESULT < 800
	;带出去判定
	IF RESULT == 351 && !CHK_DATENOW(CFLAG:MASTER:约会中)
		CALL COM_ABLE351
		SIF !RESULT
			RETURN 0
		PRINTL 带出去
		STR:0 = 带出去
		CALL COM351
		RETURN 0
	ENDIF
	IF TCVAR:TARGET:烂醉 && BASE:TARGET:酒气 < (MAXBASE:TARGET:酒气 / 10) * 4 && CFLAG:TARGET:诶嘿嘿
		SETCOLOR C_H_PINK
		PRINTFORML 烂醉中的%NAME_OUTPUT_TRANSLATION("CALLNAME", TARGET)%马上就要醒了,是否继续玩弄???
		PRINTBUTTON "[是,继续玩弄]", "是"
		PRINTBUTTON "[否,撤销操作]", "否"
		RESETCOLOR
		INPUTS
		SELECTCASE RESULTS
			CASE "是"
			;PRINTL 
			CASE "否"
				PRINTL 撤销操作!!!
				RETURN 0
			CASEELSE
				PRINTL 输入错误,撤销操作!!!
				RETURN 0
		ENDSELECT
	ENDIF

	IF DEBUGGERR && RESULT == 777
	    CALL DEBUG_MODE
        RETURN 0
    ENDIF

	IF RESULT == 778
		SWEEPGOD = 3
		CALL AUTO_SWEEP
		CALL AUTO_SWEEP
		CALL AUTO_SWEEP
		CALL AUTO_SWEEP
		CALL AUTO_SWEEP
		CALL AUTO_SWEEP
		CALL AUTO_SWEEP
		CALL AUTO_SWEEP
		CALL AUTO_SWEEP
		CALL AUTO_SWEEP
		CALL AUTO_SWEEP
		CALL AUTO_SWEEP
		CALL AUTO_SWEEP
		CALL AUTO_SWEEP
		CALL AUTO_SWEEP
		CALL AUTO_SWEEP
		CALL AUTO_SWEEP
		CALL AUTO_SWEEP
		CALL AUTO_SWEEP
		;清扫经验は10~20上升
		SWEEPEXP_OLD = EXP:MASTER:清扫经验
		EXP:MASTER:清扫经验 += (10 + RAND: (10) )
		SWEEPEXP_NEW = EXP:MASTER:清扫经验
		PRINTFORMW 清扫经验 +%TOSTR(SWEEPEXP_NEW - SWEEPEXP_OLD)%
		BASE:MASTER:体力 -= 10 * (SWEEPEXP_NEW - SWEEPEXP_OLD + 5)
		BASE:MASTER:气力 -= 15 * (SWEEPEXP_NEW - SWEEPEXP_OLD + 5)
		TIME += 15
		SWEEPGOD = 1
		RETURN 0
	ENDIF

	;指令登录チェック
	SIF TRAINNAME:RESULT == "" && !INRANGE(RESULT, 270, 299)
		RETURN 0
	;SELECTCOMとTFLAG:3(SELECTCOM退避)に入力值セット
	SELECTCOM = RESULT
	TFLAG:3 = SELECTCOM
	;一部指令の特殊制限
	SELECTCASE SELECTCOM
		CASE 100 TO 107,140 TO 145
			IF TALENT:TARGET:妊娠
				PRINTW 不能对孕妇做这种事！
				RETURN 0
;			ELSEIF !GETBIT(CFLAG:TARGET:既成事实, 4)
;				CALL ＳＭ许可
			ENDIF
		CASE 60 TO 71
			IF TALENT:TARGET:妊娠 && (CFLAG:TARGET:903 <= 30 || CFLAG:TARGET:903 >= 71)
				PRINTFORMW 现在最好不要对%NAME_OUTPUT_TRANSLATION("CALLNAME", TARGET)%乱来比较好
				RETURN 0
;			ELSEIF !GETBIT(CFLAG:TARGET:既成事实, 3)
;				CALL Ａ许可
			ENDIF
	ENDSELECT
	SIF GLOBAL_COMABLE2(SELECTCOM)
		RETURN 0
	;指令使用可能判定
	TRYCALLFORM COM_ABLE{SELECTCOM}
	SIF RESULT == 0
		RETURN 0
	;实行制限(实行拒否等)チェック
	TRYCALLFORM CAN_COM{SELECTCOM}(1)
	IF RESULT == 0 && !CFLAG:败犬 && !TCVAR:强行
		;实行值表示のため再度CAN_COM
		TRYCALLFORM CAN_COM{SELECTCOM}(0)
		RETURN 0
	ENDIF
	;ダミーTRAIN
	DOTRAIN 999
;履历表示（未实装）
ELSEIF RESULT == 800
	CALL SHOW_EQUIP
	TFLAG:Info表示中 = 0
	RETURN 1
;污渍显示
ELSEIF RESULT == 801
	CALL STAIN_INFO
	TFLAG:Info表示中 = 0
	RETURN 1
;TARGET变更
ELSEIF RESULT == 802
	IF !CFLAG:陪睡中
		CALL TARGET_CHANGE
		TFLAG:Info表示中 = 0
		RETURN 1
	ENDIF
;TARGETの状态表示
ELSEIF RESULT == 803
	IF TARGET == MASTER
		CALL SINGLE_CHARA_STATE(MASTER, "「调教中」")
	ELSE
		CALL TARGET_LIST_STATE
	ENDIF
	TFLAG:Info表示中 = 0
	RETURN 1
;MASTERの状态表示
ELSEIF RESULT == 804
	CALL SINGLE_CHARA_STATE(MASTER, "「调教中」")
	TFLAG:Info表示中 = 0
	RETURN 1
ELSEIF RESULT == 805
	CALL SHOW_ALLITEM
	RETURN 1
;指令过滤器
ELSEIF RESULT == 809
	CALL OPTION_COMMAND_FILTER
ELSEIF RESULT == 815 && FLAG:70 && !CFLAG:TARGET:睡眠 && AT_HOME(MASTER)
	IF BATHCHECK(CFLAG:MASTER:当前位置) || IN_TOILET(CFLAG:MASTER:当前位置)
		PRINTFORMW 果然在这个地方不太合适
	ELSEIF TFLAG:运搬 != TARGET
		PRINTFORMW %NAME_OUTPUT_TRANSLATION("CALLNAME", MASTER)%背起了%NAME_OUTPUT_TRANSLATION("CALLNAME", TARGET)%
		TFLAG:运搬 = TARGET
	ELSE
		PRINTFORMW %NAME_OUTPUT_TRANSLATION("CALLNAME", MASTER)%放下了%NAME_OUTPUT_TRANSLATION("CALLNAME", TARGET)%
		TFLAG:运搬 = 0
	ENDIF
ELSEIF RESULT == 816
	FLAG:画像表示 = !FLAG:画像表示
;集合
ELSEIF RESULT == 817 && FLAG:70 && TALENT:MASTER:集合 && AT_HOME(MASTER) && !CFLAG:诶嘿嘿
	CALL SYUGO()
ELSEIF RESULT == 817
	FLAG:插绘表示 = !FLAG:插绘表示
ELSEIF RESULT == 818
	CALL SHOW_GATHERING_LIST_SELECT(GATHERING_SPOT(CFLAG:MASTER:当前位置))
;脱衣服
ELSEIF RESULT == 820 && EQUIP:0 && !(TFLAG:102 == 3 && TFLAG:抱住模式)
	CALL 脱衣服
;内衣をくすねる指令の切り离し
ELSEIF RESULT == 821 && EQUIP:0 && EQUIP:TARGET:下半身内衣２
	IF !TARGET && !FLAG:70 && !CFLAG:MASTER:恶作剧
		;CALL SIMATTYAUOJISAN
	ELSE
		SIF CFLAG:TARGET:291 == 0
			CALL 脱衣处理(TARGET, "くすねる")
	ENDIF
;上半身内衣を脱がす
ELSEIF RESULT == 822 && EQUIP:TARGET:0 && EQUIP:TARGET:上半身内衣１ != 0
	IF !TARGET
		;CALL SIMATTYAUOJISAN
	ELSE
		IF EQUIP:TARGET:上身衣服１ || EQUIP:TARGET:上身衣服２ || EQUIP:TARGET:连衣裙 || EQUIP:TARGET:和服 || EQUIP:TARGET:连体内衣
			PRINTFORM 将%NAME_OUTPUT_TRANSLATION("CALLNAME", TARGET)%的%SHOW_TOP(TARGET,1)%袒露开来、
		ELSE
			PRINTFORM %NAME_OUTPUT_TRANSLATION("CALLNAME", TARGET)%的
		ENDIF
		PRINTFORMW %CLOTHNAME(7,EQUIP:TARGET:上半身内衣１)%直接脱掉
		EQUIP:TARGET:上半身内衣１ = 0
		TEQUIP:TARGET:上半身着衣状况 = 1
		TEQUIP:TARGET:上半身裸露状态 = 1
		EQUIP:MASTER:上半身内衣１ = 0
		TEQUIP:MASTER:上半身着衣状况 = 1
		TEQUIP:MASTER:上半身裸露状态 = 1
		RETURN 0
	ENDIF
;变成只穿内衣的样子
ELSEIF RESULT == 823 && EQUIP:0 && (EQUIP:TARGET:上身衣服１ || EQUIP:TARGET:上身衣服２ || EQUIP:TARGET:连衣裙 || EQUIP:TARGET:和服 || EQUIP:TARGET:外衣)
	IF !TARGET
		;CALL SIMATTYAUOJISAN
	ELSE
		CALL 脱衣处理(TARGET, "变成只穿内衣的样子")
		CALL 脱衣处理(MASTER, "变成只穿内衣的样子")
	ENDIF
;身体测定する
ELSEIF RESULT == 824 && MEASUREMENTCHECK(CFLAG:TARGET:当前位置)
	CALL ASK_M(@"测定%NAME_OUTPUT_TRANSLATION("CALLNAME", MASTER)%",1,@"测定%NAME_OUTPUT_TRANSLATION("CALLNAME", TARGET)%",1,"放弃",1)
	SELECTCASE RESULT
		CASE 0
			CALL SOMATOMETRY(MASTER)
		CASE 1
			CALL SOMATOMETRY(TARGET)
		CASE 2
	ENDSELECT
	RETURN 0
;内衣收夺指令し
ELSEIF RESULT == 825 && TFLAG:胖次收夺
	IF !FLAG:70
		;CALL SIMATTYAUOJISAN
	ELSE
		FOR LOCAL,1,CHARANUM
			IF CFLAG:LOCAL:当前位置 == CFLAG:MASTER:当前位置 && !CFLAG:LOCAL:没穿内裤 && EQUIP:LOCAL:下半身内衣２
				SIF !PANTS_ALREADY_COLLECTED(LOCAL)
					SETCOLOR C_PINK
				PRINTFORMW 脱下%NAME_OUTPUT_TRANSLATION("CALLNAME", LOCAL)%的%PANTSNAME(EQUIP:LOCAL:下半身内衣２, LOCAL)%放在口袋里
				RESETCOLOR
				CALL PANTS_GET(LOCAL)
			ENDIF
		NEXT
		TFLAG:Info表示中 = 0
		RETURN 0
	ENDIF
ELSEIF RESULT == 826
	IF TEQUIP:挑逗模式
		TEQUIP:挑逗模式 = 0
	ELSE
		IF TCVAR:MASTER:要去了
			PRINTFORMW 已经没有那么做的余裕了！
	 	ELSEIF (EX:20 + EX:21 + EX:22 + EX:23 + EX:24) > 0
	 		PRINTFORMW 在挑逗中
	 	ELSE
	 		TEQUIP:挑逗模式 = 1
	 	ENDIF
	 ENDIF
;过激な恶作剧
ELSEIF RESULT == 830 && CFLAG:恶作剧 < 2
	PRINTFORML %NAME_OUTPUT_TRANSLATION("CALLNAME", MASTER)%将%NAME_OUTPUT_TRANSLATION("CALLNAME", TARGET)%的衣服慢慢地袒露开来
	EQUIP:0 = 0
	SIF CFLAG:TARGET:睡眠奸 < 2
	CFLAG:TARGET:睡眠奸 = 2
	CALL SET_PRANK(2,TARGET,1)
	CALL 脱衣处理(TARGET, "全裸", "「不显示」")
	FOR LOCAL,1,CHARANUM
		CALL CLOTHES_SETTING_TRAIN(LOCAL)
	NEXT
	RETURN 1
;test
;ELSEIF RESULT == 99999
;	TIME:5 = 4
;	RETURN 1
;摆脱
ELSEIF RESULT == 850
	SELECTCOM = RESULT
	TFLAG:3 = SELECTCOM
	DOTRAIN 999
;所在地察觉=============================================================================================================================
ELSEIF RESULT == 811 && TALENT:MASTER:所在地察觉 && AT_HOME(MASTER) && (GETBIT(TALENT:MASTER:所在地察觉, 1) || !(CFLAG:诶嘿嘿 || CFLAG:恶作剧 || CFLAG:陪睡中))
	TFLAG:206 = CFLAG:MASTER:当前位置
	CALL HITOSAGASI()
	INPUT
	;下记状态中は所在地表示だけ行い移动しない
	IF CFLAG:诶嘿嘿 || CFLAG:恶作剧 || CFLAG:陪睡中
		RETURN 1
	ENDIF
	IF GROUPMATCH(RESULT, 0, CFLAG:MASTER:当前位置)
		TFLAG:Info表示中 = 0
		RETURN 1
	ENDIF
	IF MAP_CAN_MOVE(RESULT) == 0
		IF TFLAG:移动不能信息 == 999
			IF LOCKPICK_SYSTEM > 0
				CAN_BE_UNLOKED_ROOM_SAVE = RESULT
				FOR LOCAL, MINROOM(), MAXROOM
					IF CAN_MOVE(LOCAL, CAN_BE_UNLOKED_ROOM_SAVE) & 1 && IN_HOME(LOCAL) == 1
						CALL SKIP_MOVE(CFLAG:MASTER:当前位置, LOCAL)
						IF CFLAG:MASTER:当前位置 == LOCAL
							PRINTFORML 锁上了
							PRINTFORML 要尝试开锁吗？
							VARSET RESULT
							CALL ASK_YN
							SIF RESULT == 1
								BREAK
							VARSET RESULT
							IF PRIVATEROOM:(LOCAL % 100) > 0
								IF CFLAG:(PRIVATEROOM:(LOCAL % 100)):地位 >= 500
									CALL LOCKPICK(1)
								ELSE
									CALL LOCKPICK()
								ENDIF
							ELSE
								CALL LOCKPICK()
							ENDIF
							IF RESULT == 1
								PRINTFORMW 开锁成功
								CALL SKIP_MOVE(CFLAG:MASTER:当前位置, CAN_BE_UNLOKED_ROOM_SAVE)
							ELSE
								PRINTFORMW 没能打开锁 可恶
							ENDIF
							CLEARLINE 2
							REUSELASTLINE
						ENDIF
						BREAK
					ENDIF
					IF LOCAL == MAXROOM - 1
						PRINTFORMW 找不到门 可恶
						CLEARLINE 2
						REUSELASTLINE
						NEXTCOM = -1
						RETURN 0
					ENDIF
				NEXT
				TFLAG:Info表示中 = 0
				RETURN 1
			ELSE
				PRINTFORMW 锁上了 可恶
				CLEARLINE 2
				REUSELASTLINE
			ENDIF
		ELSE
			TRYCALLFORM MAP_CANNOT_WORD_{MAIN_MAP}(RESULT)
		ENDIF
		TFLAG:移动不能信息 = 0
		NEXTCOM = -1
		RETURN 0
	ELSEIF IN_HOME(RESULT) == 1
		;NEXTCOM = GETNUM(TRAINNAME, "移动")
		;TFLAG:195 = RESULT
		CALL SKIP_MOVE(CFLAG:MASTER:当前位置, RESULT)
	ENDIF
	TFLAG:Info表示中 = 0
	RETURN 1
;====================================================
ELSEIF RESULT == 812 && TALENT:MASTER:脏房间察觉 && AT_HOME(MASTER) && !(CFLAG:诶嘿嘿 || CFLAG:恶作剧 || CFLAG:陪睡中)
	TFLAG:206 = CFLAG:MASTER:当前位置
	CALL OHEYA_CHECK
	INPUT
	IF GROUPMATCH(RESULT, 0, CFLAG:MASTER:当前位置)
		TFLAG:Info表示中 = 0
		RETURN 1
	ENDIF
	IF MAP_CAN_MOVE(RESULT) == 0
		IF TFLAG:移动不能信息 == 999
			IF LOCKPICK_SYSTEM > 0
				CAN_BE_UNLOKED_ROOM_SAVE = RESULT
				FOR LOCAL, MINROOM(), MAXROOM
					IF CAN_MOVE(LOCAL, CAN_BE_UNLOKED_ROOM_SAVE) & 1 && IN_HOME(LOCAL) == 1
						CALL SKIP_MOVE(CFLAG:MASTER:当前位置, LOCAL)
						IF CFLAG:MASTER:当前位置 == LOCAL
							PRINTFORML 锁上了
							PRINTFORML 要尝试开锁吗？
							VARSET RESULT
							CALL ASK_YN
							SIF RESULT == 1
								BREAK
							VARSET RESULT
							IF PRIVATEROOM:(LOCAL % 100) > 0
								IF CFLAG:(PRIVATEROOM:(LOCAL % 100)):地位 >= 500
									CALL LOCKPICK(1)
								ELSE
									CALL LOCKPICK()
								ENDIF
							ELSE
								CALL LOCKPICK()
							ENDIF
							IF RESULT == 1
								PRINTFORMW 开锁成功
								CALL SKIP_MOVE(CFLAG:MASTER:当前位置, CAN_BE_UNLOKED_ROOM_SAVE)
							ELSE
								PRINTFORMW 锁上了 可恶
							ENDIF
							CLEARLINE 2
							REUSELASTLINE
						ENDIF
						BREAK
					ENDIF
					IF LOCAL == MAXROOM - 1
						PRINTFORMW 找不到门 可恶
						CLEARLINE 2
						REUSELASTLINE
						NEXTCOM = -1
						RETURN 0
					ENDIF
				NEXT
				TFLAG:Info表示中 = 0
				RETURN 1
			ELSE
				PRINTFORMW 锁上了 可恶
				CLEARLINE 2
				REUSELASTLINE
			ENDIF
		ELSE
			TRYCALLFORM MAP_CANNOT_WORD_{MAIN_MAP}(RESULT)
		ENDIF
		TFLAG:移动不能信息 = 0
		NEXTCOM = -1
		RETURN 0
	ELSEIF IN_HOME(RESULT) == 1
		CALL SKIP_MOVE(CFLAG:MASTER:当前位置, RESULT)
	ENDIF
	TFLAG:Info表示中 = 0
	RETURN 1
ELSEIF RESULT == 813 && GETBIT(TALENT:MASTER:色欲察觉, 1) && !CFLAG:诶嘿嘿
	PRINTFORML 花费气力来寻找性欲高涨的少女。
	;CALL ASK_M("放弃",1,"发动",1,"触媒を使って发动",CSTR:MASTER:12 != "")
	CALL ASK_M("放弃",1,"发动",1,"使用触媒发动",FLAG:胖次输送)
	SELECTCASE RESULT
		CASE 0
			RETURN -1
		CASE 1,2
			PRINTFORMW %NAME_OUTPUT_TRANSLATION("CALLNAME", MASTER)%\@RESULT == 2 ?对着脱下的胖次、 # \@集中精神！
			SETCOLOR 255,100,255
			FONTBOLD
			FOR LOCAL,1,CHARANUM
				IF CFLAG:LOCAL:积攒度 >= 1000
					PRINTFORML %NAME_OUTPUT_TRANSLATION("CALLNAME", LOCAL)%已经忍耐到极限了…！
					SIF CFLAG:LOCAL:当前位置 == SUKIMA() && RESULT == 2
						PRINTFORML 然后、%NAME_OUTPUT_TRANSLATION("CALLNAME", LOCAL)%现在在家里！　……大概。
				ELSEIF CFLAG:LOCAL:积攒度 >= 700
					PRINTFORML %NAME_OUTPUT_TRANSLATION("CALLNAME", LOCAL)%饥渴难耐…！
					SIF CFLAG:LOCAL:当前位置 == SUKIMA() && RESULT == 2
						PRINTFORML 然后、%NAME_OUTPUT_TRANSLATION("CALLNAME", LOCAL)%现在在家里！　……大概。
				ELSEIF CFLAG:LOCAL:积攒度 >= 400
					PRINTFORML %NAME_OUTPUT_TRANSLATION("CALLNAME", LOCAL)%欲求不满…！
					SIF CFLAG:LOCAL:当前位置 == SUKIMA() && RESULT == 2
						PRINTFORML 然后、%NAME_OUTPUT_TRANSLATION("CALLNAME", LOCAL)%现在在家里！　……大概。
				ENDIF
			NEXT
			RESETCOLOR
			FONTREGULAR
			IF RESULT == 1
				BASE:MASTER:气力 -= 500
			ELSE
				PRINTFORMW %NAME_OUTPUT_TRANSLATION("CALLNAME", MASTER)%在放松下来的时候、手中的胖次慢慢的融化在空气中了
				;CSTR:MASTER:12 =
				;FLAG:胖次输送 = 0
				;VARSET PANTS_TEMP
				CALL CLEAR_HAVE_COLLECTION()
				BASE:MASTER:气力 -= 50
			ENDIF
			SIF !FLAG:70
				TIME += 1
			TFLAG:Info表示中 = 0
			RETURN 1
	ENDSELECT

;过滤器----------------------------
ELSEIF RESULT == 839
	FLAG:家事过滤器 = !FLAG:家事过滤器
	RETURN -1
ELSEIF RESULT == 840
	CFLAG:allowKojoCom = !CFLAG:allowKojoCom
ELSEIF RESULT == 4000
	CFLAG:自动喘息 ++
	SIF CFLAG:自动喘息 > 2
		CFLAG:自动喘息 = 0
	RETURN -1
ELSEIF RESULT >= 831 && RESULT <= 843
	CFLAG:TARGET:(RESULT - 830 + 590) = !CFLAG:TARGET:(RESULT - 830 + 590)
	RETURN -1
;魔改内容，显示接触
ELSEIF RESULT == 901
	CALL PRINT_TOUCH_INFO
;魔改完成
;未完成---------------------------- 

;ターゲット变更
ELSEIF RESULT >=1001 && RESULT < (CHARANUM + 1000) && CFLAG:(RESULT - 1000):同室
	;立绘种类切り替え
	SIF RESULT - 1000 == TARGET
		FLAG:立绘种类 = !FLAG:立绘种类
	TFLAG:104 = (RESULT - 1000)
;ストーキング对象切り替え
ELSEIF RESULT >=4001 && RESULT < (CHARANUM + 4000) && CFLAG:(RESULT - 4000):同室
	IF STALKED == TARGET
		STALKED = 0
	ELSE
		STALKED = RESULT - 4000
	ENDIF
ELSEIF RESULT >=5000 && RESULT < (CHARANUM + 5000)
	TCVAR:(RESULT - 5000):射精我慢 ++
	SIF TCVAR:(RESULT - 5000):射精我慢 > 4
		TCVAR:(RESULT - 5000):射精我慢 = 0
;一日を终える
;ELSEIF RESULT == 888
;	BEGIN AFTERTRAIN
ELSEIF RESULT == 889
	PRINTFORML 请输入要显示的角色名
	INPUTS
	IF !SPRITECREATED(RESULTS)
		PRINTFORML 没有这个角色
	ELSE
		CALL PRINT_IMAGE(@"%RESULTS%")
	ENDIF
	WAIT
;神社に诱う
ELSEIF RESULT == 990 && CAN_DATE(TARGET)
	CALL 外出先から诱えるか(TARGET)
	IF !RESULT
		RETURN 1
	ELSE
		CALL 回家の时间经过
		CALL SET_DATE(99,TARGET)
		CFLAG:TARGET:当前位置 = ENTRANCE
		CFLAG:MASTER:当前位置 = ENTRANCE
		CFLAG:TARGET:约会中 = MAIN_MAP
		CFLAG:MASTER:约会中 = MAIN_MAP
		CFLAG:TARGET:同行 = 60
		CFLAG:MASTER:同行 = 60
		IF TARGET == 93 && !GETBIT (FLAG:泳池, 0)
			TIME += 30
			BASE:MASTER:体力 = MAX(BASE:MASTER:体力 - 500,500)
		ENDIF
		IF CFLAG:TARGET:败犬 && (!TALENT:TARGET:恋慕 && !TALENT:TARGET:思慕 && !TALENT:TARGET:爱欲)
			PRINTFORMW 把有些不情愿的%NAME_OUTPUT_TRANSLATION("CALLNAME", TARGET)%强行带了回去
		ELSE
			PRINTFORMW 带着有空的%NAME_OUTPUT_TRANSLATION("CALLNAME", TARGET)%一起回家了
		ENDIF
		RETURN 1
	ENDIF
;房间上锁,とりあえず封印
ELSEIF RESULT == 991
;	FLAG:房间上锁 = !FLAG:房间上锁
	RETURN 0
;邀请去约会
ELSEIF RESULT == 992 && CAN_DATE(TARGET)
	CALL 外出先から诱えるか(TARGET)
	IF !RESULT
		RETURN 1
	ELSE
		CFLAG:MASTER:同行 = 60
		CFLAG:TARGET:同行 = 60
		CFLAG:TARGET:约会中 = CFLAG:MASTER:当前位置 / 100
		FLAG:约会的对象 = TARGET
		TFLAG:约会前好感度 = CFLAG:TARGET:好感度
		TIME += 1
		IF CFLAG:败犬
			PRINTFORMW 强行带走了不高兴的%NAME_OUTPUT_TRANSLATION("CALLNAME", TARGET)%
		ELSE
			PRINTFORMW 带着有空的%NAME_OUTPUT_TRANSLATION("CALLNAME", TARGET)%去约会了
		ENDIF
	ENDIF
;日历
ELSEIF RESULT == 993
	CALL 日历
ELSEIF RESULT == 994
	CALL SHOW_HAVE_COLLECTION()
ELSEIF RESULT == 995
	IF AT_HOME(MASTER)
		INVERTBIT FLAG:瞬间移动, 1
	ELSE
		INVERTBIT FLAG:瞬间移动, 0
	ENDIF
;自动扫除
ELSEIF RESULT == 996
	IF AT_HOME(MASTER)
		INVERTBIT FLAG:自动扫除, 1
	ELSE
		INVERTBIT FLAG:自动扫除, 0
	ENDIF
;时间停止解除
ELSEIF RESULT == 999 && FLAG:70 == 1 && !CFLAG:诶嘿嘿
	CALL 时间停止解除
	;はだけフラグをオフ
	TEQUIP:2 = 0
	TEQUIP:上半身裸露状态 = 0
	;角色全员の服再セッティング
	FOR LOCAL,0,CHARANUM
		CALL CLOTHES_SETTING_TRAIN(LOCAL)
		;上衣脱衣完毕フラグをオフ
		TEQUIP:LOCAL:5 = 0
		;身体测定结束
		SIF CFLAG:LOCAL:身体测定 == 2
			CFLAG:LOCAL:身体测定 = 1
	NEXT
;逢濑结束
ELSEIF RESULT == 999 && CFLAG:诶嘿嘿
	SIF CFLAG:恶作剧 == 2
		 CFLAG:MASTER:恶作剧 = 2
	SIF CFLAG:MASTER:恶作剧 == 2
		CALL SET_PRANK(0,TARGET,2)
	IF CFLAG:诶嘿嘿 == 2
			SELECTCOM = RESULT
			TFLAG:3 = SELECTCOM
			DOTRAIN 999
	ELSE
		IF FLAG:70 == 1
			FOR LOCAL,0,CHARANUM
				SIF CFLAG:诶嘿嘿 == 2
					CALL SET_DERAY(5,LOCAL)
				CALL ENDUFUFU(LOCAL)
			NEXT
			TFLAG:106 = 0
		ELSE
			CALL AFTER_AFFAIR
			FOR LOCAL,1,CHARANUM
				;诶嘿嘿结束口上呼び出し
				SIF CFLAG:LOCAL:诶嘿嘿 == 1 && (CFLAG:LOCAL:恶作剧 < 1 || CFLAG:LOCAL:眠奸口上有)
					CALL KOJO_MESSAGE_SEND("EVENT",15,LOCAL,2,0)
				CALL ENDUFUFU(LOCAL)
			NEXT
			TFLAG:106 = 0
		ENDIF
		;MASTERとの接触位置をリセット
		CALL TOUCH_SET(0,0,0,1)
		;はだけフラグをオフ
		TEQUIP:2 = 0
		TEQUIP:上半身裸露状态 = 0
		;角色全员の服再セッティング
		FOR LOCAL,0,CHARANUM
			CALL CLOTHES_SETTING_TRAIN(LOCAL)
			;上衣脱衣完毕フラグをオフ
			TEQUIP:LOCAL:5 = 0
		NEXT
		SIF TFLAG:泡澡堂
			CALL 泡澡堂结束判定("指令から结束")
		RETURN 1
	ENDIF
;恶作剧结束
ELSEIF RESULT == 999 && CFLAG:恶作剧 && !CFLAG:诶嘿嘿
	FOR LOCAL,0,CHARANUM
		CALL SET_PRANK(0,LOCAL,1)
	NEXT
	;MASTERとの接触位置をリセット
	CALL TOUCH_SET(0,0,0,1)
	;はだけフラグをオフ
	TEQUIP:2 = 0
	TEQUIP:上半身裸露状态 = 0
	;角色全员の服再セッティング
	FOR LOCAL,0,CHARANUM
		CALL CLOTHES_SETTING_TRAIN(LOCAL)
		;上衣脱衣完毕フラグをオフ
		TEQUIP:LOCAL:5 = 0
	NEXT
	RETURN 1
;添い寝结束
ELSEIF RESULT == 999 && CFLAG:陪睡中
	FOR LOCAL,0,CHARANUM
		CALL SET_TOGETHER(0,LOCAL,1)
	NEXT
	;MASTERとの接触位置をリセット
	CALL TOUCH_SET(0,0,0,1)
	CALL KOJO_MESSAGE_SEND("EVENT",16,TARGET,2,0)
	;衰弱なら寝る
	SIF CFLAG:TARGET:衰弱 && !TCVAR:TARGET:休憩中
		CALL CHARA_SLEEP, TARGET,0

	;はだけフラグをオフ
	TEQUIP:2 = 0
	TEQUIP:上半身裸露状态 = 0
	;角色全员の服再セッティング
	FOR LOCAL,0,CHARANUM
		CALL CLOTHES_SETTING_TRAIN(LOCAL)
		;上衣脱衣完毕フラグをオフ
		TEQUIP:LOCAL:5 = 0
	NEXT
	RETURN 1
;约会结束
ELSEIF RESULT == 999 && CHK_DATENOW(CFLAG:MASTER:约会中) && CFLAG:MASTER:当前位置 != OMANEKIBEYA()
	PRINTL 要回去吗？
	PRINTL [1] - 回家
	PRINTL [0] - 不回去
	INPUT
	IF !RESULT
		RETURN 0
	ELSE
	CALL 从外面回家
	ENDIF
	RETURN 1
ELSEIF RESULT == 3000
	TFLAG:PALAM非表示 = !TFLAG:PALAM非表示
ELSEIF RESULT == 3001
	TFLAG:Status非表示 = !TFLAG:Status非表示
ELSEIF RESULT == 3002
	TFLAG:USERCOM非表示 = !TFLAG:USERCOM非表示
ELSEIF RESULT == 3003
	TFLAG:LOOK非表示 = !TFLAG:LOOK非表示
	
;リソース表示关联
ELSEIF RESULT == 3100
	;表示设定の切り替え
	FLAG:画像表示设定 = !FLAG:画像表示设定
ELSEIF RESULT == 3101
	;画像表示人数 -
	FLAG:画像表示 = MAX(FLAG:画像表示-1,1)
	
ELSEIF RESULT == 3102
	;画像表示人数 +
	FLAG:画像表示 = MIN(FLAG:画像表示+1,10)
ELSEIF RESULT == 3103
	;表示位置切り替え
	FLAG:画像表示位置 = !FLAG:画像表示位置

ELSEIF RESULT == 3104
	;框表示 ON/OFF
	FLAG:画像框表示 = !FLAG:画像框表示
ELSEIF RESULT == 3105
	FLAG:立绘种类 = !FLAG:立绘种类
ELSEIF RESULT == 3106
	isModifier = MAX(isModifier - 10, -50)
ELSEIF RESULT == 3107
	isModifier = MIN(isModifier + 10, 50)
ELSEIF RESULT == 3108
	FLAG:巨乳差分表示 = !FLAG:巨乳差分表示
ELSEIF RESULT == 3109
	FLAG:追加EFFECT = !FLAG:追加EFFECT
ELSEIF RESULT == 3110
	CFLAG:TARGET:应用差分替换 ++
	IF FLAG:立绘种类
		SIF CFLAG:TARGET:别颜有 < CFLAG:TARGET:应用差分替换
			CFLAG:TARGET:应用差分替换 = 0
	ELSE
		SIF CFLAG:TARGET:别立ち有 < CFLAG:TARGET:应用差分替换
			CFLAG:TARGET:应用差分替换 = 0
	ENDIF
	;CFLAG:TARGET:应用差分替换 = !CFLAG:TARGET:应用差分替换
ELSEIF RESULT == 3111
	IF FLAG:多尺寸
		FLAG:多尺寸 = !FLAG:多尺寸
		默认角色画像横幅 = 180
	ELSEIF 默认角色画像横幅 == 180
		默认角色画像横幅 = 270
	ELSEIF 默认角色画像横幅 == 270
		默认角色画像横幅 = 360
	ELSEIF 默认角色画像横幅 == 360
		默认角色画像横幅 = 540
	ELSEIF 默认角色画像横幅 == 540
		默认角色画像横幅 = 720
	ELSE
		FLAG:多尺寸 = !FLAG:多尺寸
	ENDIF
; --- alter xray ---
ELSEIF RESULT == 3999
	IF !FLAG:XRay_show
		FLAG:XRay_show = 4
	ELSE
		FLAG:XRay_show = (FLAG:XRay_show+1)%8
	ENDIF
; --- end ---
ELSEIF RESULT == 9999
	FOR LOCAL,1,CHARANUM
		PRINTFORMLC %NAME_OUTPUT_TRANSLATION("CALLNAME", LOCAL)% 当前位置：{CFLAG:LOCAL:当前位置}
	NEXT
; --- 魔改内容 - 存档操作 ---
ELSEIF RESULT == 10000
	CALL Real_Time_Save(1001, 1)
ELSEIF RESULT == 10001
	CALL Real_Time_Save(1002, 1)
ELSEIF RESULT == 10002
	CALL Real_Time_Save(1003, 1)
; --- 魔改内容 - 双重play
ELSEIF Double_Play == 1 && INRANGE(RESULT, 921, 924)
	IF RESULT == 921
		TRYCALL 双重口交
	ELSEIF RESULT == 922
		TRYCALL 双重乳交
	ELSEIF RESULT == 923
		TRYCALL 双重素股
	ELSEIF RESULT == 924
		TRYCALL 交互插入
	ENDIF
ELSEIF RESULT == 11500
	CALL Paper_recorded_an_urban_legend
ELSEIF RESULT == 11501
	CALL 告白之神
ENDIF
TFLAG:Info表示中 = 0
RETURN 0

;FileName_USERCOM.ERB ------------------------------ Rev1.00
;TARGET变更处理
;CALL		USER
;ARG		VOID
;RETURN		VOID
;COMMENT	
;-----------------------------------------------------------
@TARGET_CHANGE
PRINTFORML 做了%NAME_OUTPUT_TRANSLATION("CALLNAME", TARGET)%的对手
PRINTL [0] - 返回
FOR LOCAL,1,CHARANUM
	SIF CFLAG:LOCAL:当前位置 == CFLAG:MASTER:当前位置
		PRINTFORML [{LOCAL}] - %NAME_OUTPUT_TRANSLATION("CALLNAME", LOCAL)% (好感度:{CFLAG:LOCAL:2})
NEXT
INPUT
IF RESULT <= 0 || RESULT >= CHARANUM
	RETURN 0
ELSEIF CFLAG:RESULT:当前位置 == CFLAG:MASTER:当前位置
	TFLAG:104 = RESULT
ENDIF

;----------------------------------------------------------
;FileName_USERCOM.ERB ------------------------------ Rev1.00
;履历表示处理（未实装）
;CALL		SYSTEM
;ARG		VOID
;RETURN		VOID
;COMMENT	
;-----------------------------------------------------------
@SHOW_EQUIP
WAIT

;FileName_USERCOM.ERB ------------------------------ Rev1.00
;日常指令の成否判定
;CALL					USER
;ARG:0（条件最大值		指令事の成否条件の最大值
;ARG:1（成功值			指令事の成功值
;ARG:2（大成功补正值	指令事の大成功に对する补正值
;RETURN		VOID
;COMMENT	各指令に散らばっている成否判定を批量
;-------------------------------------------------
@SUC_FAIL(条件最大值,成功值,大成功补正值)
#DIM 条件最大值
#DIM 条件值
#DIM 成功值
#DIM 大成功补正值

SIF !条件最大值
	条件最大值 = 100

条件值 = RAND:条件最大值

SIF !成功值
	成功值 = MIN(90 + GET_SUCCESS_RATE() / 5, 99)

SELECTCASE TFLAG:192
	;通常
	CASE 0
		;大成功
		IF 条件值 <= 9 + 大成功补正值
			TFLAG:193 = 1
		;失败
		ELSEIF 条件值 >= 成功值
			TFLAG:193 = -1
		;成功
		ELSE
			TFLAG:193 = 0
		ENDIF
	;强制成功or大成功(强制成功时は大成功しやすいように
	CASE 1
		;大成功
		IF 条件值 <= 19 + 大成功补正值 / 2
			TFLAG:193 = 1
		;成功
		ELSE
			TFLAG:193 = 0
		ENDIF
	;强制失败or指令结束
	CASE -1,-2
		TFLAG:193 = -1
ENDSELECT
条件最大值 = 0
条件值 = 0
成功值 = 0
大成功补正值 = 0

@SOMATOMETRY(ARG)
PRINTFORML 进行%NAME_OUTPUT_TRANSLATION("CALLNAME", ARG)%的身体测定
CALL MAKE_SIZE(ARG)
CFLAG:ARG:身体测定 = 1
CALL SHOW_SIZE(ARG)
CALL ASK_YN("再测定一次","这样就行")
IF !RESULT
	CFLAG:ARG:身体测定 = 2
	RESTART
ENDIF

