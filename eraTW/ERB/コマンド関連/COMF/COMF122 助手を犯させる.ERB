;-------------------------------------------------
;让助手侵犯
;助手による指令、及びレズプレイ、レベル4
;-------------------------------------------------
@COM122
PRINTL 让助手侵犯
;-------------------------------------------------
;实行判定处理
;-------------------------------------------------
A = 0
S = 0

;全部の命令に共通の要素を考虑
;(顺从が高いと命令に从いやすいなど)
CALL COM_ORDER

;ABL:欲望
IF ABL:欲望
	SIF S
		PRINT  + 
	A += ABL:欲望 * 2
	PRINT 欲望
	PRINTV 'LV,ABL:欲望,'(,ABL:欲望 * 2,')
	S = 1
ENDIF
;ABL:侍奉精神
IF ABL:侍奉精神
	SIF S
		PRINT  + 
	A += ABL:侍奉精神 * 4
	PRINT 侍奉精神
	PRINTV 'LV,ABL:侍奉精神,'(,ABL:侍奉精神 * 4,')
	S = 1
ENDIF

IF MARK:快乐刻印
	SIF S
		PRINT  + 
	A += MARK:快乐刻印 * 2
	PRINT 快乐刻印
	PRINTV 'LV,MARK:快乐刻印,'(,MARK:快乐刻印 * 2,')
	S = 1
ENDIF
;PALAM:情欲
IF GETPALAMLV(PALAM:情欲,5)
	SIF S
		PRINT  + 
	A += GETPALAMLV(PALAM:情欲,5) * 2
	PRINT 情欲
	PRINTV 'LV,GETPALAMLV(PALAM:情欲,5),'(,GETPALAMLV(PALAM:情欲,5) * 2,')
	S = 1
ENDIF
;害羞
IF TALENT:羞耻心 > 0
	PRINT  - 
	A -= 1
	PRINT 害羞
	PRINTV '(,1,')
	S = 1
ENDIF
;献身的
IF TALENT:献身的
	SIF S
		PRINT  + 
	A += 6
	PRINT 献身的
	PRINTV '(,6,')
	S = 1
ENDIF
;接受快感
IF TALENT:快感应答 > 0
	SIF S
		PRINT  + 
	A += 2
	PRINT 接受快感
	PRINTV '(,2,')
	S = 1
ENDIF
;否定快感（淫乱、娼妇で无效）
IF TALENT:快感应答 < 0 && !TALENT:淫乱
	PRINT  - 
	A -= 2
	PRINT 否定快感
	PRINTV '(,2,')
	S = 1
ENDIF
;淫乱
IF TALENT:淫乱 && ASSIPLAY == 0
	SIF S
		PRINT  + 
	A += 5
	PRINT 淫乱
	PRINTV '(,5,')
	S = 5
ENDIF
;娼妇
IF TALENT:淫乱 > 1 && ASSIPLAY == 0
	SIF S
		PRINT  + 
	A += 5
	PRINT 娼妇
	PRINTV '(,5,')
	S = 5
ENDIF

;助手が处女
IF TALENT:PLAYER:处女
	PRINT  - 
	A -= 15
	PRINT 助手是处女
	PRINTV '(,15,')
	S = 1
ENDIF

;合计を表示(40以上で实行)
PRINT  = 
PRINTV A

V = 40
SIF A < V
	PRINT  < 
SIF A == V
	PRINT  = 
SIF A > V
	PRINT  > 
PRINT 实行值
PRINTV V

WAIT

;实行できない
SIF A < V
	RETURN 0

;-------------------------------------------------
;实行决定
;-------------------------------------------------
STR:0 = 让助手侵犯
;-------------------------------------------------
;COM别FLAGの设定
;-------------------------------------------------
;行为者
TCVAR:116 = TARGET
;TCVAR:0 射精对象フラグ（ビット0=TARGET 1=PLAYER 2=MASTER 3=ASSI）
;TCVAR:1 予备射精对象フラグ（ビットを使いたくない人用、CFLAG:100に翻译されます）	（1=TARGET 2=PLAYER 3=MASTER 4=ASSI 5=TARGET+ASSI 6=MASTER+ASSI）
;TCVAR:2 射精部位フラグ（-1=避孕套 1=膣内 2=肛门 3=手淫 4=口淫 5=乳交 6=素股 7=足交 8=体表 9=肛门侍奉 10=道具 11=触手 12=Ａ调教 13=Ｖ调教）

SETBIT TCVAR:TARGET:0, 3
TCVAR:TARGET:2 = 1
;强度
TCVAR:TARGET:4 = 2000

TEQUIP:ASSI:50 = TARGET
;-------------------------------------------------
;ソース追加处理
;-------------------------------------------------
;消费体力、气力
DOWNBASE:体力 += 50
DOWNBASE:气力 += 150

SOURCE:快Ｃ = 400
SOURCE:性行动 = 500
SOURCE:达成 = 400
SOURCE:屈从 = 700
SOURCE:偏离正轨 = 500
SOURCE:反感 = 500


;-------------------------------------------------
;特殊ソース处理
;-------------------------------------------------
;圧抑、抵抗持ちには、抑郁ソース追加
SIF TALENT:自己爱 < 0 || TALENT:抵抗
	SOURCE:郁闷 += 500

;助手が处女の场合、屈服偏离正轨が倍化し、顺从が2になる。ただし一度きり
IF TALENT:PLAYER:处女 == 1
	TIMES SOURCE:屈从 , 5.00
	TIMES SOURCE:偏离正轨 , 3.00
	TALENT:PLAYER:处女 = 0
	IF !GETBIT(CFLAG:3,4)
		;异常经验追加（一回きり）
		EXP:异常经验 += 1
		SETBIT CFLAG:3,4
	ENDIF
	IF ABL:顺从 < 2
		PRINTFORML 然后%ABLNAME:0%变为了2
		ABL:顺从 = 2
	ENDIF
ENDIF
EXP:ASSI:Ｖ经验 += 1
;-------------------------------------------------
;污れの处理
;-------------------------------------------------
;射精に关系なく行われる处理はここから
IF HAS_PENIS(TARGET)
	;奴隷のＰ⇔调教者のＶ的污垢が移动
	STAIN:2 |= STAIN:PLAYER:3
	STAIN:PLAYER:3 |= STAIN:2
ENDIF

;-------------------------------------------------
;経験の处理
;-------------------------------------------------
;同性爱　レズなら返回值1ゲイなら返回值2
SIF HETEROSEX(TARGET,ASSI)
	EXP:(50 + HETEROSEX(TARGET,ASSI)) += 10

RETURN 1

;-------------------------------------------------
;实行判定
;-------------------------------------------------
@COM_ABLE122
;让助手侵犯实行判定
SIF !TFLAG:100
	RETURN 0
;批量管理
SIF GLOBAL_COMABLE(122)
	RETURN RESULT
;助手じゃないとダメ
SIF PLAYER != ASSI
	RETURN 0
;助手が男人だとダメ
SIF !(TALENT:ASSI:2 & 1)
	RETURN 0
;体格差がある场合は主人が禁断的知识持ちじゃないとダメ
SIF ABS(TALENT:体型 - TALENT:ASSI:体型) > 2 && TALENT:MASTER:禁断的知识 == 0
	RETURN 0
;男人、半人半妖、扶她、もしくは穿戴式假阴茎がないとダメ
SIF !(HAS_PENIS(TARGET)) && ITEM:PBAND == 0
	RETURN 0
;飞机杯使用中はダメ
SIF TEQUIP:12
	RETURN 0
;下半身内衣着衣
SIF TEQUIP:0 & 4
	RETURN 0
;浴室PLAY中は气垫床が无いとダメ
IF TEQUIP:31
	SIF ITEM:20 == 0 && NOITEM == 0
		RETURN 0
ENDIF
;停止中は不可
SIF FLAG:70 == 1
	RETURN 0
RETURN 1

