;-------------------------------------------------
;神签
;日常系指令、レベル1
;-------------------------------------------------
;LOCAL
@COM434
VARSET LOCAL

IF !GETBIT(FLAG:999, 0)

	PRINTFORML 功德箱的一角贴着告示
	PRINTFORML ┌─────────┐
	PRINTFORML ｜　　　　　　　　　｜
	PRINTFORML ｜　抽御神签　　　　｜
	PRINTFORML ｜　　现在已经开始　｜
	PRINTFORML ｜　　　　　　　　　｜
	PRINTFORML ｜　　　　　　　　　｜
	PRINTFORML ｜　　1日1回 200円　｜
	PRINTFORML ｜　　请把钱放这里　｜
	PRINTFORML ｜　　　　　　　　　｜
	PRINTFORML └─────────┘
	PRINTFORMW 
	PRINTFORMW …
	PRINTFORMW 只要把钱投进功德箱里就行了吧、到底会从哪里出来呢？

	SETBIT FLAG:999, 0

ENDIF

IF GETBIT(FLAG:999, 1)
	PRINTFORML 抽御神签是1天1次。
	RETURN -1
ENDIF

IF MONEY < 200
	PRINTFORML 望了望钱包可是没带够钱。
	RETURN -1
ENDIF

PRINTFORML 抽御神签1回200円、要怎么做呢？
PRINTFORML [1] 抽一抽试试
PRINTFORML [0] 还是算了
PRINTFORML 
INPUT
SIF !RESULT
	RETURN -1

MONEY -= 200
TIME += 2
SETBIT FLAG:999, 1

SELECTCASE RAND:15
	CASE 0 TO 6
		PRINTL 啪嘁、啪嘁
		PRINTL 把钱扔进去并击掌合十
		PRINTW ……
		PRINTL 刷啦刷啦的有什么东西掉出来了
		PRINTW 拿到手上一看、好像是这是御神签的样子
	CASE 7 TO 11
		PRINTL 叮铃铛啷
		PRINTW 一把钱放进功德箱里……
		PRINTW 就从功德箱里飞出了御神签
	CASE 12 TO 13
		PRINTW ……
		PRINTW …
		PRINTW 我…就把刚才发生的状况 原原本本的说出来吧！
		PRINTW 『如果是为了御神签而投入香火的话就亲手把御神签抓住吧』
		PRINTW 该… 该怎么说呢 不光无法理解连被做了什么都不知道…
		PRINTW 不知道该怎么应对…
		PRINTW 那可不是催眠术啦超速度啦时间停止啦这些小儿科的东西
		PRINTW 而是领略到了更为恐怖事物的一鳞半爪…
	CASE 14
		PRINTW （嘭～）
		PRINTL 后脑勺被什么东西撞到了
		PRINTL 回过头一看、脚边有个东西裹在纸里
		PRINTW 打开一看、纸里是御神签……
		PRINTW ……请不要把御神签和石头包在一起啊
ENDSELECT

PRINTW 看了看收到的（？）御神签的内容。
PRINTW …
CALL FORTUNE

;当たり、キャッシュバックによる返金处理
IF GETBIT(FLAG:999, 10)
	PRINTL ……
	PRINTW …

	SELECTCASE RAND:15
		CASE 0 TO 4
			PRINTW 神签的最后写着奇怪的字
			PRINTL ┌─・─剪切线─・─┐
			PRINTL ｜　　　　　　　　　｜
			PRINTL ｜　幻想乡共通　　　｜
			PRINTL ｜　　　　　商品券　｜
			PRINTL ｜　　　　　　　　　｜
			PRINTL ｜　　　　　 200日元　｜
			PRINTL ｜　　　　　　　　　｜
			PRINTL ｜　可以找零　｜
			PRINTL ｜　　　无使用期限　｜
			PRINTL └─────────┘
			PRINTW 仔细想想这东西就是所谓的代金券吧？
		CASE 5 TO 6
			PRINTL 咻
			PRINTW 听到破空声的你突然趴了下去
			PRINTL 咚咚
			PRINTW 想着到底是什么东西回头一看、刚才投入的香火钱竟然插在了墙上
			PRINTL 如果没有注意到的话就要被刺穿了吧？
		CASE 7 TO 11
			PRINTL 叮铃铛啷♪    ○彡
			PRINTW 从功德箱里飞出了应该是刚才投进入的钱
		CASE 12 TO 13
			PRINTW ……
			PRINTW …
			PRINTW 我…就把刚才发生的状况 原原本本的说出来吧！
			PRINTW 『神签已经读完了 刚才投入的塞钱回到了手中』
			PRINTW 该… 该怎么说呢 不光无法理解连被做了什么都不知道…
			PRINTW 不知道该怎么应对…
			PRINTW 肯定不是瞬间移动啊因果逆转啊时间停止啊这些小儿科的东西
			PRINTW 而是领略到了更为恐怖事物的一鳞半爪…
		CASE 14
			PRINTW （咯噔咯噔）
			PRINTL 后脑勺被什么东西撞到了
			PRINTL 回头一看、刚才投入功德箱的钱掉到了脚下
			PRINTW 意思是明天也要过来把这钱投进去么？
	ENDSELECT
	
	MONEY += 200
	CLEARBIT FLAG:999, 10
ENDIF


RETURN 1

;-------------------------------------------------
;实行判定
;-------------------------------------------------
;神签
@COM_ABLE434
;批量管理
SIF GLOBAL_COMABLE(434)
	RETURN RESULT
SIF !TFLAG:100
	RETURN 0
;气力0では不可
SIF BASE:MASTER:气力 <= 0
	RETURN 0
;功德箱（神签の代金入れも兼ねている）でないと引けない
SIF !OMIKUJI_SPOT(CFLAG:MASTER:当前位置)
	RETURN 0
SIF CFLAG:MASTER:当前位置 != P3功德箱
	RETURN 0
;停止中は不可
SIF FLAG:70 == 1
	RETURN 0
RETURN 1

@OMIKUJI_SPOT(ARG)
#FUNCTION
;博丽神社の功德箱
SIF ARG == GET_MAP_REPLACEMENT(3)
	RETURNF 1
RETURNF 0
