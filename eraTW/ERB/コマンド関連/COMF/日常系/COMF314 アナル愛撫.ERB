;-------------------------------------------------
;肛门爱抚
;日常系指令　レベル3
;-------------------------------------------------
@COM314
;-------------------------------------------------
;COM别FLAGの设定
;-------------------------------------------------
;行为者
TCVAR:116 = PLAYER
TFLAG:理性削り = 1
;-------------------------------------------------
;ソース追加处理
;-------------------------------------------------
;消费体力、气力
IF FLAG:70 == 1
	BASE:MASTER:TSP -= 40
	SOURCE:快Ａ = 80
	IF ABL:PLAYER:指 >= 4
		SOURCE:快Ａ += 50
	ELSE
		SOURCE:快Ａ += ABL:PLAYER:指 * 10
	ENDIF
	;手を突っ込めない衣装
	IF TEQUIP:0 & 16
		TIMES SOURCE:快Ａ , 0.60
		TIMES SOURCE:情欲 , 0.60
		TIMES SOURCE:露出 , 0.60
	;裙子以外の何かを履いてる
	ELSEIF TEQUIP > 1
		TIMES SOURCE:快Ａ , 0.80
		TIMES SOURCE:情欲 , 0.80
		TIMES SOURCE:露出 , 0.80
	ENDIF
ELSE
	;口上による强制失败
	IF TFLAG:192 == -1
		RETURN -1
	ENDIF
	DOWNBASE:体力 += 40
	DOWNBASE:气力 += 100

	SOURCE:快Ａ = 80
	SOURCE:苦痛 = 50
	SOURCE:屈从 = 100
	SOURCE:露出 = 500
	SOURCE:情欲 = 170
	SOURCE:欢乐 = 50
	SOURCE:偏离正轨 = 80
	SOURCE:反感 = 1000
	SOURCE:被动 = 150 + 300 * ABL:顺从
	IF ABL:PLAYER:指 >= 4
		SOURCE:快Ａ += 50
	ELSE
		SOURCE:快Ａ += ABL:PLAYER:指 * 10
	ENDIF
	;手を突っ込めない衣装
	IF TEQUIP:0 & 16
		TIMES SOURCE:快Ａ , 0.60
		TIMES SOURCE:情欲 , 0.60
		TIMES SOURCE:露出 , 0.60
	;裙子以外の何かを履いてる
	ELSEIF TEQUIP > 1
		TIMES SOURCE:快Ａ , 0.80
		TIMES SOURCE:情欲 , 0.80
		TIMES SOURCE:露出 , 0.80
	ENDIF
	IF HITOKE(1)
		TIMES SOURCE:露出 , 2.00
		TIMES SOURCE:反感 , 2.00
	ENDIF
	;信赖
	TFLAG:98 = -7

	;-------------------------------------------------
	;特殊ソース处理
	;-------------------------------------------------
	;圧抑、抵抗持ちには、抑郁ソース追加
	SIF TALENT:自己爱 < 0 || TALENT:抵抗
		SOURCE:郁闷 += 100
ENDIF
;Aへの苦痛は先に处理しておく
SIF TCVAR:20 == 72 && !TEQUIP:六九式
	CALL PAIN_CHECK_A(TARGET)

;-------------------------------------------------
;污れの处理
;-------------------------------------------------
IF TCVAR:20 == 72 && !TEQUIP:六九式
	;奴隷のＡ⇔调教者の指的污垢が移动
	STAIN:PLAYER:0 |= STAIN:4
	STAIN:4 |= STAIN:PLAYER:0
ELSE
	;奴隷のＡ⇔调教者の指的污垢が移动
	STAIN:PLAYER:1 |= STAIN:4
	STAIN:PLAYER:1 |= STAIN:7
	STAIN:4 |= STAIN:PLAYER:1
	STAIN:7 |= STAIN:PLAYER:1
ENDIF
;-------------------------------------------------
;経験の处理
;-------------------------------------------------
IF FLAG:70 == 1
	IF HETEROSEX(TARGET,PLAYER)
		EXP:PLAYER:(50 + HETEROSEX(TARGET,PLAYER)) += 4
	ENDIF
	SIF TFLAG:60 < 2
		EXP:PLAYER:手淫经验 ++
	SIF TEQUIP:六九式 || TCVAR:20 == 72
		EXP:PLAYER:口淫经验 ++
ELSE
	IF HETEROSEX(TARGET,PLAYER)
		EXP:(50 + HETEROSEX(TARGET,PLAYER)) += 4
		EXP:PLAYER:(50 + HETEROSEX(TARGET,PLAYER)) += 4
	ENDIF
	SIF TFLAG:60 < 2
		EXP:PLAYER:手淫经验 ++
	SIF TEQUIP:六九式 || TCVAR:20 == 72
		EXP:PLAYER:口淫经验 ++
	TIME += 5
ENDIF
RETURN 1

;-------------------------------------------------
;实行判定
;-------------------------------------------------
@COM_ABLE314
;肛门爱抚实行判定
SIF !TFLAG:100
	RETURN 0
;批量管理
SIF GLOBAL_COMABLE(314)
	RETURN RESULT
;时间停止中はスキップ
IF !FLAG:70
	;亲热强度1
	SIF TCVAR:MASTER:亲热 < 2
		RETURN 0
	;睡眠中
	SIF CFLAG:睡眠
		RETURN 0
	;仕事中
	SIF CFLAG:行动 == 5
		RETURN 0
	;陪睡中
	SIF CFLAG:陪睡中
		RETURN 0
	;约会中
	SIF CHK_DATENOW(CFLAG:约会中) && CFLAG:当前位置 != OMANEKIBEYA()
		RETURN 0
	;甲斐性无しにそんな度胸はない
	SIF FLAG:甲斐性无 && !CFLAG:诶嘿嘿
		RETURN 0
ENDIF
;气力0
SIF BASE:MASTER:气力 <= 0
	RETURN 0
SIF TEQUIP:51 >= 0
	RETURN 0
;颜面骑乘肛门(腕判定回避)
SIF TCVAR:20 == 72
	RETURN 1
;六九式体势(腕判定回避)
SIF TEQUIP:六九式
	RETURN 1
;腕使用中
SIF TFLAG:61 && MASTER_POSE(SET_A,SET_YUBI) != TARGET
	RETURN 0
SIF GETBIT (TCVAR:26,4)
	RETURN 0
RETURN 1

