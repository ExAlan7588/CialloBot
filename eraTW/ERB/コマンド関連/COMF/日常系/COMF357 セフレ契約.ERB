;-------------------------------------------------
;炮友契约
;日常系指令、レベル2
;-------------------------------------------------
@COM357
#DIM 理性判定值
#DIM 欲望判定值
#DIM 酒醉い

IF GET_TARGETNUM() > 1
	DRAWLINE
	PRINTFORMW 这不是能在人前说的话
	RETURN -1
ENDIF
;告白对象确认
PRINTFORML 向%NAME_OUTPUT_TRANSLATION("CALLNAME", TARGET)%提议成为炮友。
PRINTFORMW 每天只能进行一次，成功后【思慕】将会消失。
PRINTW 可以吗？
CALL ASK_YN("放弃","告白")
IF !RESULT
	RETURN -1
ENDIF

CALL KOJO_MESSAGE_SEND("SEX_FRIEND", 0, TARGET, 0, 0, "导入")
PRINTFORMW %NAME_OUTPUT_TRANSLATION("CALLNAME", TARGET)%的心中
欲望判定值 = MIN(ABL:TARGET:欲望, 10) * 50
CALL SF_DESIRE_MOD(@"欲望{ABL:TARGET:欲望}", 欲望判定值)

欲望判定值 += MIN(ABL:TARGET:顺从, 10) * 20
CALL SF_DESIRE_MOD(@"顺从{ABL:TARGET:顺从}", 欲望判定值)

欲望判定值 += MIN(EXP:TARGET:绝顶经验, 5000) / 10
CALL SF_DESIRE_MOD(@"绝顶经验{EXP:TARGET:绝顶经验}", 欲望判定值)

欲望判定值 += GETPALAMLV(PALAM:TARGET:情欲,15) * (30 + TALENT:TARGET:快感应答 * 10)
CALL SF_DESIRE_MOD(@"情欲补正", 欲望判定值)

欲望判定值 += MAX(MARK:TARGET:快乐刻印, MARK:TARGET:时奸刻印) * 200
CALL SF_DESIRE_MOD(@"刻印补正", 欲望判定值)

IF TCVAR:TARGET:发情 || TCVAR:TARGET:媚药
	欲望判定值 += 300
	CALL SF_DESIRE_MOD(@"发情/媚药补正", 欲望判定值)
ENDIF
WAIT

理性判定值 = 1000 + BASE:TARGET:理性 / 2
CALL SF_REASON_MOD(@"理性：{BASE:TARGET:理性}", 理性判定值)

;酒醉い
酒醉い = BASE:酒气 * 100 / MAXBASE:酒气
IF 酒醉い
	SIF 酒醉い > 70
		酒醉い *= 2
	理性判定值 -= 酒醉い
	CALL SF_REASON_MOD(@"酩酊补正", 理性判定值)
ENDIF
IF !CFLAG:TARGET:既成事实 & 合意_诶嘿嘿
	理性判定值 += 300
	CALL SF_REASON_MOD(@"【合意无】补正", 理性判定值)
ENDIF

IF TALENT:TARGET:无知
	理性判定值 -= 500
	CALL SF_REASON_MOD(@"【无知】补正", 理性判定值)
ENDIF
IF TALENT:TARGET:自尊心
	理性判定值 += TALENT:TARGET:自尊心 * 150
	CALL SF_REASON_MOD(@"【自尊心】补正", 理性判定值)
ENDIF
IF TALENT:TARGET:贞操 > 0
	理性判定值 += 200
	CALL SF_REASON_MOD(@"【贞操重视】补正", 理性判定值)
ENDIF
IF TALENT:TARGET:贞操 < 0
		理性判定值 -= 200
	CALL SF_REASON_MOD(@"【不在乎贞操】补正", 理性判定值)
ENDIF
IF MARK:TARGET:反抗刻印
		理性判定值 += MARK:TARGET:反抗刻印 * 100
	CALL SF_REASON_MOD(@"【反抗刻印】补正", 理性判定值)
ENDIF
IF TALENT:TARGET:心情 < 0
	理性判定值 += 300
	CALL SF_REASON_MOD(@"【心情不快】补正", 理性判定值)
ENDIF
IF TALENT:TARGET:处女
	理性判定值 += 300
	CALL SF_REASON_MOD(@"【处女】补正", 理性判定值)
ENDIF
IF TALENT:TARGET:倒错的
	理性判定值 -= 200
	CALL SF_REASON_MOD(@"【倒错的】补正", 理性判定值)
ENDIF
IF TALENT:MASTER:谜之魅力
	理性判定值 -= 150
	CALL SF_REASON_MOD(@"%NAME_OUTPUT_TRANSLATION("CALLNAME", MASTER)%の【谜之魅力】补正", 理性判定值)
ENDIF
IF TALENT:MASTER:魅力
	理性判定值 -= 150
	CALL SF_REASON_MOD(@"%NAME_OUTPUT_TRANSLATION("CALLNAME", MASTER)%の【魅力】补正", 理性判定值)
ENDIF
IF TALENT:TARGET:难以越过的底线
	理性判定值 += 200
	CALL SF_REASON_MOD(@"【难以越过的底线】补正", 理性判定值)
ENDIF
IF OTOKOGIRAI(TARGET)
	理性判定值 += 300
	CALL SF_REASON_MOD(@"性指向补正", 理性判定值)
ENDIF
IF CFLAG:TARGET:以身体为目的
	理性判定值 -= 400
	CALL SF_REASON_MOD(@"独占爱欲的奇迹之石が妖しく辉く…！", 理性判定值)
ENDIF

RESULT = 0
CALL KOJO_MESSAGE_SEND("SEX_FRIEND", 0, TARGET, 0, 0, "补正")
IF RESULT
	理性判定值 = MAX(理性判定值 + RESULT, 0)
	CALL SHOW_REASONWALL(理性判定值)
ENDIF
PRINTFORMW 
IF 欲望判定值 > 理性判定值
	TALENT:TARGET:炮友 = 1
	TALENT:TARGET:思慕 = 0
	CALL KOJO_MESSAGE_SEND("SEX_FRIEND", 0, TARGET, 0, 0, "成功")
	CALL COLORMESSAGE(@"%NAME_OUTPUT_TRANSLATION("CALLNAME", TARGET)%成为了%NAME_OUTPUT_TRANSLATION("CALLNAME", MASTER)%的炮友……",C_PINK,1,1)
	CALL ASK_DIARY(@"向%NAME_OUTPUT_TRANSLATION("CALLNAME", TARGET)%提出炮友契约，并让她同意了")
ELSE
	CALL KOJO_MESSAGE_SEND("SEX_FRIEND", 0, TARGET, 0, 0, "失败")
	PRINTFORMW 被拒绝了……
	SOURCE:反感 += 1000
ENDIF
TIME +=10
RETURN 1

;-------------------------------------------------
;实行判定
;-------------------------------------------------
@COM_ABLE357
;停止中は不可
SIF FLAG:70
	RETURN 0
;妄想中は不可
SIF TFLAG:妄想中 == 1
	RETURN 0
;炮友契约实行判定
SIF !TFLAG:100
	RETURN 0
;批量管理
SIF GLOBAL_COMABLE(352)
	RETURN RESULT
;二人きりでないとだめ
;SIF GET_TARGETNUM() > 1
;	RETURN 0
;亲热强度2
SIF TCVAR:MASTER:亲热 < 2
	RETURN 0
;既に炮友、恋慕、爱欲はだめ
SIF TALENT:炮友 || TALENT:爱欲 || TALENT:恋慕
	RETURN 0
;恋人の场合はだめ
SIF TALENT:恋人
	RETURN 0
;SIF GETBIT(TFLAG:一日一回, 12)
;	RETURN 0
SIF TALENT:TARGET:路人
	RETURN 0
;睡眠中
SIF CFLAG:睡眠
	RETURN 0
;陪睡中
SIF CFLAG:陪睡中
	RETURN 0
;气力0
SIF BASE:MASTER:气力 <= 0
	RETURN 0
;甲斐性无しにそんな度胸はない
SIF FLAG:甲斐性无
	RETURN 0
RETURN 1

@SF_REASON_MOD(ARGS, ARG)
CALL COLORMESSAGE(@"%ARGS%",C_YELLOW,1,1)
CALL SHOW_REASONWALL(ARG)

@SF_DESIRE_MOD(ARGS, ARG)
CALL COLORMESSAGE(@"%ARGS%",C_PINK,1,1)
CALL SHOW_LOVEPOWER(ARG, 100, "肉欲")
