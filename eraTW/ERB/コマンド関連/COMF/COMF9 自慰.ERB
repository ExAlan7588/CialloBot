;-------------------------------------------------
;自慰
;爱抚系指令、レベル3
;-------------------------------------------------
@COM9
;-------------------------------------------------
;COM别FLAGの设定
;-------------------------------------------------
;行为者
TCVAR:116 = TARGET

CSTR:TARGET:10 += @"{TARGET}/"
;TCVAR:2 射精部位フラグ（-1=避孕套 1=膣内 2=肛门 3=手淫 4=口淫 5=乳交 6=素股 7=足交 8=体表 9=肛门侍奉 10=道具 11=触手 12=Ａ调教 13=Ｖ调教）
TCVAR:TARGET:2 = 3
;强度
TCVAR:TARGET:4 = 500

;-------------------------------------------------
;ソース追加处理
;-------------------------------------------------
;消费体力、气力
DOWNBASE:体力 += 5
DOWNBASE:气力 += 50

SOURCE:快Ｃ = 80
SOURCE:快Ｂ = 80
SOURCE:性行动 = 100
SOURCE:恐怖 = 200
SOURCE:露出 = 400
SOURCE:屈从 = 500
SOURCE:偏离正轨 = 300
SOURCE:反感 = 250
;振动棒
IF TEQUIP:振动棒
	SOURCE:快Ｖ += 80
	SOURCE:屈从 += 100
	SOURCE:反感 += 100
	DOWNBASE:气力 += 10
	TIMES SOURCE:快Ｃ , 0.70
	TIMES SOURCE:快Ｂ , 0.70
ENDIF
;肛用振动棒
IF TEQUIP:肛用振动棒
	SOURCE:屈从 += 150
	SOURCE:反感 += 150
	SOURCE:快Ａ += 80
	DOWNBASE:气力 += 50
	TIMES SOURCE:快Ｃ , 0.70
	TIMES SOURCE:快Ｂ , 0.70
ENDIF
;淋浴
IF TEQUIP:32
	SOURCE:快Ｃ += 50
	SOURCE:露出 += 100
	SOURCE:屈从 += 50
	SOURCE:反感 += 80
ENDIF
;ビデオ
IF TEQUIP:28
	SOURCE:液体 += 50
	SOURCE:情欲 += 100
	SOURCE:反感 += 200
ENDIF
;-------------------------------------------------
;特殊ソース处理
;-------------------------------------------------
;圧抑、抵抗持ちには、抑郁ソース追加
SIF TALENT:自己爱 < 0 || TALENT:抵抗
	SOURCE:郁闷 += 400
;-------------------------------------------------
;污れの处理
;-------------------------------------------------
;奴隷の指⇔奴隷のＢ的污垢が移动
STAIN:1 |= STAIN:5
STAIN:5 |= STAIN:1

;奴隷の指⇔奴隷のＶ的污垢が移动
STAIN:1 |= STAIN:3
STAIN:3 |= STAIN:1

;淋浴自慰の场合污れをリセット、润滑更に半分。
IF TEQUIP:32 == 1
	STAIN:1 = 0
	STAIN:2 = 2
	STAIN:3 = 1
	STAIN:4 = 8
	PALAM:4 /= 2
ENDIF

;-------------------------------------------------
;経験の处理
;-------------------------------------------------
;视频拍摄时は経験にプラス
IF TEQUIP:视频拍摄
	EXP:自慰经验 += 2
	EXP:调教自慰经验 += 2
ELSE
	EXP:自慰经验 += 1
	EXP:调教自慰经验 += 1
ENDIF
;公开自慰时は异常经验付加
IF TEQUIP:视频拍摄 && !GETBIT(CFLAG:3,0)
	EXP:异常经验 ++
	SETBIT CFLAG:3,0
ENDIF
;同性爱　レズなら返回值1ゲイなら返回值2
IF HETEROSEX(TARGET,PLAYER)
	EXP:(50 + HETEROSEX(TARGET,PLAYER)) += 4
	EXP:PLAYER:(50 + HETEROSEX(TARGET,PLAYER)) += 4
ENDIF
RETURN 1


@CAN_COM9(ARG)
SKIPDISP ARG
SIF TEQUIP:视频拍摄
	PRINT 公开
SIF TEQUIP:淋浴
	PRINT 淋浴
IF TEQUIP:振动棒 && TEQUIP:肛用振动棒
	PRINT 二穴振动棒
ELSEIF TEQUIP:振动棒
	PRINT 振动棒
ELSEIF TEQUIP:肛用振动棒
	PRINT 肛用振动棒
ENDIF

IF TEQUIP:视频拍摄 || TEQUIP:淋浴 || TEQUIP:振动棒 || TEQUIP:肛用振动棒
	PRINTL 自慰
ELSE
	PRINTL 自慰
ENDIF
;-------------------------------------------------
;实行できるかの判定
;-------------------------------------------------
VARSET A
;全部の命令に共通の要素を考虑
;(顺从が高いと命令に从いやすいなど)
CALL COM_ORDER

;ABL:欲望
IF ABL:欲望
	SIF S
		PRINT  + 
	A += ABL:欲望 * 3
	PRINT 欲望
	PRINTV 'LV,ABL:欲望,'(,ABL:欲望 * 3,')
	S = 1
ENDIF
;ABL:露出癖
IF ABL:露出癖
	SIF S
		PRINT  + 
	A += ABL:露出癖 * 4
	PRINT 露出癖
	PRINTV 'LV,ABL:露出癖,'(,ABL:露出癖 * 4,')
	S = 1
ENDIF
;ABL:自慰中毒
IF ABL:自慰中毒
	SIF S
		PRINT  + 
	A += ABL:自慰中毒 * 3
	PRINT 自慰中毒
	PRINTV 'LV,ABL:自慰中毒,'(,ABL:自慰中毒 * 3,')
	S = 1
ENDIF

IF MARK:快乐刻印
	SIF S
		PRINT  + 
	A += MARK:快乐刻印 * 3
	PRINT 快乐刻印
	PRINTV 'LV,MARK:快乐刻印,'(,MARK:快乐刻印 * 3,')
	S = 1
ENDIF

;自制心
IF TALENT:自制心
	PRINT  - 
	A -= 5
	PRINT 自制心
	PRINTV '(,5,')
	S = 1
ENDIF
;害羞
IF TALENT:羞耻心 > 0
	PRINT  - 
	A -= 5
	PRINT 害羞
	PRINTV '(,5,')
	S = 1
ENDIF
;不知羞耻
IF TALENT:羞耻心 < 0
	SIF S
		PRINT  + 
	A += 2
	PRINT 不知羞耻
	PRINTV '(,2,')
	S = 1
ENDIF
;容易自慰
IF TALENT:容易自慰
	SIF S
		PRINT  + 
	A += 5
	PRINT 容易自慰
	PRINTV '(,5,')
	S = 1
ENDIF
;接受快感
IF TALENT:快感应答 > 0
	SIF S
		PRINT  + 
	A += 5
	PRINT 接受快感
	PRINTV '(,5,')
	S = 1
ENDIF
;否定快感（淫乱、娼妇で无效）
IF TALENT:快感应答 < 0 && !TALENT:淫乱
	PRINT  - 
	A -= 5
	PRINT 否定快感
	PRINTV '(,5,')
	S = 1
ENDIF

;媚药
IF TCVAR:媚药
	SIF S
		PRINT  + 
	A += 8
	PRINT 媚药
	PRINTV '(,8,')
	S = 1
ENDIF
IF CFLAG:败犬
	SIF S
		PRINT  + 
	A += 20
	PRINT 败犬
	PRINTV '(,20,')
	S = 1
ENDIF
;合计を表示(33以上で实行)
PRINT  = 
PRINTV A

;难易度上升
;公开で+10、振动棒で+5、肛用振动棒で+5、淋浴で＋3
V = 33
SIF TEQUIP:视频拍摄
	V += 10
SIF TEQUIP:淋浴
	V += 3
SIF TEQUIP:振动棒
	V += 5
SIF TEQUIP:肛用振动棒
	V += 5

SIF A < V
	PRINT  < 
SIF A == V
	PRINT  = 
SIF A > V
	PRINT  > 
PRINT 实行值
PRINTV V

WAIT
SKIPDISP 0
;实行できない
SIF A < V
	RETURN 0
RETURN 1

;-------------------------------------------------
;实行判定
;-------------------------------------------------
@COM_ABLE9
;自慰实行判定
SIF !TFLAG:100
	RETURN 0
;批量管理
SIF GLOBAL_COMABLE(9)
	RETURN RESULT
;顺从3以下・百合属性3以下のASSIの场合自慰はできない（小恶魔ならＯＫ）
IF ASSIPLAY
	SIF (ABL:ASSI:顺从 <= 3 || ABL:ASSI:百合属性 <= 3) && TALENT:ASSI:小恶魔 == 0
		RETURN 0
ENDIF
;睡眠奸中
SIF CFLAG:恶作剧 > 1
	RETURN 0
;绳使用中は不可
SIF TEQUIP:绳
	RETURN 0
;停止中は不可
SIF FLAG:70 == 1
	RETURN 0
RETURN 1