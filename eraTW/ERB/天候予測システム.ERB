;-------------------------------------------------
;日期が第〇タームか取得
;-------------------------------------------------
@GET_TERM(ARG)
#FUNCTION

SIF !ARG
	ARG = DAY:3

SIF ARG == 31
	ARG = 30

RETURNF ((ARG - 1) / 5) + 1

;-------------------------------------------------
;当该时刻の指定分后の季节・日期・时刻を取得
;RESULT:0=季节　RESULT:1=日期　RESULT:2=时刻　
;注意 指定分は1年を超えないこと
;-------------------------------------------------
@CALCULATE_ADD_TIME(季节, 日期, 时刻, 指定分)
#DIM 季节
#DIM 日期
#DIM 时刻
#DIM 指定分
#DIM 取得季节
#DIM 取得日期
#DIM 取得时刻

取得季节 = 0
取得日期 = 0
取得时刻 = 0

取得时刻 = 时刻 + 指定分
IF 取得时刻 >= 1440
	LOCAL:0 = 取得时刻
	取得时刻 %= 1440
	取得日期 += LOCAL:0 / 1440
ENDIF

取得日期 += 日期
IF 取得日期 >= 32
	LOCAL:1 = 取得日期
	取得日期 %= 32
	取得季节 += LOCAL:1 / 32
	取得日期 += LOCAL:1 / 32
ENDIF

取得季节 += 季节
IF 取得季节 >= 5
	取得季节 = 1
ENDIF

RETURN 取得季节, 取得日期, 取得时刻

;-------------------------------------------------
;当该タームの指定ターム后の季节・タームを取得
;RESULT:0=季节　RESULT:1=ターム　
;注意 指定タームは1年を超えないこと
;-------------------------------------------------
@CALCULATE_ADD_TERM(季节, ターム, 指定ターム)
#DIM 季节
#DIM ターム
#DIM 指定ターム
#DIM 取得季节
#DIM 取得ターム

取得季节 = 0
取得ターム = 0

取得ターム = ターム + 指定ターム
IF 取得ターム >= 7
	LOCAL = 取得ターム
	取得ターム %= 7
	取得季节 += LOCAL / 7
	取得ターム += LOCAL / 7
ENDIF

取得季节 += 季节
IF 取得季节 >= 5
	取得季节 = 1
ENDIF

RETURN 取得季节, 取得ターム

;-------------------------------------------------
;长期予报
;-------------------------------------------------
@WEATHER_FORECAST_1YEAR

;(天候パッチ)エルニーニョ现象の翌年はラニーニャ现象、ラニーニャ现象の翌年・翌々年は通常、其他は25％でエルニーニョ现象
SELECTCASE YEAR_WEATHER_CONTROL
	CASE 4
		YEAR_WEATHER_CONTROL = 1
	CASE 3
		YEAR_WEATHER_CONTROL = 4
	CASE 2
		YEAR_WEATHER_CONTROL = 3
	CASE RAND:4 == 0
		YEAR_WEATHER_CONTROL = 2
	CASEELSE
		YEAR_WEATHER_CONTROL = 1
ENDSELECT

;-------------------------------------------------
;短期予报
;-------------------------------------------------
@WEATHER_FORECAST_1TERM
#DIM 位置倍率
#DIM 予想经过时间
#DIM 日本海低气圧发生判定
#DIM 南岸低气圧发生判定

;(天候パッチ)长期天候倾向が未设定の时は长期予报を行う
SIF YEAR_WEATHER_CONTROL <= 0
	CALL WEATHER_FORECAST_1YEAR

;タームをまたいだ场合に处理を续行
SIF NOW_TERM == GET_TERM()
	RETURN

;现在的ターム数を设定
NOW_TERM = GET_TERM()

;梅雨・秋雨入り判定
IF DAY:2 == 1 && NOW_TERM == 6
	IS_RAINY_SEASON1:0 = 1
	;PRINTL ぐずついた空模样だ…
	;PRINTW 梅雨入りしたようだ
	;CALL ASK_DIARY("梅雨入りした")
	PRINTL 阴沉的天空…
	PRINTW 好像进入梅雨季节了
	CALL ASK_DIARY("进入梅雨季节了")
ELSEIF DAY:2 == 3 && NOW_TERM == 1
	IS_RAINY_SEASON2 = 1
ENDIF

;现在的タームにおける寒气・暖气の强さを设定
SELECTCASE YEAR_WEATHER_CONTROL
	CASE 3
		SELECTCASE DAY:2
			CASE 2
				POWER_COLD_AIR = MIN(RAND:5 + 2, 5)
				POWER_WARM_AIR = MIN(RAND:5 + 2, 5)
			CASE 4
				POWER_COLD_AIR = MIN(RAND:5 + 2, 5)
				POWER_WARM_AIR = RAND:5 + 1
			CASEELSE
				POWER_COLD_AIR = RAND:5 + 1
				POWER_WARM_AIR = MIN(RAND:5 + 2, 5)
		ENDSELECT
	CASE 2
		SELECTCASE DAY:2
			CASE 4
				POWER_COLD_AIR = MAX(RAND:5, 1)
				POWER_WARM_AIR = MIN(RAND:5 + 2, 5)
			CASEELSE
				POWER_COLD_AIR = RAND:5 + 1
				POWER_WARM_AIR = MAX(RAND:5, 1)
		ENDSELECT
	CASEELSE
		POWER_COLD_AIR = RAND:5 + 1
		POWER_WARM_AIR = RAND:5 + 1
ENDSELECT

;寒气・暖气による作物への影响
IF FLAG:地主 > 0
	IF (POWER_WARM_AIR == 3 || POWER_WARM_AIR == 4) && (DAY:2 == 1 || DAY:2 == 3)
		FLAG:田地工作的成果 += 10
	ELSEIF POWER_COLD_AIR == 5 && DAY:2 == 1
		FLAG:田地工作的成果 = MAX(0, FLAG:田地工作的成果 - 10)
		AMOUNT_COLD_CROP_DAMAGE += 10
	ENDIF
ENDIF

;连续降水Counter20以上で水害发生的可能性、作物に坏灭的な被害
IF CONTINUOUS_RAINFALL >= 20 && RAND:(MAX(1, (40 - CONTINUOUS_RAINFALL) / 5)) == 0
	IS_FLOOD_CROP_DAMAGE = 1
	FLAG:田地工作的成果 = 0
ENDIF

;梅雨・秋雨明け判定
IF IS_RAINY_SEASON1:0 == 1 && POWER_WARM_AIR >= 3 && IS_RAINY_SEASON1:1 != 1
	IS_RAINY_SEASON1:1 = 1
	;梅雨末期の线状降水带发生判定
	IF POWER_WARM_AIR == 5 && RAND:5 == 0 && IS_LINER_RAINBAND:0 == 0
		CALL CALCULATE_ADD_TIME(DAY:2, DAY:3, TIME:0, RAND:4200)
		CALL GENERATE_LINER_RAINBAND(RESULT:0, RESULT:1, RESULT:2)
	ENDIF
ELSEIF IS_RAINY_SEASON1:0 == 1 && (DAY:2 == 3 && NOW_TERM == 1)
	IS_RAINY_SEASON1:0 = 0
	IS_RAINY_SEASON1:1 = 0
	;PRINTL いつの间にか夏の蒸し暑さは去っていった
	;PRINTW 结局梅雨は明けなかったようだ
	;CALL ASK_DIARY("夏が来なかった")
	PRINTL 不知不觉间夏天的闷热已经过去了
	PRINTW 结果梅雨好像没有结束
	CALL ASK_DIARY("夏日未至")
ELSEIF IS_RAINY_SEASON1:1 == 1
	IS_RAINY_SEASON1:0 = 0
	IS_RAINY_SEASON1:1 = 0
	;PRINTL 爽やかな夏模样だ！
	;PRINTW 梅雨明けしたようだ
	;CALL ASK_DIARY("梅雨が明けた")
	PRINTL 清爽的夏日模样！
	PRINTW 好像出梅了
	CALL ASK_DIARY("出梅了")
ELSEIF DAY:2 == 3 && NOW_TERM == 2
	IS_RAINY_SEASON2 = 0
ENDIF

;梅雨による作物への影响
IF FLAG:地主 > 0
	IF DAY:2 == 2 && (NOW_TERM == 1 || NOW_TERM == 2) && IS_RAINY_SEASON1:0 == 1
		FLAG:田地工作的成果 += 20
	ELSEIF DAY:2 == 2 && NOW_TERM == 4 && IS_RAINY_SEASON1:0 == 1
		FLAG:田地工作的成果 = MAX(0, FLAG:田地工作的成果 - 20)
	ELSEIF DAY:2 == 2 && NOW_TERM == 5 && IS_RAINY_SEASON1:0 == 1
		FLAG:田地工作的成果 = MAX(0, FLAG:田地工作的成果 - 40)
		IS_COLD_CROP_DAMAGE ++
	ELSEIF DAY:2 == 2 && NOW_TERM == 6 && IS_RAINY_SEASON1:0 == 1
		FLAG:田地工作的成果 = MAX(0, FLAG:田地工作的成果 - 80)
		IS_COLD_CROP_DAMAGE ++
	ENDIF
ENDIF

;梅雨・秋雨时以外に寒冷涡の发生判定
IF !IS_RAINY_SEASON1:0 && !IS_RAINY_SEASON2 && POWER_COLD_AIR == 5
	IS_COLD_LOW = 1
	;寒冷涡の势力圏突入时刻
	TIME_ENTER_TERRITORY_COLD_LOW:0 = DAY:2
	TIME_ENTER_TERRITORY_COLD_LOW:1 = DAY:3 + RAND:2
	TIME_ENTER_TERRITORY_COLD_LOW:2 = RAND:1440
	
	;寒冷涡の势力圏通过时刻
	CALL CALCULATE_ADD_TIME((TIME_ENTER_TERRITORY_COLD_LOW:0), (TIME_ENTER_TERRITORY_COLD_LOW:1), (TIME_ENTER_TERRITORY_COLD_LOW:2), 2880)
	TIME_PASSAGE_TERRITORY_COLD_LOW:0 = RESULT:0
	TIME_PASSAGE_TERRITORY_COLD_LOW:1 = RESULT:1
	TIME_PASSAGE_TERRITORY_COLD_LOW:2 = RESULT:2
ELSE
	IS_COLD_LOW = 0
	TIME_ENTER_TERRITORY_COLD_LOW:0 = 0
	TIME_ENTER_TERRITORY_COLD_LOW:1 = 0
	TIME_ENTER_TERRITORY_COLD_LOW:2 = 0
ENDIF

;日本海低气圧の消灭判定
IF IS_SoJ_LOW >= 1
	IS_SoJ_LOW = 0
	TIME_ENTER_TERRITORY_SoJ_LOW:0 = 0
	TIME_ENTER_TERRITORY_SoJ_LOW:1 = 0
	TIME_ENTER_TERRITORY_SoJ_LOW:2 = 0
	
	TIME_CLOSEST_SoJ_LOW:0 = 0
	TIME_CLOSEST_SoJ_LOW:1 = 0
	TIME_CLOSEST_SoJ_LOW:2 = 0
	
	TIME_PASSAGE_FAKE_FINE:0 = 0
	TIME_PASSAGE_FAKE_FINE:1 = 0
	TIME_PASSAGE_FAKE_FINE:2 = 0
	
	TIME_PASSAGE_SoJ_LOW:0 = 0
	TIME_PASSAGE_SoJ_LOW:1 = 0
	TIME_PASSAGE_SoJ_LOW:2 = 0
ENDIF

;南岸低气圧の消灭判定
IF IS_SOUTHERN_LOW == 1
	IS_SOUTHERN_LOW = 0
	TIME_ENTER_TERRITORY_SOUTHERN_LOW:0 = 0
	TIME_ENTER_TERRITORY_SOUTHERN_LOW:1 = 0
	TIME_ENTER_TERRITORY_SOUTHERN_LOW:2 = 0
	
	TIME_PASSAGE_SOUTHERN_LOW:0 = 0
	TIME_PASSAGE_SOUTHERN_LOW:1 = 0
	TIME_PASSAGE_SOUTHERN_LOW:2 = 0
ENDIF

;台风の消灭判定
IF (DAY:2 == 1 || (DAY:2 == 3 && NOW_TERM >= 4) || DAY:2 == 4 || TIME_PASSAGE_WIND_ZONE_TYPHOON:0 < DAY:2 || GET_LOCATION_LOW() == "台风一过") && IS_TYPHOON:0 == 1
	IS_TYPHOON:0 = 0
	IS_TYPHOON:1 = 0
	IS_TYPHOON:2 = 0
	IS_TYPHOON:3 = 0
	
	TIME_ENTER_TERRITORY_TYPHOON:0 = 0
	TIME_ENTER_TERRITORY_TYPHOON:1 = 0
	TIME_ENTER_TERRITORY_TYPHOON:2 = 0
	
	TIME_ENTER_WIND_ZONE_TYPHOON:0 = 0
	TIME_ENTER_WIND_ZONE_TYPHOON:1 = 0
	TIME_ENTER_WIND_ZONE_TYPHOON:2 = 0
	
	TIME_CLOSEST_TYPHOON:0 = 0
	TIME_CLOSEST_TYPHOON:1 = 0
	TIME_CLOSEST_TYPHOON:2 = 0
	
	TIME_PASSAGE_EYE_TYPHOON:0 = 0
	TIME_PASSAGE_EYE_TYPHOON:1 = 0
	TIME_PASSAGE_EYE_TYPHOON:2 = 0
	
	TIME_PASSAGE_WIND_ZONE_TYPHOON:0 = 0
	TIME_PASSAGE_WIND_ZONE_TYPHOON:1 = 0
	TIME_PASSAGE_WIND_ZONE_TYPHOON:2 = 0
	
	TIME_ENTER_STORM_AREA_TYPHOON:0 = 0
	TIME_ENTER_STORM_AREA_TYPHOON:1 = 0
	TIME_ENTER_STORM_AREA_TYPHOON:2 = 0
	
	TIME_PASSAGE_STORM_AREA_TYPHOON:0 = 0
	TIME_PASSAGE_STORM_AREA_TYPHOON:1 = 0
	TIME_PASSAGE_STORM_AREA_TYPHOON:2 = 0
	
ENDIF

;线状降水带の消灭判定
IF (TIME_PASSAGE_LINER_RAINBAND:0 < DAY:2 || GET_LOCATION_LINER_RAINBAND() == "线状降水带通过") && IS_LINER_RAINBAND:0 >= 1
	IS_LINER_RAINBAND:0 = 0
	IS_LINER_RAINBAND:1 = 0
	
	TIME_ENTER_TERRITORY_LINER_RAINBAND:0 = 0
	TIME_ENTER_TERRITORY_LINER_RAINBAND:1 = 0
	TIME_ENTER_TERRITORY_LINER_RAINBAND:2 = 0
	
	TIME_PASSAGE_LINER_RAINBAND:0 = 0
	TIME_PASSAGE_LINER_RAINBAND:1 = 0
	TIME_PASSAGE_LINER_RAINBAND:2 = 0
	
ENDIF

;台风と寒冷涡が同时に存在するとき迷走台风になる
IF IS_TYPHOON:0 && IS_COLD_LOW
	;台风の强风域通过时刻を延长する
	CALL CALCULATE_ADD_TIME((TIME_PASSAGE_WIND_ZONE_TYPHOON:0), (TIME_PASSAGE_WIND_ZONE_TYPHOON:1), (TIME_PASSAGE_WIND_ZONE_TYPHOON:2), (720 + RAND:360))
	TIME_PASSAGE_WIND_ZONE_TYPHOON:0 = RESULT:0
	TIME_PASSAGE_WIND_ZONE_TYPHOON:1 = RESULT:1
	TIME_PASSAGE_WIND_ZONE_TYPHOON:2 = RESULT:2
	
	;台风の暴风域通过时刻を延长する
	IF IS_TYPHOON:1 >= 3
		CALL CALCULATE_ADD_TIME((TIME_PASSAGE_STORM_AREA_TYPHOON:0), (TIME_PASSAGE_STORM_AREA_TYPHOON:1), (TIME_PASSAGE_STORM_AREA_TYPHOON:2), (720 + RAND:360))
		TIME_PASSAGE_STORM_AREA_TYPHOON:0 = RESULT:0
		TIME_PASSAGE_STORM_AREA_TYPHOON:1 = RESULT:1
		TIME_PASSAGE_STORM_AREA_TYPHOON:2 = RESULT:2
	ENDIF
ENDIF

;夏・秋第1・2ターム时に台风の发生判定
IF (DAY:2 == 2 || (DAY:2 == 3 && NOW_TERM <= 2)) && POWER_WARM_AIR == 5 && !IS_TYPHOON:0
	IS_TYPHOON:0 = 1
	IS_TYPHOON:1 = RAND:5 + 1
	IS_TYPHOON:2 = RAND:3 + 1
	
	;20%の概率で先駆降雨带发生
	SIF RAND:5 == 0
		IS_TYPHOON:3 = 1
	
	SELECTCASE IS_TYPHOON:2
		CASE 1
			位置倍率 = 7
		CASE 2
			位置倍率 = 10
		CASE 3
			位置倍率 = 9
	ENDSELECT
	
	;台风の势力圏突入时刻を算定
	CALL CALCULATE_ADD_TERM(DAY:2, NOW_TERM, 1)
	TIME_ENTER_TERRITORY_TYPHOON:0 = RESULT:0
	TIME_ENTER_TERRITORY_TYPHOON:1 = ((RESULT:1 - 1) * 5) + 1
	TIME_ENTER_TERRITORY_TYPHOON:2 = RAND:1440
	
	;台风の强风域突入时刻を算定
	CALL CALCULATE_ADD_TIME((TIME_ENTER_TERRITORY_TYPHOON:0), (TIME_ENTER_TERRITORY_TYPHOON:1), (TIME_ENTER_TERRITORY_TYPHOON:2), 2880)
	TIME_ENTER_WIND_ZONE_TYPHOON:0 = RESULT:0
	TIME_ENTER_WIND_ZONE_TYPHOON:1 = RESULT:1
	TIME_ENTER_WIND_ZONE_TYPHOON:2 = RESULT:2
	
	;势力3以上だと暴风域を备える
	IF IS_TYPHOON:1 >= 3
		;台风の暴风域突入时刻
		CALL CALCULATE_ADD_TIME((TIME_ENTER_WIND_ZONE_TYPHOON:0), (TIME_ENTER_WIND_ZONE_TYPHOON:1), (TIME_ENTER_WIND_ZONE_TYPHOON:2), (360 * 位置倍率 / 10))
		TIME_ENTER_STORM_AREA_TYPHOON:0 = RESULT:0
		TIME_ENTER_STORM_AREA_TYPHOON:1 = RESULT:1
		TIME_ENTER_STORM_AREA_TYPHOON:2 = RESULT:2
		
		;台风の暴风域通过时刻
		CALL CALCULATE_ADD_TIME((TIME_ENTER_WIND_ZONE_TYPHOON:0), (TIME_ENTER_WIND_ZONE_TYPHOON:1), (TIME_ENTER_WIND_ZONE_TYPHOON:2), (1080 * 位置倍率 / 10))
		TIME_PASSAGE_STORM_AREA_TYPHOON:0 = RESULT:0
		TIME_PASSAGE_STORM_AREA_TYPHOON:1 = RESULT:1
		TIME_PASSAGE_STORM_AREA_TYPHOON:2 = RESULT:2
	ENDIF
	
	;台风の最接近时刻を算定
	CALL CALCULATE_ADD_TIME((TIME_ENTER_WIND_ZONE_TYPHOON:0), (TIME_ENTER_WIND_ZONE_TYPHOON:1), (TIME_ENTER_WIND_ZONE_TYPHOON:2), (720 * 位置倍率 / 10))
	TIME_CLOSEST_TYPHOON:0 = RESULT:0
	TIME_CLOSEST_TYPHOON:1 = RESULT:1
	TIME_CLOSEST_TYPHOON:2 = RESULT:2
	
	;台风の目通过时刻を算定
	CALL CALCULATE_ADD_TIME((TIME_CLOSEST_TYPHOON:0), (TIME_CLOSEST_TYPHOON:1), (TIME_CLOSEST_TYPHOON:2), (10 * IS_TYPHOON:1))
	TIME_PASSAGE_EYE_TYPHOON:0 = RESULT:0
	TIME_PASSAGE_EYE_TYPHOON:1 = RESULT:1
	TIME_PASSAGE_EYE_TYPHOON:2 = RESULT:2
	
	;台风の强风域通过时刻を算定
	CALL CALCULATE_ADD_TIME((TIME_ENTER_WIND_ZONE_TYPHOON:0), (TIME_ENTER_WIND_ZONE_TYPHOON:1), (TIME_ENTER_WIND_ZONE_TYPHOON:2), (1420 * 位置倍率 / 10))
	TIME_PASSAGE_WIND_ZONE_TYPHOON:0 = RESULT:0
	TIME_PASSAGE_WIND_ZONE_TYPHOON:1 = RESULT:1
	TIME_PASSAGE_WIND_ZONE_TYPHOON:2 = RESULT:2
	
	;先駆降雨带发生时・秋雨时の线状降水带发生判定
	IF (IS_TYPHOON:3 == 1 || (TIME_ENTER_TERRITORY_TYPHOON:0 == 3 && TIME_ENTER_TERRITORY_TYPHOON:1 <= 5)) && POWER_WARM_AIR == 5 && RAND:4 == 0 && IS_LINER_RAINBAND:0 == 0
		CALL GENERATE_LINER_RAINBAND(TIME_ENTER_TERRITORY_TYPHOON:0, TIME_ENTER_TERRITORY_TYPHOON:1, TIME_ENTER_TERRITORY_TYPHOON:2)
	ENDIF
	
ENDIF

;夏季に寒冷涡发生时の线状降水带发生判定
IF IS_COLD_LOW && POWER_WARM_AIR == 5 && RAND:4 && IS_LINER_RAINBAND:0 == 0
	CALL CALCULATE_ADD_TIME(DAY:2, DAY:3, TIME:0, RAND:4200)
	CALL GENERATE_LINER_RAINBAND(RESULT:0, RESULT:1, RESULT:2)
ENDIF

;冬に温带低气圧の发生判定
IF DAY:2 == 4 && !IS_COLD_LOW
	日本海低气圧发生判定 = RAND:5
	南岸低气圧发生判定 = RAND:5
	
	;二つ玉低气圧发生
	IF !日本海低气圧发生判定 && !南岸低气圧发生判定
		IS_SoJ_LOW = 2
		;日本海低气圧の势力圏突入时刻
		TIME_ENTER_TERRITORY_SoJ_LOW:0 = DAY:2
		TIME_ENTER_TERRITORY_SoJ_LOW:1 = DAY:3 + RAND:3
		TIME_ENTER_TERRITORY_SoJ_LOW:2 = RAND:1440
		
		;日本海低气圧の最接近时刻
		CALL CALCULATE_ADD_TIME((TIME_ENTER_TERRITORY_SoJ_LOW:0), (TIME_ENTER_TERRITORY_SoJ_LOW:1), (TIME_ENTER_TERRITORY_SoJ_LOW:2), 720)
		TIME_CLOSEST_SoJ_LOW:0 = RESULT:0
		TIME_CLOSEST_SoJ_LOW:1 = RESULT:1
		TIME_CLOSEST_SoJ_LOW:2 = RESULT:2
		
		;疑似好天エリア通过时刻
		CALL CALCULATE_ADD_TIME((TIME_CLOSEST_SoJ_LOW:0), (TIME_CLOSEST_SoJ_LOW:1), (TIME_CLOSEST_SoJ_LOW:2), (30 * (RAND:6 + 1)))
		TIME_PASSAGE_FAKE_FINE:0 = RESULT:0
		TIME_PASSAGE_FAKE_FINE:1 = RESULT:1
		TIME_PASSAGE_FAKE_FINE:2 = RESULT:2
		
		;日本海低气圧の通过时刻
		CALL CALCULATE_ADD_TIME((TIME_CLOSEST_SoJ_LOW:0), (TIME_CLOSEST_SoJ_LOW:1), (TIME_CLOSEST_SoJ_LOW:2), 1080)
		TIME_PASSAGE_SoJ_LOW:0 = RESULT:0
		TIME_PASSAGE_SoJ_LOW:1 = RESULT:1
		TIME_PASSAGE_SoJ_LOW:2 = RESULT:2
		
	;日本海低气圧发生
	ELSEIF !日本海低气圧发生判定
		IS_SoJ_LOW = 1
		;日本海低气圧の势力圏突入时刻
		TIME_ENTER_TERRITORY_SoJ_LOW:0 = DAY:2
		TIME_ENTER_TERRITORY_SoJ_LOW:1 = DAY:3 + RAND:3
		TIME_ENTER_TERRITORY_SoJ_LOW:2 = RAND:1440
		
		;日本海低气圧の最接近时刻
		CALL CALCULATE_ADD_TIME((TIME_ENTER_TERRITORY_SoJ_LOW:0), (TIME_ENTER_TERRITORY_SoJ_LOW:1), (TIME_ENTER_TERRITORY_SoJ_LOW:2), 720)
		TIME_CLOSEST_SoJ_LOW:0 = RESULT:0
		TIME_CLOSEST_SoJ_LOW:1 = RESULT:1
		TIME_CLOSEST_SoJ_LOW:2 = RESULT:2
		
		;日本海低气圧の通过时刻
		CALL CALCULATE_ADD_TIME((TIME_CLOSEST_SoJ_LOW:0), (TIME_CLOSEST_SoJ_LOW:1), (TIME_CLOSEST_SoJ_LOW:2), 1080)
		TIME_PASSAGE_SoJ_LOW:0 = RESULT:0
		TIME_PASSAGE_SoJ_LOW:1 = RESULT:1
		TIME_PASSAGE_SoJ_LOW:2 = RESULT:2
		
	;南岸低气圧发生
	ELSEIF !南岸低气圧发生判定
		IS_SOUTHERN_LOW = 1
		;南岸低气圧の势力圏突入时刻
		TIME_ENTER_TERRITORY_SOUTHERN_LOW:0 = DAY:2
		TIME_ENTER_TERRITORY_SOUTHERN_LOW:1 = DAY:3 + RAND:3
		TIME_ENTER_TERRITORY_SOUTHERN_LOW:2 = RAND:1440
		
		;南岸低气圧の通过时刻
		CALL CALCULATE_ADD_TIME((TIME_ENTER_TERRITORY_SOUTHERN_LOW:0), (TIME_ENTER_TERRITORY_SOUTHERN_LOW:1), (TIME_ENTER_TERRITORY_SOUTHERN_LOW:2), 1440)
		TIME_PASSAGE_SOUTHERN_LOW:0 = RESULT:0
		TIME_PASSAGE_SOUTHERN_LOW:1 = RESULT:1
		TIME_PASSAGE_SOUTHERN_LOW:2 = RESULT:2
	ENDIF
ENDIF

;春・秋に温暖低气圧の发生判定
IF (DAY:2 == 1 || DAY:2 == 3) && !IS_COLD_LOW && !IS_RAINY_SEASON1:0 && !IS_RAINY_SEASON2
	;春・秋の温带低气圧の势力圏突入时刻
	TIME_ENTER_TERRITORY_EXTRATROPICAL_LOW:0 = DAY:2
	TIME_ENTER_TERRITORY_EXTRATROPICAL_LOW:1 = DAY:3 + 1 + RAND:2
	TIME_ENTER_TERRITORY_EXTRATROPICAL_LOW:2 = RAND:1440
	
	;春・秋の温带低气圧の温暖前线通过时刻
	CALL CALCULATE_ADD_TIME((TIME_ENTER_TERRITORY_EXTRATROPICAL_LOW:0), (TIME_ENTER_TERRITORY_EXTRATROPICAL_LOW:1), (TIME_ENTER_TERRITORY_EXTRATROPICAL_LOW:2), 1440)
	TIME_PASSAGE_WARM_FRONT:0 = RESULT:0
	TIME_PASSAGE_WARM_FRONT:1 = RESULT:1
	TIME_PASSAGE_WARM_FRONT:2 = RESULT:2
	
	;春・秋の温带低气圧の寒冷前线时刻
	CALL CALCULATE_ADD_TIME((TIME_PASSAGE_WARM_FRONT:0), (TIME_PASSAGE_WARM_FRONT:1), (TIME_PASSAGE_WARM_FRONT:2), 720)
	TIME_PASSAGE_COLD_FRONT:0 = RESULT:0
	TIME_PASSAGE_COLD_FRONT:1 = RESULT:1
	TIME_PASSAGE_COLD_FRONT:2 = RESULT:2
	
	;春・秋の温带低气圧の势力圏通过时刻
	CALL CALCULATE_ADD_TIME((TIME_PASSAGE_COLD_FRONT:0), (TIME_PASSAGE_COLD_FRONT:1), (TIME_PASSAGE_COLD_FRONT:2), 180)
	TIME_PASSAGE_EXTRATROPICAL_LOW:0 = RESULT:0
	TIME_PASSAGE_EXTRATROPICAL_LOW:1 = RESULT:1
	TIME_PASSAGE_EXTRATROPICAL_LOW:2 = RESULT:2
;温带低气圧の消灭判定
ELSE
	TIME_ENTER_TERRITORY_EXTRATROPICAL_LOW:0 = 0
	TIME_ENTER_TERRITORY_EXTRATROPICAL_LOW:1 = 0
	TIME_ENTER_TERRITORY_EXTRATROPICAL_LOW:2 = 0
	
	TIME_PASSAGE_WARM_FRONT:0 = 0
	TIME_PASSAGE_WARM_FRONT:1 = 0
	TIME_PASSAGE_WARM_FRONT:2 = 0
	
	TIME_PASSAGE_COLD_FRONT:0 = 0
	TIME_PASSAGE_COLD_FRONT:1 = 0
	TIME_PASSAGE_COLD_FRONT:2 = 0
	
	TIME_PASSAGE_EXTRATROPICAL_LOW:0 = 0
	TIME_PASSAGE_EXTRATROPICAL_LOW:1 = 0
	TIME_PASSAGE_EXTRATROPICAL_LOW:2 = 0
ENDIF
;-------------------------------------------------
;1日予报
;-------------------------------------------------
@WEATHER_FORECAST_1DAY

;(天候パッチ)长期天候倾向が未设定の时は长期予报を行う
SIF YEAR_WEATHER_CONTROL <= 0
	CALL WEATHER_FORECAST_1YEAR

;天候变更禁止を解除する
FORBIDDEN_CHANGE_WEATHER = 0

;雾发生フラグをリセット
CAN_STRATUS = 0

;(天候パッチ)1日の大气安定度をリセット
ATMOSPHERIC_INSTABILITY = 0

;积云/积乱云の发生判定をリセット
CAN_CUMULUS:0 = 0
CAN_CUMULUS:1 = 0
CAN_CUMULUS:2 = 0
TIME_ENTER_TERRITORY_CUMULUS = 0
TIME_CLOSEST_CUMULUS = 0

;雾の发生判定
SIF !IS_COLD_LOW && !IS_TYPHOON:0 && !IS_SoJ_LOW && !IS_SOUTHERN_LOW && !RAND:10
	CAN_STRATUS = 1

;(天候パッチ)1日の大气安定度を设定
ATMOSPHERIC_INSTABILITY = RAND:(8 - POWER_WARM_AIR) + (7 - POWER_WARM_AIR - POWER_COLD_AIR)
SIF DAY:2 == 2 && (IS_COLD_LOW || GET_LOCATION_LOW() == "台风势力圏")
	ATMOSPHERIC_INSTABILITY -= 6

;(天候パッチ)天候安定度が低い场合には线状降水带が发生する可能性あり
;(天气补丁)在天气稳定较低的情况下，可能会出现线状降水
IF ATMOSPHERIC_INSTABILITY <= -2 && IS_LINER_RAINBAND:0 == 0 && RAND:(13+ATMOSPHERIC_INSTABILITY) == 0 && DAY:2 != 4
	CALL GENERATE_LINER_RAINBAND(DAY:2, DAY:3, RAND:1320)
ENDIF
;积云/积乱云の发生判定
IF DAY:2 == 2 && POWER_WARM_AIR >= 2 && !IS_COLD_LOW && (GET_LOCATION_LOW() == "台风远方" || GET_LOCATION_LOW() == "台风一过" || GET_LOCATION_LOW() == "低气圧未发生")
	SELECTCASE ATMOSPHERIC_INSTABILITY
		CASE IS >= 4
			CAN_CUMULUS:0 = 1
		CASE IS >= 0
			CAN_CUMULUS:0 = 2
		CASEELSE
			CAN_CUMULUS:0 = 3
	ENDSELECT
	SIF !RAND:4
		CAN_CUMULUS:1 = 1
ELSEIF DAY:2 == 2 && (IS_COLD_LOW || GET_LOCATION_LOW() == "台风势力圏")
	SELECTCASE ATMOSPHERIC_INSTABILITY
		CASE IS >= 0
			CAN_CUMULUS:0 = 2
			SIF !RAND:4
				CAN_CUMULUS:1 = 1
		CASE IS >= -3
			CAN_CUMULUS:0 = 3
			SIF !RAND:2
				CAN_CUMULUS:1 = 1
		CASE IS >= -6
			CAN_CUMULUS:0 = 4
			SIF !RAND:2
				CAN_CUMULUS:1 = 1
		CASE IS >= -8
			CAN_CUMULUS:0 = 4
			CAN_CUMULUS:1 = 1
		CASEELSE
			CAN_CUMULUS:0 = 5
			CAN_CUMULUS:1 = 1
	ENDSELECT
;积云/积乱云の发生判定をリセット
ELSE
	CAN_CUMULUS:0 = 0
	CAN_CUMULUS:1 = 0
	CAN_CUMULUS:2 = 0
	TIME_ENTER_TERRITORY_CUMULUS = 0
	TIME_CLOSEST_CUMULUS = 0
ENDIF

IF CAN_CUMULUS:1 == 1
	;积云/积乱云の势力圏突入时刻
	TIME_ENTER_TERRITORY_CUMULUS = 840 + RAND:120
	
	;积云/积乱云の最接近时刻
	TIME_CLOSEST_CUMULUS = TIME_ENTER_TERRITORY_CUMULUS + 30 + RAND:15
	
	;积云/积乱云の势力圏通过时刻
	SELECTCASE CAN_CUMULUS:0
		CASE IS <= 3
			TIME_PASSAGE_CUMULUS = TIME_CLOSEST_CUMULUS + 60 + RAND:15
		CASE 4
			TIME_PASSAGE_CUMULUS = TIME_CLOSEST_CUMULUS + 90  + (RAND:2 * 60) + RAND:30
		CASE 5
			TIME_PASSAGE_CUMULUS = TIME_CLOSEST_CUMULUS + 120  + (RAND:3 * 60) + RAND:30
	ENDSELECT
ENDIF

;かなとこ云とスーパーセルの场合风の强さ判定
IF CAN_CUMULUS:0 == 4 && CAN_CUMULUS:1 == 1
	IF RAND:(40 + ATMOSPHERIC_INSTABILITY) == 0
		CAN_CUMULUS:2 = 2
	ELSE
		CAN_CUMULUS:2 = 1
	ENDIF
ELSEIF CAN_CUMULUS:0 == 5 && CAN_CUMULUS:1 == 1
	IF RAND:5 == 0
		CAN_CUMULUS:2 = 2
	ELSE
		CAN_CUMULUS:2 = 1
	ENDIF
ENDIF

;-------------------------------------------------
;低气圧の位置判定
;-------------------------------------------------
@GET_LOCATION_LOW
#FUNCTIONS

;台风
IF IS_TYPHOON:0
	;台风の势力圏突入时刻以前
	IF TIME_ENTER_TERRITORY_TYPHOON:0 > DAY:2
		RETURNF "台风远方"
	ELSEIF TIME_ENTER_TERRITORY_TYPHOON:0 == DAY:2 && TIME_ENTER_TERRITORY_TYPHOON:1 > DAY:3
		RETURNF "台风远方"
	ELSEIF TIME_ENTER_TERRITORY_TYPHOON:0 == DAY:2 && TIME_ENTER_TERRITORY_TYPHOON:1 == DAY:3 && TIME_ENTER_TERRITORY_TYPHOON:2 > TIME:0
		RETURNF "台风远方"
	;台风の强风域突入时刻以前
	ELSEIF TIME_ENTER_WIND_ZONE_TYPHOON:0 > DAY:2
		RETURNF "台风势力圏"
	ELSEIF TIME_ENTER_WIND_ZONE_TYPHOON:0 == DAY:2 && TIME_ENTER_WIND_ZONE_TYPHOON:1 > DAY:3
		RETURNF "台风势力圏"
	ELSEIF TIME_ENTER_WIND_ZONE_TYPHOON:0 == DAY:2 && TIME_ENTER_WIND_ZONE_TYPHOON:1 == DAY:3 && TIME_ENTER_WIND_ZONE_TYPHOON:2 > TIME:0
		RETURNF "台风势力圏"
	;台风に暴风域があり台风の暴风域突入时刻以前
	ELSEIF IS_TYPHOON:1 >= 3 && TIME_ENTER_STORM_AREA_TYPHOON:0 > DAY:2
		RETURNF "台风接近强风域"
	ELSEIF IS_TYPHOON:1 >= 3 && TIME_ENTER_STORM_AREA_TYPHOON:0 == DAY:2 && TIME_ENTER_STORM_AREA_TYPHOON:1 > DAY:3
		RETURNF "台风接近强风域"
	ELSEIF IS_TYPHOON:1 >= 3 && TIME_ENTER_STORM_AREA_TYPHOON:0 == DAY:2 && TIME_ENTER_STORM_AREA_TYPHOON:1 == DAY:3 && TIME_ENTER_STORM_AREA_TYPHOON:2 > TIME:0
		RETURNF "台风接近强风域"
	;台风に暴风域がなく台风の最接近时刻以前
	ELSEIF IS_TYPHOON:1 < 3 && TIME_CLOSEST_TYPHOON:0 > DAY:2
		RETURNF "台风接近强风域"
	ELSEIF IS_TYPHOON:1 < 3 && TIME_CLOSEST_TYPHOON:0 == DAY:2 && TIME_CLOSEST_TYPHOON:1 > DAY:3
		RETURNF "台风接近强风域"
	ELSEIF IS_TYPHOON:1 < 3 && TIME_CLOSEST_TYPHOON:0 == DAY:2 && TIME_CLOSEST_TYPHOON:1 == DAY:3 && TIME_CLOSEST_TYPHOON:2 > TIME:0
		RETURNF "台风接近强风域"
	;台风に暴风域があり台风の最接近时刻以前
	ELSEIF IS_TYPHOON:1 >= 3 && TIME_CLOSEST_TYPHOON:0 > DAY:2
		RETURNF "台风接近暴风域"
	ELSEIF IS_TYPHOON:1 >= 3 && TIME_CLOSEST_TYPHOON:0 == DAY:2 && TIME_CLOSEST_TYPHOON:1 > DAY:3
		RETURNF "台风接近暴风域"
	ELSEIF IS_TYPHOON:1 >= 3 && TIME_CLOSEST_TYPHOON:0 == DAY:2 && TIME_CLOSEST_TYPHOON:1 == DAY:3 && TIME_CLOSEST_TYPHOON:2 > TIME:0
		RETURNF "台风接近暴风域"
	;台风の目通过时刻以前
	ELSEIF TIME_PASSAGE_EYE_TYPHOON:0 > DAY:2
		RETURNF "台风最接近"
	ELSEIF TIME_PASSAGE_EYE_TYPHOON:0 == DAY:2 && TIME_PASSAGE_EYE_TYPHOON:1 > DAY:3
		RETURNF "台风最接近"
	ELSEIF TIME_PASSAGE_EYE_TYPHOON:0 == DAY:2 && TIME_PASSAGE_EYE_TYPHOON:1 == DAY:3 && TIME_PASSAGE_EYE_TYPHOON:2 > TIME:0
		RETURNF "台风最接近"
	;台风に暴风域があり暴风域通过时刻以前
	ELSEIF IS_TYPHOON:1 >= 3 && TIME_PASSAGE_STORM_AREA_TYPHOON:0 > DAY:2
		RETURNF "台风通过暴风域"
	ELSEIF IS_TYPHOON:1 >= 3 && TIME_PASSAGE_STORM_AREA_TYPHOON:0 == DAY:2 && TIME_PASSAGE_STORM_AREA_TYPHOON:1 > DAY:3
		RETURNF "台风通过暴风域"
	ELSEIF IS_TYPHOON:1 >= 3 && TIME_PASSAGE_STORM_AREA_TYPHOON:0 == DAY:2 && TIME_PASSAGE_STORM_AREA_TYPHOON:1 == DAY:3 && TIME_PASSAGE_STORM_AREA_TYPHOON:2 > TIME:0
		RETURNF "台风通过暴风域"
	;台风の强风域通过时刻以前
	ELSEIF TIME_PASSAGE_WIND_ZONE_TYPHOON:0 > DAY:2
		RETURNF "台风通过强风域"
	ELSEIF TIME_PASSAGE_WIND_ZONE_TYPHOON:0 == DAY:2 && TIME_PASSAGE_WIND_ZONE_TYPHOON:1 > DAY:3
		RETURNF "台风通过强风域"
	ELSEIF TIME_PASSAGE_WIND_ZONE_TYPHOON:0 == DAY:2 && TIME_PASSAGE_WIND_ZONE_TYPHOON:1 == DAY:3 && TIME_PASSAGE_WIND_ZONE_TYPHOON:2 > TIME:0
		RETURNF "台风通过强风域"
	ELSE
		RETURNF "台风一过"
	ENDIF
;寒冷涡
ELSEIF IS_COLD_LOW
	;寒冷涡の势力圏突入时刻以前
	IF TIME_ENTER_TERRITORY_COLD_LOW:0 > DAY:2
		RETURNF "寒冷涡远方"
	ELSEIF TIME_ENTER_TERRITORY_COLD_LOW:0 == DAY:2 && TIME_ENTER_TERRITORY_COLD_LOW:1 > DAY:3
		RETURNF "寒冷涡远方"
	ELSEIF TIME_ENTER_TERRITORY_COLD_LOW:0 == DAY:2 && TIME_ENTER_TERRITORY_COLD_LOW:1 == DAY:3 && TIME_ENTER_TERRITORY_COLD_LOW:2 > TIME:0
		RETURNF "寒冷涡远方"
	;寒冷涡の势力圏通过时刻以前
	ELSEIF TIME_PASSAGE_TERRITORY_COLD_LOW:0 > DAY:2
		RETURNF "寒冷涡接近"
	ELSEIF TIME_PASSAGE_TERRITORY_COLD_LOW:0 == DAY:2 && TIME_PASSAGE_TERRITORY_COLD_LOW:1 > DAY:3
		RETURNF "寒冷涡接近"
	ELSEIF TIME_PASSAGE_TERRITORY_COLD_LOW:0 == DAY:2 && TIME_PASSAGE_TERRITORY_COLD_LOW:1 == DAY:3 && TIME_PASSAGE_TERRITORY_COLD_LOW:2 > TIME:0
		RETURNF "寒冷涡接近"
	ELSE
		RETURNF "寒冷涡通过"
	ENDIF
;二つ玉低气圧
ELSEIF IS_SoJ_LOW == 2
	;二つ玉低气圧の势力圏突入时刻以前
	IF TIME_ENTER_TERRITORY_SoJ_LOW:0 > DAY:2
		RETURNF "二つ玉低气圧远方"
	ELSEIF TIME_ENTER_TERRITORY_SoJ_LOW:0 == DAY:2 && TIME_ENTER_TERRITORY_SoJ_LOW:1 > DAY:3
		RETURNF "二つ玉低气圧远方"
	ELSEIF TIME_ENTER_TERRITORY_SoJ_LOW:0 == DAY:2 && TIME_ENTER_TERRITORY_SoJ_LOW:1 == DAY:3 && TIME_ENTER_TERRITORY_SoJ_LOW:2 > TIME:0
		RETURNF "二つ玉低气圧远方"
	;二つ玉低气圧の最接近时刻以前
	ELSEIF TIME_CLOSEST_SoJ_LOW:0 > DAY:2
		RETURNF "二つ玉低气圧接近"
	ELSEIF TIME_CLOSEST_SoJ_LOW:0 == DAY:2 && TIME_CLOSEST_SoJ_LOW:1 > DAY:3
		RETURNF "二つ玉低气圧接近"
	ELSEIF TIME_CLOSEST_SoJ_LOW:0 == DAY:2 && TIME_CLOSEST_SoJ_LOW:1 == DAY:3 && TIME_CLOSEST_SoJ_LOW:2 > TIME:0
		RETURNF "二つ玉低气圧接近"
	;疑似好天エリア通过时刻以前
	ELSEIF TIME_PASSAGE_FAKE_FINE:0 > DAY:2
		RETURNF "疑似好天"
	ELSEIF TIME_PASSAGE_FAKE_FINE:0 == DAY:2 && TIME_PASSAGE_FAKE_FINE:1 > DAY:3
		RETURNF "疑似好天"
	ELSEIF TIME_PASSAGE_FAKE_FINE:0 == DAY:2 && TIME_PASSAGE_FAKE_FINE:1 == DAY:3 && TIME_PASSAGE_FAKE_FINE:2 > TIME:0
		RETURNF "疑似好天"
	;二つ玉低气圧の通过时刻以前
	ELSEIF TIME_PASSAGE_SoJ_LOW:0 > DAY:2
		RETURNF "二つ玉低气圧通过中"
	ELSEIF TIME_PASSAGE_SoJ_LOW:0 == DAY:2 && TIME_PASSAGE_SoJ_LOW:1 > DAY:3
		RETURNF "二つ玉低气圧通过中"
	ELSEIF TIME_PASSAGE_SoJ_LOW:0 == DAY:2 && TIME_PASSAGE_SoJ_LOW:1 == DAY:3 && TIME_PASSAGE_SoJ_LOW:2 > TIME:0
		RETURNF "二つ玉低气圧通过中"
	ELSE
		RETURNF "二つ玉低气圧通过"
	ENDIF
;日本海低气圧
ELSEIF IS_SoJ_LOW == 1
	;日本海低气圧の势力圏突入时刻以前
	IF TIME_ENTER_TERRITORY_SoJ_LOW:0 > DAY:2
		RETURNF "日本海低气圧远方"
	ELSEIF TIME_ENTER_TERRITORY_SoJ_LOW:0 == DAY:2 && TIME_ENTER_TERRITORY_SoJ_LOW:1 > DAY:3
		RETURNF "日本海低气圧远方"
	ELSEIF TIME_ENTER_TERRITORY_SoJ_LOW:0 == DAY:2 && TIME_ENTER_TERRITORY_SoJ_LOW:1 == DAY:3 && TIME_ENTER_TERRITORY_SoJ_LOW:2 > TIME:0
		RETURNF "日本海低气圧远方"
	;日本海低气圧の最接近时刻以前
	ELSEIF TIME_CLOSEST_SoJ_LOW:0 > DAY:2
		RETURNF "日本海低气圧接近"
	ELSEIF TIME_CLOSEST_SoJ_LOW:0 == DAY:2 && TIME_CLOSEST_SoJ_LOW:1 > DAY:3
		RETURNF "日本海低气圧接近"
	ELSEIF TIME_CLOSEST_SoJ_LOW:0 == DAY:2 && TIME_CLOSEST_SoJ_LOW:1 == DAY:3 && TIME_CLOSEST_SoJ_LOW:2 > TIME:0
		RETURNF "日本海低气圧接近"
	;日本海低气圧の通过时刻以前
	ELSEIF TIME_PASSAGE_SoJ_LOW:0 > DAY:2
		RETURNF "日本海低气圧通过中"
	ELSEIF TIME_PASSAGE_SoJ_LOW:0 == DAY:2 && TIME_PASSAGE_SoJ_LOW:1 > DAY:3
		RETURNF "日本海低气圧通过中"
	ELSEIF TIME_PASSAGE_SoJ_LOW:0 == DAY:2 && TIME_PASSAGE_SoJ_LOW:1 == DAY:3 && TIME_PASSAGE_SoJ_LOW:2 > TIME:0
		RETURNF "日本海低气圧通过中"
	ELSE
		RETURNF "日本海低气圧通过"
	ENDIF
;南岸低气圧
ELSEIF IS_SOUTHERN_LOW
	;南岸低气圧の势力圏突入时刻以前
	IF TIME_ENTER_TERRITORY_SOUTHERN_LOW:0 > DAY:2
		RETURNF "南岸低气圧远方"
	ELSEIF TIME_ENTER_TERRITORY_SOUTHERN_LOW:0 == DAY:2 && TIME_ENTER_TERRITORY_SOUTHERN_LOW:1 > DAY:3
		RETURNF "南岸低气圧远方"
	ELSEIF TIME_ENTER_TERRITORY_SOUTHERN_LOW:0 == DAY:2 && TIME_ENTER_TERRITORY_SOUTHERN_LOW:1 == DAY:3 && TIME_ENTER_TERRITORY_SOUTHERN_LOW:2 > TIME:0
		RETURNF "南岸低气圧远方"
	;南岸低气圧の通过时刻以前
	ELSEIF TIME_PASSAGE_SOUTHERN_LOW:0 > DAY:2
		RETURNF "南岸低气圧接近"
	ELSEIF TIME_PASSAGE_SOUTHERN_LOW:0 == DAY:2 && TIME_PASSAGE_SOUTHERN_LOW:1 > DAY:3
		RETURNF "南岸低气圧接近"
	ELSEIF TIME_PASSAGE_SOUTHERN_LOW:0 == DAY:2 && TIME_PASSAGE_SOUTHERN_LOW:1 == DAY:3 && TIME_PASSAGE_SOUTHERN_LOW:2 > TIME:0
		RETURNF "南岸低气圧接近"
	ELSE
		RETURNF "南岸低气圧通过"
	ENDIF
;春・秋の温带低气圧
ELSEIF (DAY:2 == 1 || DAY:2 == 3) && !IS_RAINY_SEASON1 && !IS_RAINY_SEASON2
	;温暖前线の势力圏突入时刻以前
	IF TIME_ENTER_TERRITORY_EXTRATROPICAL_LOW:0 > DAY:2
		RETURNF "温暖前线远方"
	ELSEIF TIME_ENTER_TERRITORY_EXTRATROPICAL_LOW:0 == DAY:2 && TIME_ENTER_TERRITORY_EXTRATROPICAL_LOW:1 > DAY:3
		RETURNF "温暖前线远方"
	ELSEIF TIME_ENTER_TERRITORY_EXTRATROPICAL_LOW:0 == DAY:2 && TIME_ENTER_TERRITORY_EXTRATROPICAL_LOW:1 == DAY:3 && TIME_ENTER_TERRITORY_EXTRATROPICAL_LOW:2 > TIME:0
		RETURNF "温暖前线远方"
	;温暖前线通过时刻以前
	ELSEIF TIME_PASSAGE_WARM_FRONT:0 > DAY:2
		RETURNF "温暖前线接近"
	ELSEIF TIME_PASSAGE_WARM_FRONT:0 == DAY:2 && TIME_PASSAGE_WARM_FRONT:1 > DAY:3
		RETURNF "温暖前线接近"
	ELSEIF TIME_PASSAGE_WARM_FRONT:0 == DAY:2 && TIME_PASSAGE_WARM_FRONT:1 == DAY:3 && TIME_PASSAGE_WARM_FRONT:2 > TIME:0
		RETURNF "温暖前线接近"
	;寒冷前线通过时刻以前
	ELSEIF TIME_PASSAGE_COLD_FRONT:0 > DAY:2
		RETURNF "暖域"
	ELSEIF TIME_PASSAGE_COLD_FRONT:0 == DAY:2 && TIME_PASSAGE_COLD_FRONT:1 > DAY:3
		RETURNF "暖域"
	ELSEIF TIME_PASSAGE_COLD_FRONT:0 == DAY:2 && TIME_PASSAGE_COLD_FRONT:1 == DAY:3 && TIME_PASSAGE_COLD_FRONT:2 > TIME:0
		RETURNF "暖域"
	;温带低气圧の势力圏通过时刻以前
	ELSEIF TIME_PASSAGE_EXTRATROPICAL_LOW:0 > DAY:2
		RETURNF "寒冷前线通过"
	ELSEIF TIME_PASSAGE_EXTRATROPICAL_LOW:0 == DAY:2 && TIME_PASSAGE_EXTRATROPICAL_LOW:1 > DAY:3
		RETURNF "寒冷前线通过"
	ELSEIF TIME_PASSAGE_EXTRATROPICAL_LOW:0 == DAY:2 && TIME_PASSAGE_EXTRATROPICAL_LOW:1 == DAY:3 && TIME_PASSAGE_EXTRATROPICAL_LOW:2 > TIME:0
		RETURNF "寒冷前线通过"
	ELSE
		RETURNF "温带低气圧通过"
	ENDIF
ENDIF

RETURNF "低气圧未发生"

;-------------------------------------------------
;积云/积乱云の位置判定
;-------------------------------------------------
@GET_LOCATION_CUMULUS
#FUNCTIONS

IF CAN_CUMULUS:0 && CAN_CUMULUS:1
	IF TIME_ENTER_TERRITORY_CUMULUS > TIME:0
		RETURNF "积乱云视认"
	ELSEIF TIME_CLOSEST_CUMULUS > TIME:0
		RETURNF "积乱云接近"
	ELSEIF TIME_PASSAGE_CUMULUS > TIME:0
		RETURNF "积乱云直下"
	ELSE
		RETURNF "积乱云通过"
	ENDIF
ELSEIF CAN_CUMULUS:0
	RETURNF "积乱云远方"
ENDIF

RETURNF "积乱云未发生"

;-------------------------------------------------
;台风の袭来判定
;-------------------------------------------------
@GET_LOCATION_AREA_TYPHOON
#FUNCTION
#DIMS 低气圧位置

低气圧位置 = %GET_LOCATION_LOW()%

SIF 低气圧位置 == "台风接近强风域" || 低气圧位置 == "台风接近暴风域" || 低气圧位置 == "台风最接近" || 低气圧位置 == "台风通过暴风域" || 低气圧位置 == "台风通过强风域"
	RETURNF 1

RETURNF 0

;-------------------------------------------------
;线状降水带の发生处理
;-------------------------------------------------
@GENERATE_LINER_RAINBAND(发生季节 = -1, 发生日时 = -1, 发生时间 = 0)
#DIM 发生季节
#DIM 发生日时
#DIM 发生时间
#DIM 继续时间
#DIM 到达时间

SIF 发生季节 == -1
	发生季节 = DAY:2
SIF 发生日时 == -1
	发生日时 = DAY:3

;线状降水带の势力决定
IS_LINER_RAINBAND:0 = 1
IF RAND:5 == 0
	IS_LINER_RAINBAND:1 = 2
	继续时间 = 420 +  RAND:300
ELSE
	IS_LINER_RAINBAND:1 = 1
	继续时间 = 180 + RAND:180
ENDIF

;线状降水带の势力圏突入时刻
到达时间 = RAND:60
CALL CALCULATE_ADD_TIME(发生季节, 发生日时, 发生时间, 到达时间)
TIME_ENTER_TERRITORY_LINER_RAINBAND:0 = RESULT:0
TIME_ENTER_TERRITORY_LINER_RAINBAND:1 = RESULT:1
TIME_ENTER_TERRITORY_LINER_RAINBAND:2 = RESULT:2

;线状降水带の通过时刻
CALL CALCULATE_ADD_TIME(发生季节, 发生日时, 发生时间, 到达时间 + 继续时间)
TIME_PASSAGE_LINER_RAINBAND:0 = RESULT:0
TIME_PASSAGE_LINER_RAINBAND:1 = RESULT:1
TIME_PASSAGE_LINER_RAINBAND:2 = RESULT:2

;-------------------------------------------------
;线状降水带の袭来判定
;-------------------------------------------------
@GET_LOCATION_LINER_RAINBAND
#FUNCTIONS
IF IS_LINER_RAINBAND:0 >= 1
	;线状降水带の势力圏突入时刻以前
	IF TIME_ENTER_TERRITORY_LINER_RAINBAND:0 > DAY:2
		RETURNF "线状降水带远方"
	ELSEIF TIME_ENTER_TERRITORY_LINER_RAINBAND:0 == DAY:2 && TIME_ENTER_TERRITORY_LINER_RAINBAND:1 > DAY:3
		RETURNF "线状降水带远方"
	ELSEIF TIME_ENTER_TERRITORY_LINER_RAINBAND:0 == DAY:2 && TIME_ENTER_TERRITORY_LINER_RAINBAND:1 == DAY:3 && TIME_ENTER_TERRITORY_LINER_RAINBAND:2 > TIME:0
		RETURNF "线状降水带远方"
	;线状降水带の通过时刻以前
	ELSEIF TIME_PASSAGE_LINER_RAINBAND:0 > DAY:2
		RETURNF "线状降水带势力圏"
	ELSEIF TIME_PASSAGE_LINER_RAINBAND:0 == DAY:2 && TIME_PASSAGE_LINER_RAINBAND:1 > DAY:3
		RETURNF "线状降水带势力圏"
	ELSEIF TIME_PASSAGE_LINER_RAINBAND:0 == DAY:2 && TIME_PASSAGE_LINER_RAINBAND:1 == DAY:3 && TIME_PASSAGE_LINER_RAINBAND:2 > TIME:0
		RETURNF "线状降水带势力圏"
	ELSE
		RETURNF "线状降水带通过"
	ENDIF
ELSE
	RETURNF "线状降水带未发生"
ENDIF

;-------------------------------------------------
;外の世界で发令されている气象警报・警报を取得
;-------------------------------------------------
;大雨
@GET_WEATHER_WARNING_HEAVY_RAIN
#FUNCTIONS
#DIMS 低气圧位置
#DIMS 线状降水带位置
#DIMS 积乱云位置

低气圧位置 = %GET_LOCATION_LOW()%
线状降水带位置 = %GET_LOCATION_LINER_RAINBAND()%
积乱云位置 = %GET_LOCATION_CUMULUS()%

IF CONTINUOUS_RAINFALL >= 15
	RETURNF "大雨特别警报"
ELSEIF 线状降水带位置 == "线状降水带势力圏" && IS_LINER_RAINBAND:1 == 2
	RETURNF "大雨特别警报"
ELSEIF IS_TYPHOON:1 >= 5 && IS_TYPHOON:2 == 3 && POWER_WARM_AIR >= 5 && GET_LOCATION_AREA_TYPHOON() == 1
	RETURNF "大雨特别警报"
ELSEIF CONTINUOUS_RAINFALL >= 10
	RETURNF "大雨警报(泥石流灾害警戒情报)"
ELSEIF 线状降水带位置 == "线状降水带势力圏"
	RETURNF "大雨警报(泥石流灾害警戒情报)"
ELSEIF 线状降水带位置 == "线状降水带远方" && IS_LINER_RAINBAND:1 == 2 && TIME_ENTER_TERRITORY_LINER_RAINBAND:1 == DAY:3 && TIME_ENTER_TERRITORY_LINER_RAINBAND:2 <= TIME:0 + 180
	RETURNF "大雨警报(泥石流灾害警戒情报)"
ELSEIF (GET_LOCATION_AREA_TYPHOON() == 1 || 低气圧位置 == "台风势力圏") && IS_TYPHOON:3 == 1
	RETURNF "大雨警报"
ELSEIF GET_LOCATION_AREA_TYPHOON() == 1
	RETURNF "大雨警报"
ELSEIF CAN_CUMULUS:0 == 5 && (积乱云位置 == "积乱云视认" || 积乱云位置 == "积乱云接近" || 积乱云位置 == "积乱云直下")
	RETURNF "大雨警报"
ELSEIF CAN_CUMULUS:0 == 4 && (积乱云位置 == "积乱云接近" || 积乱云位置 == "积乱云直下")
	RETURNF "大雨警报"
ELSEIF CONTINUOUS_RAINFALL >= 5
	RETURNF "大雨警报"
ELSEIF 线状降水带位置 == "线状降水带远方" && IS_LINER_RAINBAND:1 == 2 && TIME_ENTER_TERRITORY_LINER_RAINBAND:1 == DAY:3
	RETURNF "大雨警报"
ELSEIF TIME:5 == 14
	RETURNF "大雨警报"
ELSEIF 线状降水带位置 == "线状降水带远方" && TIME_ENTER_TERRITORY_LINER_RAINBAND:1 == DAY:3 && TIME_ENTER_TERRITORY_LINER_RAINBAND:2 <= TIME:0 + 180
	RETURNF "大雨警报"
ELSEIF GET_LOCATION_AREA_TYPHOON() == 1 || 低气圧位置 == "台风势力圏"
	RETURNF "大雨警报"
ELSEIF 低气圧位置 == "寒冷涡接近" && DAY:2 != 4 && POWER_WARM_AIR != 1
	RETURNF "大雨警报"
ELSEIF CONTINUOUS_RAINFALL >= 1
	RETURNF "大雨警报"
ELSEIF CAN_CUMULUS:0 == 5 && 积乱云位置 == "积乱云远方"
	RETURNF "大雨警报"
ELSEIF CAN_CUMULUS:0 == 4 && (积乱云位置 == "积乱云视认" || (积乱云位置 == "积乱云远方" && TIME:0 >= 720))
	RETURNF "大雨警报"
ELSEIF CAN_CUMULUS:0 == 3 && (积乱云位置 == "积乱云接近" || 积乱云位置 == "积乱云直下")
	RETURNF "大雨警报"
ELSEIF TIME:5 == 5
	RETURNF "大雨警报"
ELSE
	RETURNF "大雨警报未发令"
ENDIF

;大雪
@GET_WEATHER_WARNING_HEAVY_SNOWFALL
#FUNCTIONS
#DIMS 低气圧位置

低气圧位置 = %GET_LOCATION_LOW()%
IF CONTINUOUS_SNOWFALL >= 30
	RETURNF "大雪特别警报"
ELSEIF 低气圧位置 == "二つ玉低气圧接近" || 低气圧位置 == "疑似好天" || 低气圧位置 == "二つ玉低气圧通过中"
	RETURNF "大雪警报"
ELSEIF 低气圧位置 == "日本海低气圧通过中"
	RETURNF "大雪警报"
ELSEIF 低气圧位置 == "寒冷涡接近" && (DAY:2 == 4 || POWER_WARM_AIR == 1) && DAY:2 != 3
	RETURNF "大雪警报"
ELSEIF CONTINUOUS_SNOWFALL >= 15
	RETURNF "大雪警报"
ELSEIF 低气圧位置 == "日本海低气圧接近"
	RETURNF "大雪警报"
ELSEIF 低气圧位置 == "南岸低气圧接近"
	RETURNF "大雪警报"
ELSEIF 低气圧位置 == "寒冷涡远方" && DAY:2 == 4
	RETURNF "大雪警报"
ELSEIF CONTINUOUS_SNOWFALL >= 5
	RETURNF "大雪警报"
ELSE
	RETURNF "大雪警报未发令"
ENDIF

;暴风・暴风雪
@GET_WEATHER_WARNING_STORM
#FUNCTIONS
#DIMS 低气圧位置

低气圧位置 = %GET_LOCATION_LOW()%
IF (低气圧位置 == "疑似好天" || 低气圧位置 == "二つ玉低气圧通过中") && POWER_COLD_AIR >= 4 && POWER_WARM_AIR >= 5
	RETURNF "暴风雪特别警报"
ELSEIF WIND_VELOCITY >= 3 && TIME:5 >= 8 && TIME:5 <= 12
	RETURNF "暴风雪特别警报"
ELSEIF IS_TYPHOON:1 >= 5 && POWER_COLD_AIR == 1 && POWER_WARM_AIR >= 5 && GET_LOCATION_AREA_TYPHOON() == 1
	RETURNF "暴风特别警报"
ELSEIF WIND_VELOCITY >= 3
	RETURNF "暴风特别警报"
ELSEIF 低气圧位置 == "疑似好天" || 低气圧位置 == "二つ玉低气圧通过中"
	RETURNF "暴风雪警报"
ELSEIF 低气圧位置 == "日本海低气圧通过中" && POWER_COLD_AIR >= 4
	RETURNF "暴风雪警报"
ELSEIF (低气圧位置 == "寒冷涡接近" || (低气圧位置 == "寒冷涡远方" && (TIME_ENTER_TERRITORY_COLD_LOW:1 == DAY:3 && TIME_ENTER_TERRITORY_COLD_LOW:2 <= TIME:0 + 180))) && (DAY:2 == 4 || POWER_WARM_AIR == 1) && DAY:2 != 3
	RETURNF "暴风雪警报"
ELSEIF WIND_VELOCITY >= 2 && TIME:5 >= 8 && TIME:5 <= 12
	RETURNF "暴风雪警报"
ELSEIF GET_LOCATION_AREA_TYPHOON() == 1 && IS_TYPHOON:1 >= 3
	RETURNF "暴风警报"
ELSEIF 低气圧位置 == "寒冷涡接近" || (低气圧位置 == "寒冷涡远方" && (TIME_ENTER_TERRITORY_COLD_LOW:1 == DAY:3 && TIME_ENTER_TERRITORY_COLD_LOW:2 <= TIME:0 + 180))
	RETURNF "暴风警报"
ELSEIF WIND_VELOCITY >= 2
	RETURNF "暴风警报"
ELSEIF 低气圧位置 == "二つ玉低气圧接近"
	RETURNF "风雪警报"
ELSEIF 低气圧位置 == "日本海低气圧接近" && POWER_COLD_AIR >= 4
	RETURNF "风雪警报"
ELSEIF WIND_VELOCITY >= 1 && TIME:5 >= 8 && TIME:5 <= 12
	RETURNF "风雪警报"
ELSEIF GET_LOCATION_AREA_TYPHOON() == 1
	RETURNF "强风警报"
ELSEIF (低气圧位置 == "温暖前线接近" || 低气圧位置 == "暖域") && (POWER_WARM_AIR >= 4 || (DAY:2 == 1 && NOW_TERM == 1))
	RETURNF "强风警报"
ELSEIF WIND_VELOCITY >= 1
	RETURNF "强风警报"
ELSE
	RETURNF "强风警报未发令"
ENDIF

;雷・竜卷
@GET_WEATHER_WARNING_LIGHTNING
#FUNCTIONS
#DIMS 低气圧位置
#DIMS 线状降水带位置
#DIMS 积乱云位置

低气圧位置 = %GET_LOCATION_LOW()%
线状降水带位置 = %GET_LOCATION_LINER_RAINBAND()%
积乱云位置 = %GET_LOCATION_CUMULUS()%

IF CAN_CUMULUS:2 == 2 && (积乱云位置 == "积乱云接近" || 积乱云位置 == "积乱云直下")
	RETURNF "雷警报(龙卷风注意情报)"
ELSEIF GET_HEAT_THUNDERSTORM() == 1 && GET_FRONTAL_THUNDERSTORM() == 1 && ATMOSPHERIC_INSTABILITY <= -2
	RETURNF "雷警报(龙卷风注意情报)"
ELSEIF DAY:2 == 2 && (IS_COLD_LOW || 低气圧位置 == "台风势力圏")
	RETURNF "雷警报"
ELSEIF CAN_CUMULUS:0 == 3 && (积乱云位置 == "积乱云接近" || 积乱云位置 == "积乱云直下")
	RETURNF "雷警报"
ELSEIF 线状降水带位置 == "线状降水带势力圏"
	RETURNF "雷警报"
ELSEIF (DAY:2 == 1 || DAY:2 == 3) && (低气圧位置 == "寒冷前线通过" || 低气圧位置 == "暖域") && POWER_WARM_AIR >= 3 && POWER_COLD_AIR >= 4
	RETURNF "雷警报"
ELSEIF GET_HEAT_THUNDERSTORM() == 1
	RETURNF "雷警报"
ELSEIF GET_FRONTAL_THUNDERSTORM() == 1
	RETURNF "雷警报"
ELSE
	RETURNF "雷警报未发令"
ENDIF

;低温
@GET_WEATHER_WARNING_COLD
#FUNCTIONS

IF POWER_COLD_AIR == 5 && DAY:2 == 1
	RETURNF "低温警报"
ELSEIF IS_COLD_CROP_DAMAGE >= 2
	RETURNF "低温警报"
ELSE
	RETURNF "低温警报未发令"
ENDIF

;なだれ
@GET_WEATHER_WARNING_AVALANCHE
#FUNCTIONS
#DIMS 暴风情报

暴风情报 = %GET_WEATHER_WARNING_STORM()%

IF POSSIBLITY_AVALANCHE >= 1
	RETURNF "雪崩警报"
ELSEIF DAY:2 == 1 && NOW_TERM <= 2 && SNOW_COVERAGE + CONTINUOUS_SNOWFALL >= 7
	RETURNF "雪崩警报"
ELSEIF SNOW_COVERAGE + CONTINUOUS_SNOWFALL >= 10
	RETURNF "雪崩警报"
ELSEIF SNOW_COVERAGE >= 15 && CONTINUOUS_SNOWFALL >= 6
	RETURNF "雪崩警报"
ELSEIF SNOW_COVERAGE >= 5 && CONTINUOUS_SNOWFALL >= 5 && 暴风情报 != "强风警报未发令"
	RETURNF "雪崩警报"
ELSE
	RETURNF "雪崩警报未发令"
ENDIF

;早期注意情报（警报级的可能性）
@GET_WEATHER_ADVISORY_probability_subsequent_WARNING
#FUNCTIONS
#DIMS 低气圧位置
#DIMS 线状降水带位置
#DIMS 积乱云位置

低气圧位置 = %GET_LOCATION_LOW()%
线状降水带位置 = %GET_LOCATION_LINER_RAINBAND()%
积乱云位置 = %GET_LOCATION_CUMULUS()%

IF (线状降水带位置 == "线状降水带远方" || 线状降水带位置 == "线状降水带势力圏") && TIME_ENTER_TERRITORY_LINER_RAINBAND:1 <= DAY:3 +1
	RETURNF "警报级的可能性［高］"
ELSEIF IS_LINER_RAINBAND:1
	RETURNF "警报级的可能性［中］"
ELSEIF 低气圧位置 == "台风远方" && IS_TYPHOON:3 == 1 && TIME_ENTER_TERRITORY_TYPHOON:0 == DAY:2 && TIME_ENTER_TERRITORY_TYPHOON:1 <= DAY:3 + 2
	RETURNF "警报级的可能性［高］"
ELSEIF 低气圧位置 == "台风远方" && TIME_ENTER_TERRITORY_TYPHOON:0 == DAY:2 && TIME_ENTER_TERRITORY_TYPHOON:1 <= DAY:3 + 1
	RETURNF "警报级的可能性［中］"
ELSEIF GET_LOCATION_AREA_TYPHOON() == 1 || 低气圧位置 == "台风势力圏"
	RETURNF "警报级的可能性［高］"
ELSEIF GET_HEAT_THUNDERSTORM() && GET_FRONTAL_THUNDERSTORM()
	RETURNF "警报级的可能性［高］"
ELSEIF IS_COLD_LOW
	RETURNF "警报级的可能性［中］"
ELSEIF CONTINUOUS_RAINFALL >= 3
	RETURNF "警报级的可能性［中］"
ELSEIF (IS_SoJ_LOW == 2 && TIME_ENTER_TERRITORY_SoJ_LOW:1 <= DAY:3 + 1) && 低气圧位置 != "二つ玉低气圧通过" && 低气圧位置 != "日本海低气圧通过"
	RETURNF "警报级的可能性［高］"
ELSEIF IS_SoJ_LOW && 低气圧位置 != "二つ玉低气圧通过" && 低气圧位置 != "日本海低气圧通过"
	RETURNF "警报级的可能性［中］"
ELSE
	RETURNF "早期注意情报未发表"
ENDIF

;-------------------------------------------------
;热雷发生フラグ判定
;-------------------------------------------------
@GET_HEAT_THUNDERSTORM
#FUNCTION
#DIMS 积乱云位置
#DIMS 线状降水带位置
#DIMS 低气圧位置

低气圧位置 = %GET_LOCATION_LOW()%
线状降水带位置 = %GET_LOCATION_LINER_RAINBAND()%
积乱云位置 = %GET_LOCATION_CUMULUS()%

IF 线状降水带位置 == "线状降水带势力圏"
	RETURNF 1
ELSEIF 积乱云位置 == "积乱云直下"
	IF CAN_CUMULUS:0 == 3 && ATMOSPHERIC_INSTABILITY <= -3
		RETURNF 1
	ELSEIF CAN_CUMULUS:0 >= 4
		RETURNF 1
	ELSE
		RETURNF 0
	ENDIF
ELSEIF 积乱云位置 == "积乱云接近"
	IF CAN_CUMULUS:0 == 4 && ATMOSPHERIC_INSTABILITY <= -7
		RETURNF 1
	ELSEIF CAN_CUMULUS:0 >= 5
		RETURNF 1
	ELSE
		RETURNF 0
	ENDIF
ELSEIF IS_TYPHOON:3 == 1 && 低气圧位置 == "台风势力圏" && ATMOSPHERIC_INSTABILITY <= -1
	RETURNF 1
ELSEIF (IS_RAINY_SEASON1:0 == 1 || IS_RAINY_SEASON2 == 1) && POWER_WARM_AIR >= 4 && ATMOSPHERIC_INSTABILITY <= 0
	RETURNF 1
ELSEIF (DAY:2 == 1 || DAY:2 == 3) && (低气圧位置 == "温暖前线接近" || 低气圧位置 == "寒冷前线通过" || 低气圧位置 == "寒冷涡接近") && POWER_WARM_AIR >= 5 && ATMOSPHERIC_INSTABILITY <= -1
	RETURNF 1
ELSE
	RETURNF 0
ENDIF

;-------------------------------------------------
;界雷发生フラグ判定
;-------------------------------------------------
@GET_FRONTAL_THUNDERSTORM
#FUNCTION
#DIMS 低气圧位置

低气圧位置 = %GET_LOCATION_LOW()%

IF (DAY:2 == 1 || DAY:2 == 3) && (低气圧位置 == "寒冷前线通过" || 低气圧位置 == "寒冷涡接近") && POWER_WARM_AIR >= 3 && POWER_COLD_AIR >= 4
	RETURNF 1
ELSEIF IS_RAINY_SEASON1:1 == 1
	RETURNF 1
ELSEIF IS_RAINY_SEASON1:0 == 1 && POWER_COLD_AIR >= 4
	RETURNF 1
ELSEIF (低气圧位置 == "二つ玉低气圧接近" || 低气圧位置 == "二つ玉低气圧通过中") && POWER_WARM_AIR >= 3 && POWER_COLD_AIR >= 3
	RETURNF 1
ELSEIF (低气圧位置 == "日本海低气圧接近" || 低气圧位置 == "日本海低气圧通过中") && POWER_WARM_AIR >= 3 && POWER_COLD_AIR >= 3
	RETURNF 1
ELSE
	RETURNF 0
ENDIF

;-------------------------------------------------
;天候が雷であるか
;-------------------------------------------------
@GET_WEATHER_THUNDERSTORM
#FUNCTION

IF (GET_HEAT_THUNDERSTORM() == 1 || GET_FRONTAL_THUNDERSTORM() == 1) && TIME:5 != 1 && (FLAG:异常气象 == 0 || FLAG:异常气象 == 9 || FLAG:异常气象 == 10) && !FORBIDDEN_CHANGE_WEATHER
	RETURNF 1
ELSE
	RETURNF 0
ENDIF

;-------------------------------------------------
;天候システム上の时间带に応じた名前を返す
;-------------------------------------------------
@GET_NAME_WEATHER_TIMEZOME(ARG = -1)
#FUNCTIONS

SIF ARG == -1
	ARG = TIME

SELECTCASE ARG
	;AM0~3
	CASE 0 TO 179
		RETURNF "未明"
	;AM3~6
	CASE 180 TO 359
		RETURNF "明け方"
	;AM6~9
	CASE 360 TO 539
		RETURNF "朝"
	;AM9~12
	CASE 540 TO 719
		RETURNF "昼前"
	;PM0~3
	CASE 720 TO 899
		RETURNF "昼过ぎ"
	;PM3~6
	CASE 900 TO 1079
		RETURNF "夕方"
	;PM6~9
	CASE 1080 TO 1259
		RETURNF "夜のはじめ顷"
	;PM9~12
	CASE IS >= 1260
		RETURNF "夜遅く"
	CASEELSE
		RETURNF "时间带エラー"
ENDSELECT

;-------------------------------------------------
;台风接近时・猛吹雪时にFLAG:异常气象を设定する
;-------------------------------------------------
@SET_ABNORMAL_WEATHER

IF GET_LOCATION_AREA_TYPHOON() == 1
	FLAG:异常气象 = 9
ELSEIF TIME:5 >= 8 && TIME:5 <= 13 && GET_HEAT_THUNDERSTORM() == 0 && GET_FRONTAL_THUNDERSTORM() == 0 && WIND_VELOCITY >= 2
	FLAG:异常气象 = 10
ELSE
	FLAG:异常气象 = 0
ENDIF

;-------------------------------------------------
;时刻・天候に応じて背景色を变更
;2022/11/23改造
;	・设定すべき背景色と现在背景色を比较し、同じ色なら变更を飞ばす处理(@SET_MAP_WEATHER_BGCOLOR_NEW)
;	・背景色变更处理の前にREDRAW 1をセットし、函数结束后に戻す处理
;	・USE_NEWに0をセットすることで旧处理に戻せる
;2023/01/01改变
;	・旧函数の互换处理を削除、描画制御と背景色比较处理のみに变更
;-------------------------------------------------
@SET_MAP_WEATHER_BGCOLOR
#DIM CURRED		;CURRENT REDRAW。CURRENTREDRAWを保存
#DIM NEXTCOLOR
#DIMS 低气圧位置
#DIMS 积乱云位置

SIF FLAG:时间停止 || !FLAG:背景色推移
	RETURN
CURRED = CURRENTREDRAW()
REDRAW 0

低气圧位置 = %GET_LOCATION_LOW()%
积乱云位置 = %GET_LOCATION_CUMULUS()%
SELECTCASE TIME:0
	;AM4~6　早朝
	CASE 240 TO 359
		SELECTCASE TIME:5
			CASE 6, 7, 11
				NEXTCOLOR = C_MAP_雾_夜
			CASE 8, 9, 10, 12
				NEXTCOLOR = C_MAP_雪_夜
			CASEELSE
				NEXTCOLOR = C_MAP_晴天_早朝
		ENDSELECT
	
	;AM6~8　正午前
	CASE 360 TO 479
		SELECTCASE TIME:5
			CASE IS <= 3
				IF 低气圧位置 == "台风势力圏"
					NEXTCOLOR = C_MAP_夕烧け_台风
				ELSEIF (低气圧位置 == "寒冷涡接近" && DAY:2 != 2) || (IS_COLD_LOW && DAY:2 == 2) || 低气圧位置 == "二つ玉低气圧接近" || 低气圧位置 == "日本海低气圧接近" || 低气圧位置 == "南岸低气圧接近" || 低气圧位置 == "温暖前线接近"
					NEXTCOLOR = C_MAP_夕烧け_低气圧
				ELSE
					NEXTCOLOR = C_MAP_晴天_朝
				ENDIF
			CASE 6, 7, 11
				NEXTCOLOR = C_MAP_雾_昼
			CASE 4, 5, 13, 14, 15
				NEXTCOLOR = C_MAP_雨_昼
			CASE 8, 9, 10, 12
				NEXTCOLOR = C_MAP_雪_昼
			CASEELSE
				NEXTCOLOR = C_MAP_晴天_朝
		ENDSELECT
	
	;AM8~12　正午前
	CASE 480 TO 719
		SELECTCASE TIME:5
			CASE 0, 1, 2
				NEXTCOLOR = C_MAP_晴天_朝
			CASE 3
				NEXTCOLOR = C_MAP_阴天_昼
			CASE 6, 7, 11
				NEXTCOLOR = C_MAP_雾_昼
			CASE 4, 5, 13, 14, 15
				NEXTCOLOR = C_MAP_雨_昼
			CASE 8, 9, 10, 12
				NEXTCOLOR = C_MAP_雪_昼
			CASEELSE
				NEXTCOLOR = C_MAP_晴天_朝
		ENDSELECT
	
	;PM12~6　昼
	CASE 720 TO 1079
		SELECTCASE 积乱云位置
			CASE "积乱云接近", "积乱云直下"
				SELECTCASE CAN_CUMULUS:0
				CASE 3, 4, 5
					NEXTCOLOR = C_MAP_积乱云_昼
				CASEELSE
					NEXTCOLOR = C_MAP_阴天_昼
				ENDSELECT
			CASEELSE
				SELECTCASE TIME:5
					CASE 0, 1
						NEXTCOLOR = C_MAP_晴天_昼
					CASE 2
						NEXTCOLOR = C_MAP_多云_昼
					CASE 3
						NEXTCOLOR = C_MAP_阴天_昼
					CASE 6, 7, 11
						NEXTCOLOR = C_MAP_雾_昼
					CASE 4, 5, 13, 14, 15
						NEXTCOLOR = C_MAP_雨_昼
					CASE 8, 9, 10, 12
						NEXTCOLOR = C_MAP_雪_昼
					CASEELSE
						NEXTCOLOR = C_MAP_晴天_昼
				ENDSELECT
		ENDSELECT
	
	;PM6~8　夕
	CASE 1080 TO 1199
		SELECTCASE TIME:5
			CASE IS <= 3
				IF 低气圧位置 == "台风势力圏"
					NEXTCOLOR = C_MAP_夕烧け_台风
				ELSEIF 低气圧位置 == "寒冷涡接近" || IS_COLD_LOW || 低气圧位置 == "二つ玉低气圧接近" || 低气圧位置 == "日本海低气圧接近" || 低气圧位置 == "南岸低气圧接近" || 低气圧位置 == "温暖前线接近"
					NEXTCOLOR = C_MAP_夕烧け_低气圧
				ELSE
					NEXTCOLOR = C_MAP_夕烧け_通常
				ENDIF
			CASE 6, 7, 11
				NEXTCOLOR = C_MAP_雾_昼
			CASE 4, 5, 13, 14, 15
				NEXTCOLOR = C_MAP_雨_昼
			CASE 8, 9, 10, 12
				NEXTCOLOR = C_MAP_雪_昼
			CASEELSE
				NEXTCOLOR = C_MAP_夕烧け_通常
		ENDSELECT
	
	;PM8~AM4　夜・深夜
	CASE 0 TO 239, IS >= 1200
		SELECTCASE TIME:5
			CASE 0, 1, 2
				NEXTCOLOR = C_MAP_晴天_夜
			CASE 6, 7, 11
				NEXTCOLOR = C_MAP_雾_夜
			CASE 3, 4, 5, 13, 14, 15
				NEXTCOLOR = C_MAP_阴天_夜
			CASE 8, 9, 10, 12
				NEXTCOLOR = C_MAP_雪_夜
			CASEELSE
				NEXTCOLOR = C_MAP_晴天_夜
		ENDSELECT
ENDSELECT

SIF NEXTCOLOR != GETBGCOLOR()
	SETBGCOLOR NEXTCOLOR
REDRAW CURRED

;-------------------------------------------------
;现在の气温
;基礎气温に天候倾向・寒气・暖气・场所に応じた补正を加えて现在の气温を算定する
;-------------------------------------------------
@GET_现在气温
#FUNCTION
#DIM 基礎气温
#DIM HOUR
#DIM 现在マップ
#DIM 现在お出かけマップ
#DIM 高度补正
#DIM 气流补正
#DIM 建造物补正
#DIM 日射补正
#DIM 现在场所
#DIM 补正温度

HOUR = TIME:0 / 60

;现在の基礎气温を取得
SELECTCASE DAY:2
	CASE 1
		SELECTCASE NOW_TERM
			CASE 1
				SELECTCASE HOUR
					CASE 0
						基礎气温 = 气温_春_1T_0时
					CASE 1
						基礎气温 = 气温_春_1T_1时
					CASE 2
						基礎气温 = 气温_春_1T_2时
					CASE 3
						基礎气温 = 气温_春_1T_3时
					CASE 4
						基礎气温 = 气温_春_1T_4时
					CASE 5
						基礎气温 = 气温_春_1T_5时
					CASE 6
						基礎气温 = 气温_春_1T_6时
					CASE 7
						基礎气温 = 气温_春_1T_7时
					CASE 8
						基礎气温 = 气温_春_1T_8时
					CASE 9
						基礎气温 = 气温_春_1T_9时
					CASE 10
						基礎气温 = 气温_春_1T_10时
					CASE 11
						基礎气温 = 气温_春_1T_11时
					CASE 12
						基礎气温 = 气温_春_1T_12时
					CASE 13
						基礎气温 = 气温_春_1T_13时
					CASE 14
						基礎气温 = 气温_春_1T_14时
					CASE 15
						基礎气温 = 气温_春_1T_15时
					CASE 16
						基礎气温 = 气温_春_1T_16时
					CASE 17
						基礎气温 = 气温_春_1T_17时
					CASE 18
						基礎气温 = 气温_春_1T_18时
					CASE 19
						基礎气温 = 气温_春_1T_19时
					CASE 20
						基礎气温 = 气温_春_1T_20时
					CASE 21
						基礎气温 = 气温_春_1T_21时
					CASE 22
						基礎气温 = 气温_春_1T_22时
					CASE 23
						基礎气温 = 气温_春_1T_23时
				ENDSELECT
			CASE 2
				SELECTCASE HOUR
					CASE 0
						基礎气温 = 气温_春_2T_0时
					CASE 1
						基礎气温 = 气温_春_2T_1时
					CASE 2
						基礎气温 = 气温_春_2T_2时
					CASE 3
						基礎气温 = 气温_春_2T_3时
					CASE 4
						基礎气温 = 气温_春_2T_4时
					CASE 5
						基礎气温 = 气温_春_2T_5时
					CASE 6
						基礎气温 = 气温_春_2T_6时
					CASE 7
						基礎气温 = 气温_春_2T_7时
					CASE 8
						基礎气温 = 气温_春_2T_8时
					CASE 9
						基礎气温 = 气温_春_2T_9时
					CASE 10
						基礎气温 = 气温_春_2T_10时
					CASE 11
						基礎气温 = 气温_春_2T_11时
					CASE 12
						基礎气温 = 气温_春_2T_12时
					CASE 13
						基礎气温 = 气温_春_2T_13时
					CASE 14
						基礎气温 = 气温_春_2T_14时
					CASE 15
						基礎气温 = 气温_春_2T_15时
					CASE 16
						基礎气温 = 气温_春_2T_16时
					CASE 17
						基礎气温 = 气温_春_2T_17时
					CASE 18
						基礎气温 = 气温_春_2T_18时
					CASE 19
						基礎气温 = 气温_春_2T_19时
					CASE 20
						基礎气温 = 气温_春_2T_20时
					CASE 21
						基礎气温 = 气温_春_2T_21时
					CASE 22
						基礎气温 = 气温_春_2T_22时
					CASE 23
						基礎气温 = 气温_春_2T_23时
				ENDSELECT
			CASE 3
				SELECTCASE HOUR
					CASE 0
						基礎气温 = 气温_春_3T_0时
					CASE 1
						基礎气温 = 气温_春_3T_1时
					CASE 2
						基礎气温 = 气温_春_3T_2时
					CASE 3
						基礎气温 = 气温_春_3T_3时
					CASE 4
						基礎气温 = 气温_春_3T_4时
					CASE 5
						基礎气温 = 气温_春_3T_5时
					CASE 6
						基礎气温 = 气温_春_3T_6时
					CASE 7
						基礎气温 = 气温_春_3T_7时
					CASE 8
						基礎气温 = 气温_春_3T_8时
					CASE 9
						基礎气温 = 气温_春_3T_9时
					CASE 10
						基礎气温 = 气温_春_3T_10时
					CASE 11
						基礎气温 = 气温_春_3T_11时
					CASE 12
						基礎气温 = 气温_春_3T_12时
					CASE 13
						基礎气温 = 气温_春_3T_13时
					CASE 14
						基礎气温 = 气温_春_3T_14时
					CASE 15
						基礎气温 = 气温_春_3T_15时
					CASE 16
						基礎气温 = 气温_春_3T_16时
					CASE 17
						基礎气温 = 气温_春_3T_17时
					CASE 18
						基礎气温 = 气温_春_3T_18时
					CASE 19
						基礎气温 = 气温_春_3T_19时
					CASE 20
						基礎气温 = 气温_春_3T_20时
					CASE 21
						基礎气温 = 气温_春_3T_21时
					CASE 22
						基礎气温 = 气温_春_3T_22时
					CASE 23
						基礎气温 = 气温_春_3T_23时
				ENDSELECT
			CASE 4
				SELECTCASE HOUR
					CASE 0
						基礎气温 = 气温_春_4T_0时
					CASE 1
						基礎气温 = 气温_春_4T_1时
					CASE 2
						基礎气温 = 气温_春_4T_2时
					CASE 3
						基礎气温 = 气温_春_4T_3时
					CASE 4
						基礎气温 = 气温_春_4T_4时
					CASE 5
						基礎气温 = 气温_春_4T_5时
					CASE 6
						基礎气温 = 气温_春_4T_6时
					CASE 7
						基礎气温 = 气温_春_4T_7时
					CASE 8
						基礎气温 = 气温_春_4T_8时
					CASE 9
						基礎气温 = 气温_春_4T_9时
					CASE 10
						基礎气温 = 气温_春_4T_10时
					CASE 11
						基礎气温 = 气温_春_4T_11时
					CASE 12
						基礎气温 = 气温_春_4T_12时
					CASE 13
						基礎气温 = 气温_春_4T_13时
					CASE 14
						基礎气温 = 气温_春_4T_14时
					CASE 15
						基礎气温 = 气温_春_4T_15时
					CASE 16
						基礎气温 = 气温_春_4T_16时
					CASE 17
						基礎气温 = 气温_春_4T_17时
					CASE 18
						基礎气温 = 气温_春_4T_18时
					CASE 19
						基礎气温 = 气温_春_4T_19时
					CASE 20
						基礎气温 = 气温_春_4T_20时
					CASE 21
						基礎气温 = 气温_春_4T_21时
					CASE 22
						基礎气温 = 气温_春_4T_22时
					CASE 23
						基礎气温 = 气温_春_4T_23时
				ENDSELECT
			CASE 5
				SELECTCASE HOUR
					CASE 0
						基礎气温 = 气温_春_5T_0时
					CASE 1
						基礎气温 = 气温_春_5T_1时
					CASE 2
						基礎气温 = 气温_春_5T_2时
					CASE 3
						基礎气温 = 气温_春_5T_3时
					CASE 4
						基礎气温 = 气温_春_5T_4时
					CASE 5
						基礎气温 = 气温_春_5T_5时
					CASE 6
						基礎气温 = 气温_春_5T_6时
					CASE 7
						基礎气温 = 气温_春_5T_7时
					CASE 8
						基礎气温 = 气温_春_5T_8时
					CASE 9
						基礎气温 = 气温_春_5T_9时
					CASE 10
						基礎气温 = 气温_春_5T_10时
					CASE 11
						基礎气温 = 气温_春_5T_11时
					CASE 12
						基礎气温 = 气温_春_5T_12时
					CASE 13
						基礎气温 = 气温_春_5T_13时
					CASE 14
						基礎气温 = 气温_春_5T_14时
					CASE 15
						基礎气温 = 气温_春_5T_15时
					CASE 16
						基礎气温 = 气温_春_5T_16时
					CASE 17
						基礎气温 = 气温_春_5T_17时
					CASE 18
						基礎气温 = 气温_春_5T_18时
					CASE 19
						基礎气温 = 气温_春_5T_19时
					CASE 20
						基礎气温 = 气温_春_5T_20时
					CASE 21
						基礎气温 = 气温_春_5T_21时
					CASE 22
						基礎气温 = 气温_春_5T_22时
					CASE 23
						基礎气温 = 气温_春_5T_23时
				ENDSELECT
			CASE 6
				SELECTCASE HOUR
					CASE 0
						基礎气温 = 气温_春_6T_0时
					CASE 1
						基礎气温 = 气温_春_6T_1时
					CASE 2
						基礎气温 = 气温_春_6T_2时
					CASE 3
						基礎气温 = 气温_春_6T_3时
					CASE 4
						基礎气温 = 气温_春_6T_4时
					CASE 5
						基礎气温 = 气温_春_6T_5时
					CASE 6
						基礎气温 = 气温_春_6T_6时
					CASE 7
						基礎气温 = 气温_春_6T_7时
					CASE 8
						基礎气温 = 气温_春_6T_8时
					CASE 9
						基礎气温 = 气温_春_6T_9时
					CASE 10
						基礎气温 = 气温_春_6T_10时
					CASE 11
						基礎气温 = 气温_春_6T_11时
					CASE 12
						基礎气温 = 气温_春_6T_12时
					CASE 13
						基礎气温 = 气温_春_6T_13时
					CASE 14
						基礎气温 = 气温_春_6T_14时
					CASE 15
						基礎气温 = 气温_春_6T_15时
					CASE 16
						基礎气温 = 气温_春_6T_16时
					CASE 17
						基礎气温 = 气温_春_6T_17时
					CASE 18
						基礎气温 = 气温_春_6T_18时
					CASE 19
						基礎气温 = 气温_春_6T_19时
					CASE 20
						基礎气温 = 气温_春_6T_20时
					CASE 21
						基礎气温 = 气温_春_6T_21时
					CASE 22
						基礎气温 = 气温_春_6T_22时
					CASE 23
						基礎气温 = 气温_春_6T_23时
				ENDSELECT
		ENDSELECT
	CASE 2
		SELECTCASE NOW_TERM
			CASE 1
				SELECTCASE HOUR
					CASE 0
						基礎气温 = 气温_夏_1T_0时
					CASE 1
						基礎气温 = 气温_夏_1T_1时
					CASE 2
						基礎气温 = 气温_夏_1T_2时
					CASE 3
						基礎气温 = 气温_夏_1T_3时
					CASE 4
						基礎气温 = 气温_夏_1T_4时
					CASE 5
						基礎气温 = 气温_夏_1T_5时
					CASE 6
						基礎气温 = 气温_夏_1T_6时
					CASE 7
						基礎气温 = 气温_夏_1T_7时
					CASE 8
						基礎气温 = 气温_夏_1T_8时
					CASE 9
						基礎气温 = 气温_夏_1T_9时
					CASE 10
						基礎气温 = 气温_夏_1T_10时
					CASE 11
						基礎气温 = 气温_夏_1T_11时
					CASE 12
						基礎气温 = 气温_夏_1T_12时
					CASE 13
						基礎气温 = 气温_夏_1T_13时
					CASE 14
						基礎气温 = 气温_夏_1T_14时
					CASE 15
						基礎气温 = 气温_夏_1T_15时
					CASE 16
						基礎气温 = 气温_夏_1T_16时
					CASE 17
						基礎气温 = 气温_夏_1T_17时
					CASE 18
						基礎气温 = 气温_夏_1T_18时
					CASE 19
						基礎气温 = 气温_夏_1T_19时
					CASE 20
						基礎气温 = 气温_夏_1T_20时
					CASE 21
						基礎气温 = 气温_夏_1T_21时
					CASE 22
						基礎气温 = 气温_夏_1T_22时
					CASE 23
						基礎气温 = 气温_夏_1T_23时
				ENDSELECT
			CASE 2
				SELECTCASE HOUR
					CASE 0
						基礎气温 = 气温_夏_2T_0时
					CASE 1
						基礎气温 = 气温_夏_2T_1时
					CASE 2
						基礎气温 = 气温_夏_2T_2时
					CASE 3
						基礎气温 = 气温_夏_2T_3时
					CASE 4
						基礎气温 = 气温_夏_2T_4时
					CASE 5
						基礎气温 = 气温_夏_2T_5时
					CASE 6
						基礎气温 = 气温_夏_2T_6时
					CASE 7
						基礎气温 = 气温_夏_2T_7时
					CASE 8
						基礎气温 = 气温_夏_2T_8时
					CASE 9
						基礎气温 = 气温_夏_2T_9时
					CASE 10
						基礎气温 = 气温_夏_2T_10时
					CASE 11
						基礎气温 = 气温_夏_2T_11时
					CASE 12
						基礎气温 = 气温_夏_2T_12时
					CASE 13
						基礎气温 = 气温_夏_2T_13时
					CASE 14
						基礎气温 = 气温_夏_2T_14时
					CASE 15
						基礎气温 = 气温_夏_2T_15时
					CASE 16
						基礎气温 = 气温_夏_2T_16时
					CASE 17
						基礎气温 = 气温_夏_2T_17时
					CASE 18
						基礎气温 = 气温_夏_2T_18时
					CASE 19
						基礎气温 = 气温_夏_2T_19时
					CASE 20
						基礎气温 = 气温_夏_2T_20时
					CASE 21
						基礎气温 = 气温_夏_2T_21时
					CASE 22
						基礎气温 = 气温_夏_2T_22时
					CASE 23
						基礎气温 = 气温_夏_2T_23时
				ENDSELECT
			CASE 3
				SELECTCASE HOUR
					CASE 0
						基礎气温 = 气温_夏_3T_0时
					CASE 1
						基礎气温 = 气温_夏_3T_1时
					CASE 2
						基礎气温 = 气温_夏_3T_2时
					CASE 3
						基礎气温 = 气温_夏_3T_3时
					CASE 4
						基礎气温 = 气温_夏_3T_4时
					CASE 5
						基礎气温 = 气温_夏_3T_5时
					CASE 6
						基礎气温 = 气温_夏_3T_6时
					CASE 7
						基礎气温 = 气温_夏_3T_7时
					CASE 8
						基礎气温 = 气温_夏_3T_8时
					CASE 9
						基礎气温 = 气温_夏_3T_9时
					CASE 10
						基礎气温 = 气温_夏_3T_10时
					CASE 11
						基礎气温 = 气温_夏_3T_11时
					CASE 12
						基礎气温 = 气温_夏_3T_12时
					CASE 13
						基礎气温 = 气温_夏_3T_13时
					CASE 14
						基礎气温 = 气温_夏_3T_14时
					CASE 15
						基礎气温 = 气温_夏_3T_15时
					CASE 16
						基礎气温 = 气温_夏_3T_16时
					CASE 17
						基礎气温 = 气温_夏_3T_17时
					CASE 18
						基礎气温 = 气温_夏_3T_18时
					CASE 19
						基礎气温 = 气温_夏_3T_19时
					CASE 20
						基礎气温 = 气温_夏_3T_20时
					CASE 21
						基礎气温 = 气温_夏_3T_21时
					CASE 22
						基礎气温 = 气温_夏_3T_22时
					CASE 23
						基礎气温 = 气温_夏_3T_23时
				ENDSELECT
			CASE 4
				SELECTCASE HOUR
					CASE 0
						基礎气温 = 气温_夏_4T_0时
					CASE 1
						基礎气温 = 气温_夏_4T_1时
					CASE 2
						基礎气温 = 气温_夏_4T_2时
					CASE 3
						基礎气温 = 气温_夏_4T_3时
					CASE 4
						基礎气温 = 气温_夏_4T_4时
					CASE 5
						基礎气温 = 气温_夏_4T_5时
					CASE 6
						基礎气温 = 气温_夏_4T_6时
					CASE 7
						基礎气温 = 气温_夏_4T_7时
					CASE 8
						基礎气温 = 气温_夏_4T_8时
					CASE 9
						基礎气温 = 气温_夏_4T_9时
					CASE 10
						基礎气温 = 气温_夏_4T_10时
					CASE 11
						基礎气温 = 气温_夏_4T_11时
					CASE 12
						基礎气温 = 气温_夏_4T_12时
					CASE 13
						基礎气温 = 气温_夏_4T_13时
					CASE 14
						基礎气温 = 气温_夏_4T_14时
					CASE 15
						基礎气温 = 气温_夏_4T_15时
					CASE 16
						基礎气温 = 气温_夏_4T_16时
					CASE 17
						基礎气温 = 气温_夏_4T_17时
					CASE 18
						基礎气温 = 气温_夏_4T_18时
					CASE 19
						基礎气温 = 气温_夏_4T_19时
					CASE 20
						基礎气温 = 气温_夏_4T_20时
					CASE 21
						基礎气温 = 气温_夏_4T_21时
					CASE 22
						基礎气温 = 气温_夏_4T_22时
					CASE 23
						基礎气温 = 气温_夏_4T_23时
				ENDSELECT
			CASE 5
				SELECTCASE HOUR
					CASE 0
						基礎气温 = 气温_夏_5T_0时
					CASE 1
						基礎气温 = 气温_夏_5T_1时
					CASE 2
						基礎气温 = 气温_夏_5T_2时
					CASE 3
						基礎气温 = 气温_夏_5T_3时
					CASE 4
						基礎气温 = 气温_夏_5T_4时
					CASE 5
						基礎气温 = 气温_夏_5T_5时
					CASE 6
						基礎气温 = 气温_夏_5T_6时
					CASE 7
						基礎气温 = 气温_夏_5T_7时
					CASE 8
						基礎气温 = 气温_夏_5T_8时
					CASE 9
						基礎气温 = 气温_夏_5T_9时
					CASE 10
						基礎气温 = 气温_夏_5T_10时
					CASE 11
						基礎气温 = 气温_夏_5T_11时
					CASE 12
						基礎气温 = 气温_夏_5T_12时
					CASE 13
						基礎气温 = 气温_夏_5T_13时
					CASE 14
						基礎气温 = 气温_夏_5T_14时
					CASE 15
						基礎气温 = 气温_夏_5T_15时
					CASE 16
						基礎气温 = 气温_夏_5T_16时
					CASE 17
						基礎气温 = 气温_夏_5T_17时
					CASE 18
						基礎气温 = 气温_夏_5T_18时
					CASE 19
						基礎气温 = 气温_夏_5T_19时
					CASE 20
						基礎气温 = 气温_夏_5T_20时
					CASE 21
						基礎气温 = 气温_夏_5T_21时
					CASE 22
						基礎气温 = 气温_夏_5T_22时
					CASE 23
						基礎气温 = 气温_夏_5T_23时
				ENDSELECT
			CASE 6
				SELECTCASE HOUR
					CASE 0
						基礎气温 = 气温_夏_6T_0时
					CASE 1
						基礎气温 = 气温_夏_6T_1时
					CASE 2
						基礎气温 = 气温_夏_6T_2时
					CASE 3
						基礎气温 = 气温_夏_6T_3时
					CASE 4
						基礎气温 = 气温_夏_6T_4时
					CASE 5
						基礎气温 = 气温_夏_6T_5时
					CASE 6
						基礎气温 = 气温_夏_6T_6时
					CASE 7
						基礎气温 = 气温_夏_6T_7时
					CASE 8
						基礎气温 = 气温_夏_6T_8时
					CASE 9
						基礎气温 = 气温_夏_6T_9时
					CASE 10
						基礎气温 = 气温_夏_6T_10时
					CASE 11
						基礎气温 = 气温_夏_6T_11时
					CASE 12
						基礎气温 = 气温_夏_6T_12时
					CASE 13
						基礎气温 = 气温_夏_6T_13时
					CASE 14
						基礎气温 = 气温_夏_6T_14时
					CASE 15
						基礎气温 = 气温_夏_6T_15时
					CASE 16
						基礎气温 = 气温_夏_6T_16时
					CASE 17
						基礎气温 = 气温_夏_6T_17时
					CASE 18
						基礎气温 = 气温_夏_6T_18时
					CASE 19
						基礎气温 = 气温_夏_6T_19时
					CASE 20
						基礎气温 = 气温_夏_6T_20时
					CASE 21
						基礎气温 = 气温_夏_6T_21时
					CASE 22
						基礎气温 = 气温_夏_6T_22时
					CASE 23
						基礎气温 = 气温_夏_6T_23时
				ENDSELECT
		ENDSELECT
	CASE 3
		SELECTCASE NOW_TERM
			CASE 1
				SELECTCASE HOUR
					CASE 0
						基礎气温 = 气温_秋_1T_0时
					CASE 1
						基礎气温 = 气温_秋_1T_1时
					CASE 2
						基礎气温 = 气温_秋_1T_2时
					CASE 3
						基礎气温 = 气温_秋_1T_3时
					CASE 4
						基礎气温 = 气温_秋_1T_4时
					CASE 5
						基礎气温 = 气温_秋_1T_5时
					CASE 6
						基礎气温 = 气温_秋_1T_6时
					CASE 7
						基礎气温 = 气温_秋_1T_7时
					CASE 8
						基礎气温 = 气温_秋_1T_8时
					CASE 9
						基礎气温 = 气温_秋_1T_9时
					CASE 10
						基礎气温 = 气温_秋_1T_10时
					CASE 11
						基礎气温 = 气温_秋_1T_11时
					CASE 12
						基礎气温 = 气温_秋_1T_12时
					CASE 13
						基礎气温 = 气温_秋_1T_13时
					CASE 14
						基礎气温 = 气温_秋_1T_14时
					CASE 15
						基礎气温 = 气温_秋_1T_15时
					CASE 16
						基礎气温 = 气温_秋_1T_16时
					CASE 17
						基礎气温 = 气温_秋_1T_17时
					CASE 18
						基礎气温 = 气温_秋_1T_18时
					CASE 19
						基礎气温 = 气温_秋_1T_19时
					CASE 20
						基礎气温 = 气温_秋_1T_20时
					CASE 21
						基礎气温 = 气温_秋_1T_21时
					CASE 22
						基礎气温 = 气温_秋_1T_22时
					CASE 23
						基礎气温 = 气温_秋_1T_23时
				ENDSELECT
			CASE 2
				SELECTCASE HOUR
					CASE 0
						基礎气温 = 气温_秋_2T_0时
					CASE 1
						基礎气温 = 气温_秋_2T_1时
					CASE 2
						基礎气温 = 气温_秋_2T_2时
					CASE 3
						基礎气温 = 气温_秋_2T_3时
					CASE 4
						基礎气温 = 气温_秋_2T_4时
					CASE 5
						基礎气温 = 气温_秋_2T_5时
					CASE 6
						基礎气温 = 气温_秋_2T_6时
					CASE 7
						基礎气温 = 气温_秋_2T_7时
					CASE 8
						基礎气温 = 气温_秋_2T_8时
					CASE 9
						基礎气温 = 气温_秋_2T_9时
					CASE 10
						基礎气温 = 气温_秋_2T_10时
					CASE 11
						基礎气温 = 气温_秋_2T_11时
					CASE 12
						基礎气温 = 气温_秋_2T_12时
					CASE 13
						基礎气温 = 气温_秋_2T_13时
					CASE 14
						基礎气温 = 气温_秋_2T_14时
					CASE 15
						基礎气温 = 气温_秋_2T_15时
					CASE 16
						基礎气温 = 气温_秋_2T_16时
					CASE 17
						基礎气温 = 气温_秋_2T_17时
					CASE 18
						基礎气温 = 气温_秋_2T_18时
					CASE 19
						基礎气温 = 气温_秋_2T_19时
					CASE 20
						基礎气温 = 气温_秋_2T_20时
					CASE 21
						基礎气温 = 气温_秋_2T_21时
					CASE 22
						基礎气温 = 气温_秋_2T_22时
					CASE 23
						基礎气温 = 气温_秋_2T_23时
				ENDSELECT
			CASE 3
				SELECTCASE HOUR
					CASE 0
						基礎气温 = 气温_秋_3T_0时
					CASE 1
						基礎气温 = 气温_秋_3T_1时
					CASE 2
						基礎气温 = 气温_秋_3T_2时
					CASE 3
						基礎气温 = 气温_秋_3T_3时
					CASE 4
						基礎气温 = 气温_秋_3T_4时
					CASE 5
						基礎气温 = 气温_秋_3T_5时
					CASE 6
						基礎气温 = 气温_秋_3T_6时
					CASE 7
						基礎气温 = 气温_秋_3T_7时
					CASE 8
						基礎气温 = 气温_秋_3T_8时
					CASE 9
						基礎气温 = 气温_秋_3T_9时
					CASE 10
						基礎气温 = 气温_秋_3T_10时
					CASE 11
						基礎气温 = 气温_秋_3T_11时
					CASE 12
						基礎气温 = 气温_秋_3T_12时
					CASE 13
						基礎气温 = 气温_秋_3T_13时
					CASE 14
						基礎气温 = 气温_秋_3T_14时
					CASE 15
						基礎气温 = 气温_秋_3T_15时
					CASE 16
						基礎气温 = 气温_秋_3T_16时
					CASE 17
						基礎气温 = 气温_秋_3T_17时
					CASE 18
						基礎气温 = 气温_秋_3T_18时
					CASE 19
						基礎气温 = 气温_秋_3T_19时
					CASE 20
						基礎气温 = 气温_秋_3T_20时
					CASE 21
						基礎气温 = 气温_秋_3T_21时
					CASE 22
						基礎气温 = 气温_秋_3T_22时
					CASE 23
						基礎气温 = 气温_秋_3T_23时
				ENDSELECT
			CASE 4
				SELECTCASE HOUR
					CASE 0
						基礎气温 = 气温_秋_4T_0时
					CASE 1
						基礎气温 = 气温_秋_4T_1时
					CASE 2
						基礎气温 = 气温_秋_4T_2时
					CASE 3
						基礎气温 = 气温_秋_4T_3时
					CASE 4
						基礎气温 = 气温_秋_4T_4时
					CASE 5
						基礎气温 = 气温_秋_4T_5时
					CASE 6
						基礎气温 = 气温_秋_4T_6时
					CASE 7
						基礎气温 = 气温_秋_4T_7时
					CASE 8
						基礎气温 = 气温_秋_4T_8时
					CASE 9
						基礎气温 = 气温_秋_4T_9时
					CASE 10
						基礎气温 = 气温_秋_4T_10时
					CASE 11
						基礎气温 = 气温_秋_4T_11时
					CASE 12
						基礎气温 = 气温_秋_4T_12时
					CASE 13
						基礎气温 = 气温_秋_4T_13时
					CASE 14
						基礎气温 = 气温_秋_4T_14时
					CASE 15
						基礎气温 = 气温_秋_4T_15时
					CASE 16
						基礎气温 = 气温_秋_4T_16时
					CASE 17
						基礎气温 = 气温_秋_4T_17时
					CASE 18
						基礎气温 = 气温_秋_4T_18时
					CASE 19
						基礎气温 = 气温_秋_4T_19时
					CASE 20
						基礎气温 = 气温_秋_4T_20时
					CASE 21
						基礎气温 = 气温_秋_4T_21时
					CASE 22
						基礎气温 = 气温_秋_4T_22时
					CASE 23
						基礎气温 = 气温_秋_4T_23时
				ENDSELECT
			CASE 5
				SELECTCASE HOUR
					CASE 0
						基礎气温 = 气温_秋_5T_0时
					CASE 1
						基礎气温 = 气温_秋_5T_1时
					CASE 2
						基礎气温 = 气温_秋_5T_2时
					CASE 3
						基礎气温 = 气温_秋_5T_3时
					CASE 4
						基礎气温 = 气温_秋_5T_4时
					CASE 5
						基礎气温 = 气温_秋_5T_5时
					CASE 6
						基礎气温 = 气温_秋_5T_6时
					CASE 7
						基礎气温 = 气温_秋_5T_7时
					CASE 8
						基礎气温 = 气温_秋_5T_8时
					CASE 9
						基礎气温 = 气温_秋_5T_9时
					CASE 10
						基礎气温 = 气温_秋_5T_10时
					CASE 11
						基礎气温 = 气温_秋_5T_11时
					CASE 12
						基礎气温 = 气温_秋_5T_12时
					CASE 13
						基礎气温 = 气温_秋_5T_13时
					CASE 14
						基礎气温 = 气温_秋_5T_14时
					CASE 15
						基礎气温 = 气温_秋_5T_15时
					CASE 16
						基礎气温 = 气温_秋_5T_16时
					CASE 17
						基礎气温 = 气温_秋_5T_17时
					CASE 18
						基礎气温 = 气温_秋_5T_18时
					CASE 19
						基礎气温 = 气温_秋_5T_19时
					CASE 20
						基礎气温 = 气温_秋_5T_20时
					CASE 21
						基礎气温 = 气温_秋_5T_21时
					CASE 22
						基礎气温 = 气温_秋_5T_22时
					CASE 23
						基礎气温 = 气温_秋_5T_23时
				ENDSELECT
			CASE 6
				SELECTCASE HOUR
					CASE 0
						基礎气温 = 气温_秋_6T_0时
					CASE 1
						基礎气温 = 气温_秋_6T_1时
					CASE 2
						基礎气温 = 气温_秋_6T_2时
					CASE 3
						基礎气温 = 气温_秋_6T_3时
					CASE 4
						基礎气温 = 气温_秋_6T_4时
					CASE 5
						基礎气温 = 气温_秋_6T_5时
					CASE 6
						基礎气温 = 气温_秋_6T_6时
					CASE 7
						基礎气温 = 气温_秋_6T_7时
					CASE 8
						基礎气温 = 气温_秋_6T_8时
					CASE 9
						基礎气温 = 气温_秋_6T_9时
					CASE 10
						基礎气温 = 气温_秋_6T_10时
					CASE 11
						基礎气温 = 气温_秋_6T_11时
					CASE 12
						基礎气温 = 气温_秋_6T_12时
					CASE 13
						基礎气温 = 气温_秋_6T_13时
					CASE 14
						基礎气温 = 气温_秋_6T_14时
					CASE 15
						基礎气温 = 气温_秋_6T_15时
					CASE 16
						基礎气温 = 气温_秋_6T_16时
					CASE 17
						基礎气温 = 气温_秋_6T_17时
					CASE 18
						基礎气温 = 气温_秋_6T_18时
					CASE 19
						基礎气温 = 气温_秋_6T_19时
					CASE 20
						基礎气温 = 气温_秋_6T_20时
					CASE 21
						基礎气温 = 气温_秋_6T_21时
					CASE 22
						基礎气温 = 气温_秋_6T_22时
					CASE 23
						基礎气温 = 气温_秋_6T_23时
				ENDSELECT
		ENDSELECT
	CASE 4
		SELECTCASE NOW_TERM
			CASE 1
				SELECTCASE HOUR
					CASE 0
						基礎气温 = 气温_冬_1T_0时
					CASE 1
						基礎气温 = 气温_冬_1T_1时
					CASE 2
						基礎气温 = 气温_冬_1T_2时
					CASE 3
						基礎气温 = 气温_冬_1T_3时
					CASE 4
						基礎气温 = 气温_冬_1T_4时
					CASE 5
						基礎气温 = 气温_冬_1T_5时
					CASE 6
						基礎气温 = 气温_冬_1T_6时
					CASE 7
						基礎气温 = 气温_冬_1T_7时
					CASE 8
						基礎气温 = 气温_冬_1T_8时
					CASE 9
						基礎气温 = 气温_冬_1T_9时
					CASE 10
						基礎气温 = 气温_冬_1T_10时
					CASE 11
						基礎气温 = 气温_冬_1T_11时
					CASE 12
						基礎气温 = 气温_冬_1T_12时
					CASE 13
						基礎气温 = 气温_冬_1T_13时
					CASE 14
						基礎气温 = 气温_冬_1T_14时
					CASE 15
						基礎气温 = 气温_冬_1T_15时
					CASE 16
						基礎气温 = 气温_冬_1T_16时
					CASE 17
						基礎气温 = 气温_冬_1T_17时
					CASE 18
						基礎气温 = 气温_冬_1T_18时
					CASE 19
						基礎气温 = 气温_冬_1T_19时
					CASE 20
						基礎气温 = 气温_冬_1T_20时
					CASE 21
						基礎气温 = 气温_冬_1T_21时
					CASE 22
						基礎气温 = 气温_冬_1T_22时
					CASE 23
						基礎气温 = 气温_冬_1T_23时
				ENDSELECT
			CASE 2
				SELECTCASE HOUR
					CASE 0
						基礎气温 = 气温_冬_2T_0时
					CASE 1
						基礎气温 = 气温_冬_2T_1时
					CASE 2
						基礎气温 = 气温_冬_2T_2时
					CASE 3
						基礎气温 = 气温_冬_2T_3时
					CASE 4
						基礎气温 = 气温_冬_2T_4时
					CASE 5
						基礎气温 = 气温_冬_2T_5时
					CASE 6
						基礎气温 = 气温_冬_2T_6时
					CASE 7
						基礎气温 = 气温_冬_2T_7时
					CASE 8
						基礎气温 = 气温_冬_2T_8时
					CASE 9
						基礎气温 = 气温_冬_2T_9时
					CASE 10
						基礎气温 = 气温_冬_2T_10时
					CASE 11
						基礎气温 = 气温_冬_2T_11时
					CASE 12
						基礎气温 = 气温_冬_2T_12时
					CASE 13
						基礎气温 = 气温_冬_2T_13时
					CASE 14
						基礎气温 = 气温_冬_2T_14时
					CASE 15
						基礎气温 = 气温_冬_2T_15时
					CASE 16
						基礎气温 = 气温_冬_2T_16时
					CASE 17
						基礎气温 = 气温_冬_2T_17时
					CASE 18
						基礎气温 = 气温_冬_2T_18时
					CASE 19
						基礎气温 = 气温_冬_2T_19时
					CASE 20
						基礎气温 = 气温_冬_2T_20时
					CASE 21
						基礎气温 = 气温_冬_2T_21时
					CASE 22
						基礎气温 = 气温_冬_2T_22时
					CASE 23
						基礎气温 = 气温_冬_2T_23时
				ENDSELECT
			CASE 3
				SELECTCASE HOUR
					CASE 0
						基礎气温 = 气温_冬_3T_0时
					CASE 1
						基礎气温 = 气温_冬_3T_1时
					CASE 2
						基礎气温 = 气温_冬_3T_2时
					CASE 3
						基礎气温 = 气温_冬_3T_3时
					CASE 4
						基礎气温 = 气温_冬_3T_4时
					CASE 5
						基礎气温 = 气温_冬_3T_5时
					CASE 6
						基礎气温 = 气温_冬_3T_6时
					CASE 7
						基礎气温 = 气温_冬_3T_7时
					CASE 8
						基礎气温 = 气温_冬_3T_8时
					CASE 9
						基礎气温 = 气温_冬_3T_9时
					CASE 10
						基礎气温 = 气温_冬_3T_10时
					CASE 11
						基礎气温 = 气温_冬_3T_11时
					CASE 12
						基礎气温 = 气温_冬_3T_12时
					CASE 13
						基礎气温 = 气温_冬_3T_13时
					CASE 14
						基礎气温 = 气温_冬_3T_14时
					CASE 15
						基礎气温 = 气温_冬_3T_15时
					CASE 16
						基礎气温 = 气温_冬_3T_16时
					CASE 17
						基礎气温 = 气温_冬_3T_17时
					CASE 18
						基礎气温 = 气温_冬_3T_18时
					CASE 19
						基礎气温 = 气温_冬_3T_19时
					CASE 20
						基礎气温 = 气温_冬_3T_20时
					CASE 21
						基礎气温 = 气温_冬_3T_21时
					CASE 22
						基礎气温 = 气温_冬_3T_22时
					CASE 23
						基礎气温 = 气温_冬_3T_23时
				ENDSELECT
			CASE 4
				SELECTCASE HOUR
					CASE 0
						基礎气温 = 气温_冬_4T_0时
					CASE 1
						基礎气温 = 气温_冬_4T_1时
					CASE 2
						基礎气温 = 气温_冬_4T_2时
					CASE 3
						基礎气温 = 气温_冬_4T_3时
					CASE 4
						基礎气温 = 气温_冬_4T_4时
					CASE 5
						基礎气温 = 气温_冬_4T_5时
					CASE 6
						基礎气温 = 气温_冬_4T_6时
					CASE 7
						基礎气温 = 气温_冬_4T_7时
					CASE 8
						基礎气温 = 气温_冬_4T_8时
					CASE 9
						基礎气温 = 气温_冬_4T_9时
					CASE 10
						基礎气温 = 气温_冬_4T_10时
					CASE 11
						基礎气温 = 气温_冬_4T_11时
					CASE 12
						基礎气温 = 气温_冬_4T_12时
					CASE 13
						基礎气温 = 气温_冬_4T_13时
					CASE 14
						基礎气温 = 气温_冬_4T_14时
					CASE 15
						基礎气温 = 气温_冬_4T_15时
					CASE 16
						基礎气温 = 气温_冬_4T_16时
					CASE 17
						基礎气温 = 气温_冬_4T_17时
					CASE 18
						基礎气温 = 气温_冬_4T_18时
					CASE 19
						基礎气温 = 气温_冬_4T_19时
					CASE 20
						基礎气温 = 气温_冬_4T_20时
					CASE 21
						基礎气温 = 气温_冬_4T_21时
					CASE 22
						基礎气温 = 气温_冬_4T_22时
					CASE 23
						基礎气温 = 气温_冬_4T_23时
				ENDSELECT
			CASE 5
				SELECTCASE HOUR
					CASE 0
						基礎气温 = 气温_冬_5T_0时
					CASE 1
						基礎气温 = 气温_冬_5T_1时
					CASE 2
						基礎气温 = 气温_冬_5T_2时
					CASE 3
						基礎气温 = 气温_冬_5T_3时
					CASE 4
						基礎气温 = 气温_冬_5T_4时
					CASE 5
						基礎气温 = 气温_冬_5T_5时
					CASE 6
						基礎气温 = 气温_冬_5T_6时
					CASE 7
						基礎气温 = 气温_冬_5T_7时
					CASE 8
						基礎气温 = 气温_冬_5T_8时
					CASE 9
						基礎气温 = 气温_冬_5T_9时
					CASE 10
						基礎气温 = 气温_冬_5T_10时
					CASE 11
						基礎气温 = 气温_冬_5T_11时
					CASE 12
						基礎气温 = 气温_冬_5T_12时
					CASE 13
						基礎气温 = 气温_冬_5T_13时
					CASE 14
						基礎气温 = 气温_冬_5T_14时
					CASE 15
						基礎气温 = 气温_冬_5T_15时
					CASE 16
						基礎气温 = 气温_冬_5T_16时
					CASE 17
						基礎气温 = 气温_冬_5T_17时
					CASE 18
						基礎气温 = 气温_冬_5T_18时
					CASE 19
						基礎气温 = 气温_冬_5T_19时
					CASE 20
						基礎气温 = 气温_冬_5T_20时
					CASE 21
						基礎气温 = 气温_冬_5T_21时
					CASE 22
						基礎气温 = 气温_冬_5T_22时
					CASE 23
						基礎气温 = 气温_冬_5T_23时
				ENDSELECT
			CASE 6
				SELECTCASE HOUR
					CASE 0
						基礎气温 = 气温_冬_6T_0时
					CASE 1
						基礎气温 = 气温_冬_6T_1时
					CASE 2
						基礎气温 = 气温_冬_6T_2时
					CASE 3
						基礎气温 = 气温_冬_6T_3时
					CASE 4
						基礎气温 = 气温_冬_6T_4时
					CASE 5
						基礎气温 = 气温_冬_6T_5时
					CASE 6
						基礎气温 = 气温_冬_6T_6时
					CASE 7
						基礎气温 = 气温_冬_6T_7时
					CASE 8
						基礎气温 = 气温_冬_6T_8时
					CASE 9
						基礎气温 = 气温_冬_6T_9时
					CASE 10
						基礎气温 = 气温_冬_6T_10时
					CASE 11
						基礎气温 = 气温_冬_6T_11时
					CASE 12
						基礎气温 = 气温_冬_6T_12时
					CASE 13
						基礎气温 = 气温_冬_6T_13时
					CASE 14
						基礎气温 = 气温_冬_6T_14时
					CASE 15
						基礎气温 = 气温_冬_6T_15时
					CASE 16
						基礎气温 = 气温_冬_6T_16时
					CASE 17
						基礎气温 = 气温_冬_6T_17时
					CASE 18
						基礎气温 = 气温_冬_6T_18时
					CASE 19
						基礎气温 = 气温_冬_6T_19时
					CASE 20
						基礎气温 = 气温_冬_6T_20时
					CASE 21
						基礎气温 = 气温_冬_6T_21时
					CASE 22
						基礎气温 = 气温_冬_6T_22时
					CASE 23
						基礎气温 = 气温_冬_6T_23时
				ENDSELECT
		ENDSELECT
ENDSELECT

;天候倾向によって寒气・暖气による补正方法が变化する
SELECTCASE NOW_WEATHER_CONTROL
	;1 春・秋の天气(基本)
	CASE 1
		气流补正 = (POWER_WARM_AIR - POWER_COLD_AIR) * 2
	;2 春・秋の天气(温暖前线接近时)
	CASE 2
		气流补正 = (POWER_WARM_AIR - POWER_COLD_AIR) * 2
	;3 春・秋の天气(暖域时)
	CASE 3
		气流补正 = POWER_WARM_AIR * 2
	;4 春・秋の天气(寒冷前线通过时)
	CASE 4
		气流补正 = (0 - POWER_COLD_AIR) * 2
	;5 春・秋の天气(寒冷涡接近时)
	CASE 5
		气流补正 = (0 - POWER_COLD_AIR) * 2
	;6 夏の天气(基本)
	CASE 6
		气流补正 = (POWER_WARM_AIR - 3) * 3
	;7 夏の天气(夕立接近时)
	CASE 7
		SELECTCASE CAN_CUMULUS:0
			CASE 1,2,3
				气流补正 = (POWER_WARM_AIR - 3) * 3 - (POWER_COLD_AIR / 2)
			CASE 4,5
				气流补正 = 0 - POWER_COLD_AIR
		ENDSELECT
	;8 夏の天气(夕立通过后)
	CASE 8
		SELECTCASE CAN_CUMULUS:0
			CASE 1,2,3
				气流补正 = (POWER_WARM_AIR - 3) * 3 - POWER_COLD_AIR
			CASE 4,5
				气流补正 = (0 - POWER_COLD_AIR) * 2
		ENDSELECT
	;9 冬の天气(基本)
	CASE 9
		气流补正 = (POWER_WARM_AIR - POWER_COLD_AIR) * 2
	;10 冬の天气(日本海低气圧接近时)
	CASE 10
		气流补正 = POWER_WARM_AIR * 2
	;11 冬の天气(日本海低气圧通过时)
	CASE 11
		气流补正 = (0 - POWER_COLD_AIR) * 2
	;12 冬の天气(南岸低气圧接近时)
	CASE 12
		气流补正 = (0 - POWER_COLD_AIR) * 2
	;13 冬の天气(寒冷涡接近时)
	CASE 13
		气流补正 = (0 - POWER_COLD_AIR) * 2
	;14 梅雨・秋雨の天气(基本)
	CASE 14
		IF POWER_WARM_AIR >= POWER_COLD_AIR
			气流补正 = POWER_WARM_AIR
		ELSE
			气流补正 = 0 - POWER_COLD_AIR
		ENDIF
	;15 梅雨・秋雨(梅雨末期・秋雨+台风接近)・先駆降雨带发生时の天气
	CASE 15
		气流补正 = POWER_WARM_AIR * 2
	;16 台风接近时の天气(强风域)
	CASE 16
		SELECTCASE DAY:2
			CASE 2
				气流补正 = (POWER_WARM_AIR - 3) * 3 + IS_TYPHOON:1
			CASEELSE
				气流补正 = (POWER_WARM_AIR - POWER_COLD_AIR) * 2 + IS_TYPHOON:1
		ENDSELECT
	;21 台风接近时の天气(暴风域・最接近)
	CASE 21
		SELECTCASE DAY:2
			CASE 2
				气流补正 = (POWER_WARM_AIR - 3) * 3 + IS_TYPHOON:1
			CASEELSE
				气流补正 = (POWER_WARM_AIR - POWER_COLD_AIR) * 2 + IS_TYPHOON:1
		ENDSELECT
	;17 台风接近时の天气(台风の目)
	CASE 17
		SELECTCASE DAY:2
			CASE 2
				气流补正 = (POWER_WARM_AIR - 3) * 3 + IS_TYPHOON:1
			CASEELSE
				气流补正 = (POWER_WARM_AIR - POWER_COLD_AIR) * 2 + IS_TYPHOON:1
		ENDSELECT
	;18 雾の天气
	CASE 18
		SELECTCASE DAY:2
			CASE 2
				气流补正 = (POWER_WARM_AIR - 3) * 3
			CASEELSE
				气流补正 = (POWER_WARM_AIR - POWER_COLD_AIR) * 2
		ENDSELECT
	;19 疑似好天
	CASE 19
		气流补正 = (0 - POWER_COLD_AIR) * 15 / 10
	;20 集中豪雨时の天气
	CASE 20
		气流补正 = (POWER_WARM_AIR - POWER_COLD_AIR) * 2
ENDSELECT

现在マップ = GET_MAPID(CFLAG:MASTER:当前位置)
高度补正 = 0
现在お出かけマップ = GET_MAP_REPLACEMENT(CFLAG:MASTER:当前位置)

;マップごとに高度による气温低下の补正值を决定
SELECTCASE 现在マップ
	CASE 0
		高度补正 = 0
		
		补正温度 = 基礎气温 + 气流补正 * 10 - 高度补正 * 10
	CASE 1
		高度补正 = 3
		
		补正温度 = 基礎气温 + 气流补正 * 10 - 高度补正 * 10
	CASE 2
		高度补正 = 0
		
		补正温度 = 基礎气温 + 气流补正 * 10 - 高度补正 * 10
	CASE 3
		高度补正 = 0
		
		补正温度 = 基礎气温 + 气流补正 * 10 - 高度补正 * 10
	CASE 4
		高度补正 = 0
		
		补正温度 = 基礎气温 + 气流补正 * 10 - 高度补正 * 10
	CASE 5
		高度补正 = 0
		
		补正温度 = 基礎气温 + 气流补正 * 10 - 高度补正 * 10
	CASE 6
		高度补正 = 10
		
		补正温度 = 基礎气温 + 气流补正 * 10 - 高度补正 * 10
	CASE 7
		高度补正 = 6
		
		补正温度 = 基礎气温 + 气流补正 * 10 - 高度补正 * 10
	CASE 8
		IF (MAIN_MAP == 现在マップ && 现在お出かけマップ == 天界) || (MAIN_MAP != 现在マップ && CFLAG:MASTER:当前位置 == 天界)
			高度补正 = 20
			
			补正温度 = 基礎气温 + 气流补正 * 10 - 高度补正 * 10
		ELSE
			高度补正 = 12
			
			补正温度 = 基礎气温 + 气流补正 * 10 - 高度补正 * 10
		ENDIF
	;灼热地狱遗迹は40℃,その他地底は20℃
	CASE 9
		IF (MAIN_MAP == 现在マップ && 现在お出かけマップ == 灼热地狱遗迹) || (MAIN_MAP != 现在マップ && CFLAG:MASTER:当前位置 == 灼热地狱遗迹)
			补正温度 = 400
		ELSE
			补正温度 = 200
		ENDIF
	CASE 10
		高度补正 = 0
		
		补正温度 = 基礎气温 + 气流补正 * 10 - 高度补正 * 10
ENDSELECT

;屋内では20℃に近づくように气温が上下する
;屋外では日射がある场合、气温上升
日射补正 = 0
IF OUTROOF(CFLAG:MASTER:当前位置)
	SELECTCASE TIME:5
		CASE 0,1
			SELECTCASE TIME:0
				CASE 360 TO 599, 960 TO 1079
					日射补正 += 15
				CASE 600 TO 959
					日射补正 += 20
			ENDSELECT
			
			SELECTCASE DAY:2
				CASE 1,3
					日射补正 += 10
				CASE 2
					日射补正 += 15
				CASE 4
					日射补正 += 10
			ENDSELECT
		CASE 2
			日射补正 += 5
	ENDSELECT
	补正温度 += 日射补正
ELSE
	SELECTCASE 补正温度
		CASE IS <= 250
			建造物补正 = 50
			
			补正温度 = MIN(200, 补正温度 + 建造物补正)
		CASEELSE
			建造物补正 = -40
			
			补正温度 = MAX(250, 补正温度 + 建造物补正)
	ENDSELECT
ENDIF

;チルノがいると气温低下
IF CFLAG:MASTER:当前位置 == CFLAG:14:当前位置
	补正温度 -= 100
ENDIF

;澡堂では30℃に近づくように气温が上升する
IF BATHCHECK(CFLAG:MASTER:当前位置) && 补正温度 < 300
	建造物补正 = 100
	
	补正温度 = MIN(300, 补正温度 + 建造物补正)
ENDIF

;炬燵では25℃に近づくように气温が上升する
;炬燵は气温10℃未满で出す
IF 炬燵のある场所(CFLAG:MASTER:当前位置) && 补正温度 < 100
	建造物补正 = 100
	
	补正温度 = MIN(250, 补正温度 + 建造物补正)
ENDIF

RETURNF 补正温度

;-------------------------------------------------
;现在の体感气温
;现在の气温に天气・风力・场所に応じた补正を加えて现在の体感气温を算定する
;-------------------------------------------------
@GET_体感气温
#FUNCTION
#DIM 现在の气温
#DIM 体感气温
#DIM 降水フラグ

现在の气温 = GET_现在气温()
降水フラグ = 0

IF !OUTROOF(CFLAG:MASTER:当前位置)
	RETURNF 现在の气温
ENDIF

体感气温 = 现在の气温

RETURNF 体感气温
