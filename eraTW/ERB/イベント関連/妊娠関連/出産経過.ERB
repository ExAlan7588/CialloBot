@出产经过(ARG)
#DIM CHILDNUM
;#DIM nCurrentChildCareCount
;#DIM nCurrentCareChild
#DIM DYNAMIC DADDY

; SIF CFLAG:ARG:育儿人数 > 0 && CFLAG:ARG:分娩经过日 == 0 ;failsafe
	; CFLAG:ARG:分娩经过日 = 19 ;set to pre-recovery so it becomes 20

SIF CFLAG:ARG:妊娠经过日数 > 0
	DADDY = CFLAG:ARG:谁の子

SIF CFLAG:ARG:妊娠经过日数 > 100
	CALL BIRTH(ARG)
SIF CFLAG:ARG:妊娠经过日数 > 1
	CALL PERCIEVE(ARG)

;potentially, even if these counters misbehave, because we check birthdays the events will popup properly anyway and process all children of a 2hu
;nCurrentChildCareCount = CFLAG:ARG:分娩经过日
;nCurrentCareChild = TALENT:ARG:育儿中

;FOR LOCAL,MAX(CFLAG:ARG:儿童人数 - MAXCHILD + 1, 1),CFLAG:ARG:儿童人数 + 1 ;bug fix loop, process all children
	;CHILDNUM = CHILD_INDEX(LOCAL)
	CHILDNUM = TALENT:ARG:育儿中
	;SIF CHILDNUM >= VARSIZE("CHILDNAME")
	;	BREAK
	;SIF CHILDNAME:ARG:CHILDNUM == ""
	;	CONTINUE
	;TALENT:ARG:育儿中 = CHILDNUM
	;CFLAG:ARG:分娩经过日 = (DAY-CHILD_BIRTHDAY:ARG:CHILDNUM)+1 ;their current growth counter/age

	SIF CFLAG:ARG:分娩经过日 > 0
		DADDY = CHILD_DADDY:ARG:CHILDNUM

	;子别馆
	IF CFLAG:ARG:分娩经过日 > CHILD_自立 ;&& !CHILD_INDEPENDENT:ARG:CHILDNUM
		DRAWLINE
		;口上チェック,存在しないならRESULT=2,以下同样
		CALL KOJO_MESSAGE_SEND("CHILD", 0, ARG, 0, 0, "RAISING_自立")
		IF RESULT == 2
			PRINTFORMW %NAME_OUTPUT_TRANSLATION("CALLNAME", ARG)%和%NAME_OUTPUT_TRANSLATION("CALLNAME", DADDY)%的孩子%CHILDNAME:ARG:CHILDNUM%平安的迎来了独自生活的日子、自立了。
			PRINTFORML 
			PRINTFORML 希望能偶尔见见面
			PRINTFORML %NAME_OUTPUT_TRANSLATION("CALLNAME", MASTER)%的愿望还是没能说出口……。
			PRINTFORMW 
		ENDIF
		CFLAG:ARG:育儿人数 -= 1
		CFLAG:DADDY:育儿人数 -= 1
		;IF CFLAG:ARG:育儿人数 >= 0
		IF CFLAG:ARG:育儿人数 > 0
			;PRINTFORML 远くなる子の背中を见ながらまだ小さい他の儿童も无事に育てようと、
			PRINTFORML 看着逐渐远去的孩子、
			PRINTFORML 希望还小的孩子能顺利成长、
			;PRINTFORML %NAME_OUTPUT_TRANSLATION("CALLNAME", ARG)%は%NAME_OUTPUT_TRANSLATION("CALLNAME", DADDY)%と静かに誓った。
			PRINTFORMW %NAME_OUTPUT_TRANSLATION("CALLNAME", ARG)%握着%NAME_OUTPUT_TRANSLATION("CALLNAME", DADDY)%的手、默默祈愿。
		ELSE
			;PRINTFORML 远くなる子の背中を见ながら%NAME_OUTPUT_TRANSLATION("CALLNAME", ARG)%は%NAME_OUTPUT_TRANSLATION("CALLNAME", DADDY)%とこどもの无事を祈った。
			PRINTFORMW 看着远去的孩子的背影，%NAME_OUTPUT_TRANSLATION("CALLNAME", ARG)%和%NAME_OUTPUT_TRANSLATION("CALLNAME", DADDY)%祈祷着孩子平安。
		ENDIF
		;PRINTFORML 别れ际、儿童は%NAME_OUTPUT_TRANSLATION("CALLNAME", DADDY)%が%NAME_OUTPUT_TRANSLATION("CALLNAME", ARG)%を顾みず他の女の尻を追い回していたことを口污く骂り、
		;PRINTFORML 自分は绝对に%NAME_OUTPUT_TRANSLATION("CALLNAME", DADDY)%のようにはならないと吐き舍てて去っていった
		;TODO 真正判断陪伴时间再下判断
		; PRINTFORML 离别之际、孩子讽刺%NAME_OUTPUT_TRANSLATION("CALLNAME", DADDY)%不顾%NAME_OUTPUT_TRANSLATION("CALLNAME", ARG)%去追其他女人
		; PRINTFORML 说着自己绝不会像%NAME_OUTPUT_TRANSLATION("CALLNAME", DADDY)%一样就走了
		CALL ASK_DIARY(@"%CHILDNAME:ARG:CHILDNUM%独立了。")
		;CHILD_INDEPENDENT:ARG:CHILDNUM = 1
		SIF CFLAG:ARG:育儿人数 == 0
			TALENT:ARG:育儿中 = 0
		SIF	CFLAG:DADDY:育儿人数 == 0
			TALENT:DADDY:育儿中 = 0
		CFLAG:ARG:分娩经过日 = 0
		;自立するときに再度设定する
		CALL 自立先选定(ARG, CHILDNUM)
	ENDIF
	IF CFLAG:ARG:分娩经过日 == CHILD_自立前
		DRAWLINE
		;口上チェック
		CALL KOJO_MESSAGE_SEND("CHILD", 0, ARG, 0, 0, "RAISING_自立前")
		IF RESULT == 2
			PRINTFORML %CHILDNAME:ARG:CHILDNUM%还有一段时间就要分别了。
			PRINTFORML 个子也长高了、已经和%NAME_OUTPUT_TRANSLATION("CALLNAME", ARG)%差不多了。
			PRINTFORMW 这个孩子不久也要离开家门了吧、要好好珍惜剩下的时间……。
		ENDIF
	ELSEIF CFLAG:ARG:分娩经过日 == CHILD_就学
		DRAWLINE
		;口上チェック
		CALL KOJO_MESSAGE_SEND("CHILD", 0, ARG, 0, 0, "RAISING_就学")
		IF RESULT == 2
			PRINTFORML %NAME_OUTPUT_TRANSLATION("CALLNAME", ARG)%的孩子%CHILDNAME:ARG:CHILDNUM%开始上私塾了。
			PRINTFORML 孩子的成长很迅速。
			PRINTFORML 离开父母的那天很快就会到来的吧……。
			PRINTFORMW %NAME_OUTPUT_TRANSLATION("CALLNAME", DADDY)%变得有些伤感。
		ENDIF
	ELSEIF CFLAG:ARG:分娩经过日 == CHILD_管教
		DRAWLINE
		;口上チェック
		CALL KOJO_MESSAGE_SEND("CHILD", 0, ARG, 0, 0, "RAISING_管教")
		IF RESULT == 2
			PRINTFORML %CHILDNAME:ARG:CHILDNUM%越来越聪明了、做出了各种各样的行动、
			PRINTFORML 同时恶作剧和任性次数也增加了。
			PRINTFORMW 必须要认真考虑教育的事了……。
		ENDIF
	ELSEIF CFLAG:ARG:分娩经过日 == CHILD_词汇
		DRAWLINE
		;口上チェック
		CALL KOJO_MESSAGE_SEND("CHILD", 0, ARG, 0, 0, "RAISING_词汇")
		IF RESULT == 2
			PRINTFORML %CHILDNAME:ARG:CHILDNUM%的词汇量增加了。
			PRINTFORMW 说的内容只是单独的２、３个音节完全无法形成句子。
		ENDIF
	ELSEIF CFLAG:ARG:分娩经过日 == CHILD_说话
		DRAWLINE
		;口上チェック
		CALL KOJO_MESSAGE_SEND("CHILD", 0, ARG, 0, 0, "RAISING_说话")
		IF RESULT == 2
			PRINTFORML %NAME_OUTPUT_TRANSLATION("CALLNAME", ARG)%以惊人的气势跑了过来。
			PRINTFORML %CHILDNAME:ARG:CHILDNUM%呼喊了%NAME_OUTPUT_TRANSLATION("CALLNAME", ARG)%的名字。
			PRINTFORML 赶紧去看看、确实在看着%NAME_OUTPUT_TRANSLATION("CALLNAME", ARG)%的脸喊著名字。
			PRINTFORMW %NAME_OUTPUT_TRANSLATION("CALLNAME", DADDY)%为了听见孩子叫自己、把脸靠过去也听见了连喊爸爸的声音。
		ENDIF
	ELSEIF INRANGE(CFLAG:ARG:分娩经过日, CHILD_说话 - 3, CHILD_说话 - 1)
		DRAWLINE
		;口上チェック
		CALL KOJO_MESSAGE_SEND("CHILD", 0, ARG, 0, 0, "RAISING_会话寸前")
		IF RESULT == 2
			PRINTFORML 最近%CHILDNAME:ARG:CHILDNUM%常常张口说话。
			PRINTFORML 虽然说不出意义清楚的话、只能用手指着想要的东西喊著名字、以此表达自己的意思。
			PRINTFORMW 不久就能说出清楚的话吧……。
		ENDIF
	ELSEIF CFLAG:ARG:分娩经过日 == CHILD_蹒跚学步
		DRAWLINE
		;口上チェック
		CALL KOJO_MESSAGE_SEND("CHILD", 0, ARG, 0, 0, "RAISING_蹒跚学步")
		IF RESULT == 2
			PRINTFORML %CHILDNAME:ARG:CHILDNUM%用双脚站立开始摇摇晃晃的走路了。
			PRINTFORML 因为视线和行动半径的扩大对各种各样的事情产生了兴趣。
			PRINTFORMW %NAME_OUTPUT_TRANSLATION("CALLNAME", MASTER)%牵着还在摇摇晃晃的%CHILDNAME:ARG:CHILDNUM%的手移动到了各种地方。
		ENDIF
	ELSEIF CFLAG:ARG:分娩经过日 == CHILD_つかまり立ち
		DRAWLINE
		;口上チェック
		CALL KOJO_MESSAGE_SEND("CHILD", 0, ARG, 0, 0, "RAISING_つかまり立ち")
		IF RESULT == 2
			PRINTFORML %NAME_OUTPUT_TRANSLATION("CALLNAME", MASTER)%蹲了下去让%CHILDNAME:ARG:CHILDNUM%握住手指。
			PRINTFORMW 然后慢慢地抬起手指、做着站立的练习。
		ENDIF
	ELSEIF CFLAG:ARG:分娩经过日 == CHILD_玩具
		;口上チェック
		CALL KOJO_MESSAGE_SEND("CHILD", 0, ARG, 0, 0, "RAISING_玩具")
		IF RESULT == 2
			PRINTFORML 为了%CHILDNAME:ARG:CHILDNUM%玩耍%NAME_OUTPUT_TRANSLATION("CALLNAME", MASTER)%用木头制作了简单的玩具。
			PRINTFORML 反正肯定会被扔来扔去所以只要单纯的做结实就好。
			PRINTFORMW 为了不让孩子受伤、%NAME_OUTPUT_TRANSLATION("CALLNAME", MASTER)%仔细的打磨着断面。
		ENDIF
	ELSEIF CFLAG:ARG:分娩经过日 == CHILD_离乳
		DRAWLINE
		;口上チェック
		CALL KOJO_MESSAGE_SEND("CHILD", 0, ARG, 0, 0, "RAISING_离乳")
		IF RESULT == 2
			PRINTFORMW 刚刚断奶的婴儿满脸笑容的样子让%NAME_OUTPUT_TRANSLATION("CALLNAME", MASTER)%嘴角上扬。
		ENDIF
		PRINTFORML %NAME_OUTPUT_TRANSLATION("CALLNAME", ARG)%的授乳期间结束了。
		IF TALENT:ARG:母乳体质 == 1 && EXP:ARG:喷乳经验 > 100 && EXP:ARG:分娩经验 > 1
			PRINTFORML 但是、持续产出了超过哺乳程度的%NAME_OUTPUT_TRANSLATION("CALLNAME", ARG)%的乳房、至今仍有美味的乳汁……
			PRINTFORMW %NAME_OUTPUT_TRANSLATION("CALLNAME", ARG)%得到【母乳体质】
			TALENT:ARG:母乳体质 = 2
		ELSE
			PRINTFORMW 完成任务的%NAME_OUTPUT_TRANSLATION("CALLNAME", ARG)%的胸部变小了、母乳也没有了。
			SIF TALENT:ARG:母乳体质 == 1
				TALENT:ARG:母乳体质 = 0
		ENDIF
		;乳品质提升フラグたってて、今绝壁じゃないなら小さくなる。通常出产以外の妊娠结束なんかも考虑するとCALLで呼び出す方が良いのだろうが…
		IF CFLAG:ARG:乳品质提升 == 1 && TALENT:ARG:胸围 > -2
			TALENT:ARG:胸围 -= 1
			CFLAG:ARG:乳品质提升 = 0
		ENDIF
	ELSEIF CFLAG:ARG:分娩经过日 == 20 && CFLAG:ARG:恢复速度降低
		DRAWLINE
		PRINTFORMW 在平安完成产后恢复后、%NAME_OUTPUT_TRANSLATION("CALLNAME", ARG)%完全恢复了元气。
		;口上チェック
		CALL KOJO_MESSAGE_SEND("CHILD", 0, ARG, 0, 0, "RAISING_恢复")
		IF RESULT == 2
			;体质变化があるので省略しない
		ENDIF
		MAXBASE:ARG:体力 += 550
		MAXBASE:ARG:气力 += 550
		SIF MAXBASE:ARG:体力 / 10 * 11 <= CSVBASE(ARG, GETNUM(BASE, "体力")) * 2
			MAXBASE:ARG:体力 = MAXBASE:ARG:体力 / 10 * 11
		SIF MAXBASE:ARG:气力 / 10 * 11 <= CSVBASE(ARG, GETNUM(BASE, "气力")) * 2
			MAXBASE:ARG:气力 = MAXBASE:ARG:气力 / 10 * 11
		TALENT:ARG:恢复速度 = CFLAG:ARG:恢复速度降低 - 2
		CFLAG:ARG:恢复速度降低 = 0
	ENDIF
;NEXT
;bug fix, set counter to latest progress of the last child
; IF CFLAG:ARG:育儿人数 > 0
; 	CFLAG:ARG:分娩经过日 = nCurrentChildCareCount
; 	TALENT:ARG:育儿中 = nCurrentCareChild
; ELSE
; 	CFLAG:ARG:分娩经过日 = 0
; 	TALENT:ARG:育儿中 = 0
; ENDIF
;bug fix
; @EVENTLOAD
; FOR LOCAL, 1, CHARANUM - 1
; 	IF CFLAG:LOCAL:儿童人数 > 0
; 		FOR COUNT, 1, MAXCHILD + 1
; 			IF CHILD_BIRTHDAY:LOCAL:COUNT > 0 && (DAY-CHILD_BIRTHDAY:LOCAL:COUNT) > CHILD_自立 ;set independent flag for older children from old saves
; 				CHILD_INDEPENDENT:LOCAL:COUNT = 1
; 			ELSE
; 				CHILD_INDEPENDENT:LOCAL:COUNT = 0
; 			ENDIF
; 		NEXT
; 	ENDIF
; NEXT
;儿童が通学するか
@GO_SCHOOL(ARG)
#FUNCTION
SIF !INRANGE(DAY % 7, 1, 5) 
	RETURNF 0
SIF FESTIVAL() != ""
	RETURNF 0
SIF !TALENT:ARG:育儿中
	RETURNF 0
;大雨と吹雪
SIF TIME:5 == 5
	RETURNF 0
SIF TIME:5 == 9
	RETURNF 0
SIF CFLAG:ARG:分娩经过日 >= CHILD_就学
	RETURNF 1

;现在育儿中の儿童_姓名を表示
@SHOW_CHILDNAME(ARG)
#FUNCTIONS
RETURNF CHILDNAME:ARG:(TALENT:ARG:育儿中)

;成长した儿童と亲を随机で拾ってくる函数
@PickRandGrownChild
#DIM YOME
#DIM CHILDNUM
SIF !CFLAG:MASTER:儿童人数
	RETURN -1
YOME = 0
CALL FISHER_YATES_SHAFFLE(CHARANUM - 1)
FOR LOCAL:10, 0, CHARANUM - 1
	LOCAL = SHAFFLE_ARRAY:(LOCAL:10) + 1
	IF CFLAG:LOCAL:儿童人数 - CFLAG:LOCAL:育儿人数 > 0
		YOME = LOCAL
		CHILDNUM = RAND:(CFLAG:LOCAL:儿童人数 - CFLAG:LOCAL:育儿人数) + 1
		BREAK
	ENDIF
NEXT
RETURN YOME, CHILDNUM

;-----------------------------------------------------
;自立した儿童の自立先を决める函数
;-----------------------------------------------------
@自立先选定(CHARA, CHILDNUM)
#DIM CHARA
#DIM CHILDNUM
{
#DIM CONST VALID_AREAS = 
	神社境内, 神社本堂, 梦幻遗迹, 命莲寺境内, 命莲寺方丈, 神灵庙广场, 神灵庙道场, 广场, 商业街, 吞屋小道, 大厅, 食堂, 大图书馆,
	斜角的竹林, 永远亭, 梦幻馆, 香霖堂, 中有之道, 三途之川, 彼岸, 白玉楼庭院, 畜生界, 玄武之泽, 间歇泉地下中枢,
	九天瀑布, 守矢神社境内, 守矢神社本殿, 旧地狱街道, 地灵殿, 灼热地狱遗迹, 月之都, 玉兔之街
}
CHILD_AREA:CHARA:CHILDNUM = VALID_AREAS:(RAND:32)

@PREG_DAY_ADJUSTER(C_ID, ADJUST_TO, D_BEFORE, D_AFTER)
#DIM ADJUST_TO
#DIM C_ID
#DIM D_BEFORE
#DIM D_AFTER
SIF D_BEFORE < ADJUST_TO && D_AFTER >= ADJUST_TO
	CFLAG:C_ID:妊娠经过日数 = ADJUST_TO