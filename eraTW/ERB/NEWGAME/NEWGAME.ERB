;-----------------------------------------------------------
;初次游玩
;-----------------------------------------------------------
@NEWGAME
ゲーム开始处理中 = 1
;本体バージョンを记录
SAVESTR:本体バージョン = %eraTW_Version%
;クラス函数初期化
CALL MAKE_ALL_CLASS_LIST
;默认オプション
CALL DEFAULT_OPTION
;筹码初期化
CALL SET_CHARISMA("NEW")
PBAND = 12

;日期１日目
DAY = 1
DAY:2 = 1
DAY:3 = 1
;FLAG:酒虫 = 1
VAR_FERMENT = 普通的水
;(天候パッチ)冷害发生回数・风害发生回数・水害发生回数・连续降水Counterをリセット
IS_COLD_CROP_DAMAGE = 0
IS_STORM_CROP_DAMAGE = 0
IS_FLOOD_CROP_DAMAGE = 0
CONTINUOUS_RAINFALL = 0
;(天候パッチ)降雪・雪崩判定を解除
CONTINUOUS_SNOWFALL = 0
SNOW_COVERAGE = 0
POSSIBLITY_AVALANCHE = 0
;(天候パッチ)时间带をリセット
WEATHER_TIMEZOME = 0
;(天候パッチ)长期天候倾向をリセット
YEAR_WEATHER_CONTROL = 0
;(天候パッチ)短期予报を行う
CALL WEATHER_FORECAST_1TERM
;(天候パッチ)1日予报を行う
CALL WEATHER_FORECAST_1DAY

;角色生成
CALL ADD_ALL_CHARACTERS
;MASTER生成
CALL NEWGAME_MAKE
;recolored map or default
CALL DEFAULT_MAP_COLOR
;住居设定
CALL SET_MAINHOME
;オプション
CALL NEWGAME_OPTION

;角色设定
FOR LOCAL,0,CHARANUM
	;开始位置
	CFLAG:LOCAL:当前位置 = CFLAG:LOCAL:初始位置
	;服装
	CALL SELECT_CLOTHES(LOCAL, "便服")
	CALL CTRL_CLOTHES_SET(LOCAL, "现在衣装の变更_便装")
	CALL CLOTHES_SETTING_TRAIN(LOCAL)
	CALL 内衣确认リセット(LOCAL)
	CVARSET BASE, GETNUM(BASE, "酒气"), 0
NEXT
;MASTER起床时间セット（7时）
TIME:3 = 420
;MASTER睡眠中フラグON
CALL SET_SLEEP(1,MASTER,0)
ゲーム开始处理中 = 0
RETURN 0

;FileName_SHOP_CUSTOM.ERB -------------------------- Rev1.00
;CALL		USER
;ARG		NONE
;RETURN		VOID
;COMMENT	
;角色を追加したときにいちいちここをいじる必要の无いように
;人物数量上限はERHファイルで定义
;-----------------------------------------------------------
@ADD_ALL_CHARACTERS
FOR LOCAL,CHARANUM,人物数量上限
	SIF !EXISTCSV(LOCAL)
		CONTINUE
	ADDCHARA LOCAL
	CALL SET_MINIMUM_EXP_ALL(LOCAL)
	CALL KOJO_MULTIPLE(LOCAL, "NO_SELECT")
	IF !EXP:LOCAL:接吻经验
		TALENT:LOCAL:无接吻经验 = 1
	ENDIF
NEXT
CALL UPDATE_AND_SELECTION_OF_KOJO_MODDING("SELECTION")

;-----------------------------------------------------------
;设定变更
;-----------------------------------------------------------
@NEWGAME_OPTION
#DIMS choices, 100
;初期化
;甲斐性无、农民
SETBIT FLAG:1000, 1
SETBIT FLAG:1000, 2
;TINKO
SIF !TALENT:MASTER:形状
	TALENT:MASTER:形状 = 3
;服
SIF !CFLAG:MASTER:基本服装SET
	CALL MASTER_CLOTHES_INIT
;
SIF !ゲーム开始处理中
	新游戏特典 '= "无"
;选择肢
VARSET choices
PRINTL
PRINTL
PRINTL 在游戏开始前你可以变更游戏各种的设定。
DRAWLINE
;你设定
SIF !FLAG:扮演
	choices:0 '= @"%NAME_OUTPUT_TRANSLATION("CALLNAME", MASTER)%进行自定义角色"
SIF HAS_PENIS(MASTER)
	choices:1 '= @"%NAME_OUTPUT_TRANSLATION("CALLNAME", MASTER)%的男性器为：%TINKO_SIMPLE(MASTER)%"
choices:2 '= @"%NAME_OUTPUT_TRANSLATION("CALLNAME", MASTER)%的服装为：%MASTER_CLOTHES_NAME(CFLAG:MASTER:基本服装SET)%"
IF FLAG:甲斐性无
	choices:3 '= @"%NAME_OUTPUT_TRANSLATION("CALLNAME", MASTER)%没有告白的胆量"
ELSE
	choices:3 '= @"%NAME_OUTPUT_TRANSLATION("CALLNAME", MASTER)%有告白的胆量"
ENDIF
IF FLAG:地主
	choices:4 '= @"%NAME_OUTPUT_TRANSLATION("CALLNAME", MASTER)%是为%NAME_OUTPUT_TRANSLATION("CALLNAME", (FLAG:地主))%劳动的农民"
ELSE
	choices:4 '= @"%NAME_OUTPUT_TRANSLATION("CALLNAME", MASTER)%是无债一身轻的自由人"
ENDIF
choices:5 '= @"%NAME_OUTPUT_TRANSLATION("CALLNAME", MASTER)%居住在%GET_MAPNAME(MAIN_MAP)%的%STR:(默认初始位置 + (MAIN_MAP ? 8000 # 0) )%"
;幻想乡
choices:10 '= @"可以进行各角色的处女・非处女变更（＋futa化与否＆形状）"
choices:11 '= @"可以进行各角色的体型变更"
;特典
IF ゲーム开始处理中
	choices:20 '= NEWGAMEBONUS_TEXT()
ELSEIF ゲーム继承处理中
	choices:20 '= 周回特典_表示()
ENDIF

CALL ASK_CHOICES(choices, 100, "完成自定义阶段并开始游戏")
SELECTCASE RESULT
	CASE 0
		IF !FLAG:扮演
			CALL CUSTOM_TERMINAL(MASTER)
			CALL SET_MAINHOME
		ENDIF
	CASE 100
		CALL VIRGIN_SET_APPLY
		CALL SET_BODY_APPLY
		CALL NEWGAME_BONUS_APPLY
		CALL SET_APPLY_NOUMIN
		;CALL 周回特典_适用
		ITEM:平价食材 = 10
		RETURN
	CASE 1
		SIF HAS_PENIS(MASTER)
			CALL TINKO_DECIDE(MASTER)
	CASE 2
		CALL MASTER_CLOTHES
	CASE 3
		CALL KAISYONASI
	CASE 4
		CALL RESET_NOUMIN
		CALL SET_NOUMIN
	CASE 5
		CALL SET_MAINHOME
	CASE 10
		CALL VIRGIN_SET
	CASE 11
		CALL BODY_SET
	CASE 20
		IF ゲーム开始处理中
			CALL NEWGAME_BONUS_SELECT
		ELSEIF ゲーム继承处理中
			CALL 周回特典
		ENDIF
ENDSELECT
RESTART

;-----------------------------------------------------------
;设定变更
;-----------------------------------------------------------
@NEWGAME_VERUP
;恋人修正済フラグを立てる
SETBIT FLAG:1000, 3
SETBIT FLAG:1000, 4
modding_version = 20250101
CALL VERSION_UP
PRINTW 游戏开始处理完成
SAVEDATA 99, "初次游玩"
PRINTL 已自动保存
PRINTW 要进行游戏的UPDATE处理吗？
CALL ASK_YN()
IF !RESULT
	CALL UPDATE
ELSE
	PRINTL 已跳过UPDATE
	PRINTW 请在起床前的SHOP画面进行UPDATE
ENDIF