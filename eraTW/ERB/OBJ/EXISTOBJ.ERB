;OBJ存在设定函数
@SETLIST_EXIST(CLASS_NAME, O_FIRST = OBJ_ID_FIRST, O_LAST = OBJ_ID_LAST)
#DIMS CLASS_NAME
#DIM O_FIRST
#DIM O_LAST
#DIM O_ID
;变量名F_NAMEを作成する
CALLF MAKE_EXIST(CLASS_NAME)

FOR O_ID, O_FIRST, O_LAST + 1
	;个々のF_NAME:LCOUNTを设定する
	TRYCCALLFORM EXIST_%CLASS_NAME%{O_ID}
		;DEBUGPRINTFORML EXIST %CLASS_NAME%{O_ID}
		CALLF SET_EXIST(CLASS_NAME, O_ID)
	CATCH
	ENDCATCH
NEXT

;ID取得函数用の设定を行う
TRYCCALLFORM EXIST_%CLASS_NAME%_ID
	;DEBUGPRINTFORML EXIST %CLASS_NAME%NAME_TO_ID
	CALLF OBJNAME_TO_ID(, "RESET", CLASS_NAME)
CATCH
ENDCATCH


;函数の存在判定用函数群
;变量の拟似定义
@MAKE_EXIST(CLASS_NAME)
#FUNCTION
#DIMS CLASS_NAME
RETURNF OBJ_EXIST("MAKE", CLASS_NAME)

;个々の函数の存在判定を设定
;先にCF_MAKEが必要
@SET_EXIST(CLASS_NAME, O_ID)
#FUNCTION
#DIMS CLASS_NAME
#DIM  O_ID
RETURNF OBJ_EXIST("SET", CLASS_NAME, O_ID)

;个々のINDEXの存在判定
@GET_EXIST(CLASS_NAME, O_ID)
#FUNCTION
#DIMS CLASS_NAME
#DIM  O_ID
RETURNF OBJ_EXIST("GET", CLASS_NAME, O_ID)



;OBJの存在状态の保持函数
;
;ほぼ一时变量保持变量の流用で一次元配列から二次元配列にしただけ
;CLEAR系命令がないので误消去の心配はない
@OBJ_EXIST(COMMAND, ARGS:0, ARG:0)
#FUNCTION
#DIMS CLASS_NAME, CLASS_NUM + 1
#DIMS COMMAND
#DIM EXIST, CLASS_NUM + 1, OBJ_ID_LAST + 1
#DIM OBJ_CNT
SELECTCASE COMMAND
;变量の拟似定义
CASE "MAKE"
	SIF !STRLENS(ARGS:0)
		THROW 变量名を设定して下さい
	SIF FINDELEMENT(CLASS_NAME, ESCAPE(ARGS:0) , 1, , 1) > 0
		THROW すでに设定済みの变量です%ARGS:0%
	SIF OBJ_CNT == CLASS_NUM
		THROW 保持变量が上限に达しています
	OBJ_CNT ++
	CLASS_NAME:(OBJ_CNT) = %ARGS:0%
;个々の变量の设定
CASE "SET"
	SIF !INRANGE(ARG:0, OBJ_ID_FIRST, OBJ_ID_LAST)
		THROW 配列の范围外です{ARG}
	SIF !STRLENS(ARGS:0)
		THROW 变量名を设定して下さい
	LOCAL:0 = FINDELEMENT(CLASS_NAME, ESCAPE(ARGS:0) , 1, , 1)
	SIF LOCAL:0 < 0
		THROW 未设定の变量です%ARGS:0%
	EXIST:(LOCAL:0):(ARG:0) = 1
;各函数の有无判定
CASE "GET"
	SIF !INRANGE(ARG:0, OBJ_ID_FIRST, OBJ_ID_LAST)
		THROW 配列の范围外です{ARG}
	SIF !STRLENS(ARGS:0)
		THROW 变量名を设定して下さい
	LOCAL:0 = FINDELEMENT(CLASS_NAME, ESCAPE(ARGS:0) , 1, , 1)
	SIF LOCAL:0 < 0
		THROW 未设定の变量です%ARGS:0%
	RETURNF EXIST:(LOCAL:0):(ARG:0)
CASEELSE
	THROW 未设定命令%COMMAND%
ENDSELECT
