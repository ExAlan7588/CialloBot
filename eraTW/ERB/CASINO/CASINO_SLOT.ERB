;
;スロットのメインプログラム
;


@CASINO_SLOT
;リール配列
;	左  	中  	右 
;1	REP 	MEL 	BEL
;2	BL7 	BL7 	BL7
;3	CHE 	REP 	MEL
;4	MEL 	BEL 	CHE
;5	BEL 	CHE 	REP
;6	REP 	CHE 	BEL
;7	CHE 	BAR 	RD7
;8	BAR 	REP 	MEL
;9	MEL 	BEL 	BAR
;10	BEL 	CHE 	REP
;11	REP 	RD7 	BEL
;12	BAR 	CHE 	BEL
;13	CHE 	REP 	MEL
;14	MEL 	BEL 	CHE
;15	BEL 	BAR 	REP
;16	REP 	MEL 	BEL
;17	RD7 	CHE 	BAR
;18	CHE 	REP 	MEL
;19	MEL 	BEL 	CHE
;20	BEL 	CHE 	REP

;绘柄一览
;1 RD7 赤7(BOUNS图柄)
;2 BL7 青7(BOUNS图柄)
;3 BEL ベル
;4 CHE チェリー
;5 MEL 西瓜
;6 BAR BAR(BOUNS图柄)
;7 REP 回放
;8 NUL 未选择

;=============================
;变量定义
;=============================
#DIM 初期所持筹码
#DIM 总回转数
#DIM 上次当选的旋转数
#DIM 短周期连开始时所持筹码
#DIM 闭店までに可能な回转数

#DIM オートモード
#DIM 死机回数
#DIM CONST 検定回数 = 100000

#DIM 当选履历, 11
#DIM 当选种类履历, 11
#DIM 当选枚数履历, 11

#DIM 小役カウンタ, 100

#DIM 情报パネル表示页

#DIM 営业开始时刻
#DIM 営业结束时刻

;一回转分の挂け金は3筹码
#DIM CONST 挂け金 = 3

;各绘柄の略称(B_A_Rのみ5文字なのに注意!!)
#DIM CONST RD7 = 1
#DIM CONST BL7 = 2
#DIM CONST BEL = 3
#DIM CONST CHE = 4
#DIM CONST MEL = 5
#DIM CONST B_A_R = 6
#DIM CONST REP = 7
#DIM CONST NUL = 8

;当选小役の种类
#DIM CONST 当选小役_赤7BOUNS = 0
#DIM CONST 当选小役_青7BOUNS = 1
#DIM CONST 当选小役_レギュラーBOUNS = 2
#DIM CONST 当选小役_中樱桃 = 3
#DIM CONST 当选小役_大樱桃 = 4
#DIM CONST 当选小役_小樱桃 = 5
#DIM CONST 当选小役_强西瓜 = 6
#DIM CONST 当选小役_弱西瓜 = 7
#DIM CONST 当选小役_ベル = 8
#DIM CONST 当选小役_回放 = 9
#DIM CONST 当选小役_落空了 = 99
;框の色
#DIM 色_框
#DIM CONST 削除行数 = 51

#DIM 绘柄_左上
#DIM 绘柄_左中
#DIM 绘柄_左下
#DIM 绘柄_中上
#DIM 绘柄_中中
#DIM 绘柄_中下
#DIM 绘柄_右上
#DIM 绘柄_右中
#DIM 绘柄_右下
#DIM 暗转_左上
#DIM 暗转_左中
#DIM 暗转_左下
#DIM 暗转_中上
#DIM 暗转_中中
#DIM 暗转_中下
#DIM 暗转_右上
#DIM 暗转_右中
#DIM 暗转_右下

;NULがDIM中で使用できないので直打ち
#DIM 绘柄_左上_回转中
#DIM 绘柄_左中_回转中
#DIM 绘柄_左下_回转中
#DIM 绘柄_中上_回转中
#DIM 绘柄_中中_回转中
#DIM 绘柄_中下_回转中
#DIM 绘柄_右上_回转中
#DIM 绘柄_右中_回转中
#DIM 绘柄_右下_回转中
#DIM 暗转_左上_回转中
#DIM 暗转_左中_回转中
#DIM 暗转_左下_回转中
#DIM 暗转_中上_回转中
#DIM 暗转_中中_回转中
#DIM 暗转_中下_回转中
#DIM 暗转_右上_回转中
#DIM 暗转_右中_回转中
#DIM 暗转_右下_回转中

#DIM 设定
#DIM 内部状态
#DIM 短周期连继续率
#DIM 短周期连セット数
#DIM 累计短周期连セット数
#DIM 前兆
#DIM 当选的小役
#DIM 当选したBB种类
#DIM 小役抽选不会
#DIM 投入筹码
#DIM 嫌がらせボタン番号

;=============================
;各变量の初期化
;=============================
;のちのち状况に応じて框の色を变える予定あり
色_框 = 0xE6B422
初期所持筹码 = MONEY:2
短周期连开始时所持筹码 = 0
总回转数 = 0
上次当选的旋转数 = 0

;开店は07时
営业开始时刻 = 7 * 60
;闭店は22时
営业结束时刻 = 22 * 60
闭店までに可能な回转数 = 闭店まで回せる回转数(営业结束时刻)

オートモード = 0
死机回数 = 0

短周期连セット数 = 0
累计短周期连セット数 = 0

情报パネル表示页 = 0

;0回转当选が存在しないため0で初期化
VARSET 当选履历, 0

VARSET 当选种类履历, -1
VARSET 当选枚数履历, 0

VARSET 小役カウンタ, 0

绘柄_左上 = REP
绘柄_左中 = RD7
绘柄_左下 = CHE
绘柄_中上 = CHE
绘柄_中中 = RD7
绘柄_中下 = CHE
绘柄_右上 = BEL
绘柄_右中 = RD7
绘柄_右下 = MEL
暗转_左上 = 0
暗转_左中 = 0
暗转_左下 = 0
暗转_中上 = 0
暗转_中中 = 0
暗转_中下 = 0
暗转_右上 = 0
暗转_右中 = 0
暗转_右下 = 0

绘柄_左上_回转中 = NUL
绘柄_左中_回转中 = NUL
绘柄_左下_回转中 = NUL
绘柄_中上_回转中 = NUL
绘柄_中中_回转中 = NUL
绘柄_中下_回转中 = NUL
绘柄_右上_回转中 = NUL
绘柄_右中_回转中 = NUL
绘柄_右下_回转中 = NUL
暗转_左上_回转中 = 0
暗转_左中_回转中 = 0
暗转_左下_回转中 = 0
暗转_中上_回转中 = 0
暗转_中中_回转中 = 0
暗转_中下_回转中 = 0
暗转_右上_回转中 = 0
暗转_右中_回转中 = 0
暗转_右下_回转中 = 0

;数字によって色んな期待值が变わるアレ(内部状态とは异なる)
;设定 = RAND(6) + 1
CALL 设定决定(设定)


;内部状态:机械内の状态を表す
;1:通常,2:高确(各フラグによる抽选が2回になる)
;3超高确:(各フラグによる抽选が3回になる),4:短周期连(天井３２Ｇ),5死机
内部状态 = 1

;短周期连继续率:内部状态が３２Ｇ连のときのループ继续率
;0～95の值が入る予定
短周期连继续率 = 0
;发生していないときは-1,发生した场合1ゲームごとに值を减らし0になると当选
前兆 = -1

;1が立っている场合小役抽选を行わない
;情报パネルの操作を行うとさっき成立した小役による各种抽选をまた行ってしまうためこのフラグを立てる
;无抽选モードとかにも恶用できそう
小役抽选不会 = 0

;当选的小役 
;0:斯卡雷特BB当选
;1:十六夜BB当选
;2:REG当选
;3:中段樱桃当选
;4:大樱桃当选
;5:小樱桃当选
;6:强西瓜当选
;7:弱西瓜当选
;8:ベル当选
;9:回放当选
;99:落空了
当选的小役 = 当选小役_落空了

;当选したBB种类　-1:当选してないよ,0:斯卡雷特BB当选，1:十六夜BB当选，2:REG当选
当选したBB种类 = -1

;=============================
;开店前の场合
;=============================
IF TIME < 営业开始时刻
	PRINTW 看来来得太早了
	PRINTW 柜台前立着『准备中』的牌子
	PRINTFORMW 『今天的营业时间是%时刻表示(営业开始时刻)% ~ %时刻表示(営业结束时刻)%、在开店前请再稍等一会儿』
	RETURN 0
ENDIF

;=============================
;开店后の场合
;=============================
IF TIME >= 営业结束时刻
	PRINTW …看来来的太晚了
	PRINTW 柜台前立着『准备中』的牌子
	PRINTFORMW 『今天的营业结束了、期待您的再次光临　明天%时刻表示(営业开始时刻)%开始营业』
	RETURN 0
ENDIF

;=============================
;初期文章表示
;=============================
PRINTW 这里是角落的老虎机。
PRINTW 请好好地享受。

$INPUT_LOOP
CALL SLOT_情报パネル表示(情报パネル表示页,总回转数,上次当选的旋转数,累计短周期连セット数,当选履历,当选种类履历,当选枚数履历,小役カウンタ)
CALL SLOT_全体表示(色_框,绘柄_左上,绘柄_左中,绘柄_左下,绘柄_中上,绘柄_中中,绘柄_中下,绘柄_右上,绘柄_右中,绘柄_右下,暗转_左上,暗转_左中,暗转_左下,暗转_中上,暗转_中中,暗转_中下,暗转_右上,暗转_右中,暗转_右下)
DRAWLINE
;=================================
;PRINTL1行を使ってメッセージを插入
;=================================
CALL 一言メッセージ(短周期连セット数,设定,前兆,当选したBB种类,内部状态,短周期连继续率,当选的小役,上次当选的旋转数,短周期连开始时所持筹码)

PRINTFORML 所持筹码 {MONEY:2} 筹码差枚 {MONEY:2-初期所持筹码}
PRINTFORML 回转数 {总回转数}G 距离上次的大奖{上次当选的旋转数}G
PRINTFORML [0] - 放弃游戏
PRINTFORML [2] - 操作情报面板
PRINTFORML [1] - 玩老虎机

;=============================
;いろんなものの修正处理
;=============================
;当选していた场合前兆,当选したBB种类を-1にセットし直す
SIF 前兆 == 0
	前兆 = -1
SIF 当选したBB种类 > -1
	当选したBB种类 = -1

;死机した场合３２Ｇ连状态にセット
SIF 内部状态 == 5
	内部状态 = 4
;短周期连继续率が95％を超えた场合95％に戻す(レア小役引きすぎるとこうなる)
SIF 短周期连继续率 > 95
	短周期连继续率 = 95
	
;情报パネルの操作ボタンを押してここに回来了场合さっき引いた小役でもう一回抽选を行うため
;このフラグが立っていたら强制的に小役による抽选をスキップする(情报パネルの操作选择时にフラグは立つ)
IF 小役抽选不会
	小役抽选不会 = 0
	GOTO 抽选终わり
ENDIF
;=====================================
;今回当たっていた小役に对応した抽选
;=====================================
$小役抽选开始
;～～～～～～～～～～～～～～～～～～～～～～～
;３２Ｇ连最终ゲームの场合
;～～～～～～～～～～～～～～～～～～～～～～～
IF 内部状态 == 4 && 上次当选的旋转数 >= 31
	
	;成立したフラグによって变化
	SELECTCASE 当选的小役
	
	;3:中樱桃当选の场合(继续确定)
	CASE 当选小役_中樱桃
		
		;短周期连继续率变更抽选
		;短周期连继续率を95％に上书き
		短周期连继续率 = 95
		
		;继续确定抽选
		IF RAND(100) < 中段樱桃_32G连中(设定)
			;次ゲームBOUNS当选(继续确定)
			前兆 = 0
			
			GOTO 抽选终わり
		ENDIF
	
	;4:大樱桃当选の场合
	CASE 当选小役_大樱桃
		
		;短周期连继续率变更抽选
		;短周期连继续率を增加
		短周期连继续率 += 短周期连继续率变更(设定)
		
		;继续确定抽选
		IF RAND(100) < 大樱桃_32G连中(设定)
			;次ゲームBOUNS当选(继续确定)
			前兆 = 0
			GOTO 抽选终わり
		ENDIF
	
	;5:小樱桃当选の场合
	CASE 当选小役_小樱桃
		
		;短周期连继续率变更抽选
		;50％の概率で短周期连继续率を增加
		SIF RAND(100) < 50
			短周期连继续率 += 短周期连继续率变更(设定)
		
		;继续确定抽选
		IF RAND(100) < 小樱桃_32G连中(设定)
			;次ゲームBOUNS当选(继续确定)
			前兆 = 0
			GOTO 抽选终わり
		ENDIF
	
	;6:强西瓜当选の场合
	CASE 当选小役_强西瓜
		
		;短周期连继续率变更抽选
		;短周期连继续率を增加
		短周期连继续率 += 短周期连继续率变更(设定)
		
		;继续确定抽选
		IF RAND(100) < 强西瓜_32G连中(设定)
			;次ゲームBOUNS当选(继续确定)
			前兆 = 0
			GOTO 抽选终わり
		ENDIF
	
	;7:弱西瓜当选の场合
	CASE 当选小役_弱西瓜
		
		;短周期连继续率变更抽选
		;25％の概率で短周期连继续率を增加
		SIF RAND(100) < 25
			短周期连继续率 += 短周期连继续率变更(设定)
		
		;继续确定抽选
		IF RAND(100) < 弱西瓜_32G连中(设定)
			;次ゲームBOUNS当选(继续确定)
			前兆 = 0
			GOTO 抽选终わり
		ENDIF
	
	;8:ベル当选の场合
	CASE 当选小役_ベル
		
		;短周期连继续率变更抽选(ベルでは行わない)
		
		
		;继续确定抽选
		IF RAND(1000) < ベル_32G连中(设定)
			;次ゲームBOUNS当选(继续确定)
			前兆 = 0
			GOTO 抽选终わり
		ENDIF
	
	;9:回放当选の场合
	CASE 当选小役_回放
		
		;短周期连继续率变更抽选(回放では行わない)
		
		
		;继续确定抽选
		IF RAND(1000) < 回放_32G连中(设定)
			;次ゲームBOUNS当选(继续确定)
			前兆 = 0
			GOTO 抽选终わり
		ENDIF
	
	;99:落空了当选の场合
	CASE 当选小役_落空了
		
		;短周期连继续率变更抽选
		;50％の概率で短周期连继续率を增加
		SIF RAND(100) < 50
			短周期连继续率 += 短周期连继续率变更(设定)
		
		;继续确定抽选
		IF RAND(100) < 落空了_32G连中(设定)
			;次ゲームBOUNS当选(继续确定)
			前兆 = 0
			GOTO 抽选终わり
		ENDIF
	
	;其他(默认では存在しないはず)
	CASEELSE
		PRINTFORMW 存在不存在的小役当选了 小役番号:{当选的小役}
	ENDSELECT
	
	
	;======================================================================
	;短周期连(32Ｇ连)结束确定
	;ここ来了ということは短周期连结束は确定しているので内部状态振り分け
	;======================================================================
	;设定によって内部状态振り分けは异なる
	IF 前兆 == -1
		内部状态 = 短周期连结束时状态振り分け(设定)
		短周期连セット数 = 0
	ENDIF
	

;～～～～～～～～～～～～～～～～～～～～～～～
;３２Ｇ连中(最终ゲーム除く)の场合
;～～～～～～～～～～～～～～～～～～～～～～～
ELSEIF 内部状态 == 4
	
	;成立したフラグによって变化
	SELECTCASE 当选的小役
	
	;BOUNS当选时はBOUNS当选直后に继续抽选を行う
	;0:斯卡雷特BB当选の场合
	CASE 当选小役_赤7BOUNS
		短周期连セット数 ++
		SIF RAND(100) < 短周期连继续率
			前兆 = MIN(前兆设定(内部状态),32 - 上次当选的旋转数)
	
	;BOUNS当选时はBOUNS当选直后に继续抽选を行う
	;1:十六夜BB当选の场合
	CASE 当选小役_青7BOUNS
		短周期连セット数 ++
		SIF RAND(100) < 短周期连继续率
			前兆 = MIN(前兆设定(内部状态),32 - 上次当选的旋转数)
	
	;BOUNS当选时はBOUNS当选直后に继续抽选を行う
	;2:REG当选の场合
	CASE 当选小役_レギュラーBOUNS
		短周期连セット数 ++
		SIF RAND(100) < 短周期连继续率
			前兆 = MIN(前兆设定(内部状态),32 - 上次当选的旋转数)
	
	;レア小役
	;3:中樱桃当选の场合(继续确定)
	CASE 当选小役_中樱桃
		
		;短周期连继续率变更抽选
		;短周期连继续率を95％に上书き
		短周期连继续率 = 95
		
		;继续确定抽选
		IF RAND(100) < 中段樱桃_32G连中(设定)
			;次ゲームBOUNS当选(继续确定)
			IF 前兆 == -1
				前兆 = MIN(前兆设定(内部状态),32 - 上次当选的旋转数)
			ELSE
				前兆 = MIN(前兆设定(内部状态),32 - 上次当选的旋转数,前兆)
			ENDIF
			GOTO 抽选终わり
		ENDIF
	
	;4:大樱桃当选の场合
	CASE 当选小役_大樱桃
		
		;短周期连继续率变更抽选
		;40％の概率で短周期连继续率を增加
		SIF RAND(100) < 40
			短周期连继续率 += 短周期连继续率变更(设定)
		
		;继续确定抽选
		IF RAND(100) < 大樱桃_32G连中(设定)
			;次ゲームBOUNS当选(继续确定)
			IF 前兆 == -1
				前兆 = MIN(前兆设定(内部状态),32 - 上次当选的旋转数)
			ELSE
				前兆 = MIN(前兆设定(内部状态),32 - 上次当选的旋转数,前兆)
			ENDIF
			
			GOTO 抽选终わり
		ENDIF
	
	;5:小樱桃当选の场合
	CASE 当选小役_小樱桃
		
		;短周期连继续率变更抽选
		;20％の概率で短周期连继续率を增加
		SIF RAND(100) < 20
			短周期连继续率 += 短周期连继续率变更(设定)
		
		;继续确定抽选
		IF RAND(100) < 小樱桃_32G连中(设定)
			;次ゲームBOUNS当选(继续确定)
			IF 前兆 == -1
				前兆 = MIN(前兆设定(内部状态),32 - 上次当选的旋转数)
			ELSE
				前兆 = MIN(前兆设定(内部状态),32 - 上次当选的旋转数,前兆)
			ENDIF
			
			GOTO 抽选终わり
		ENDIF
	
	;6:强西瓜当选の场合
	CASE 当选小役_强西瓜
		
		;短周期连继续率变更抽选
		;25％の概率で短周期连继续率を增加
		SIF RAND(100) < 25
			短周期连继续率 += 短周期连继续率变更(设定)
		
		;继续确定抽选
		IF RAND(100) < 强西瓜_32G连中(设定)
			;次ゲームBOUNS当选(继续确定)
			IF 前兆 == -1
				前兆 = MIN(前兆设定(内部状态),32 - 上次当选的旋转数)
			ELSE
				前兆 = MIN(前兆设定(内部状态),32 - 上次当选的旋转数,前兆)
			ENDIF
			
			GOTO 抽选终わり
		ENDIF
	
	;7:弱西瓜当选の场合
	CASE 当选小役_弱西瓜
		
		;短周期连继续率变更抽选
		;10％の概率で短周期连继续率を增加
		SIF RAND(100) < 10
			短周期连继续率 += 短周期连继续率变更(设定)
		
		;继续确定抽选
		IF RAND(100) < 弱西瓜_32G连中(设定)
			;次ゲームBOUNS当选(继续确定)
			IF 前兆 == -1
				前兆 = MIN(前兆设定(内部状态),32 - 上次当选的旋转数)
			ELSE
				前兆 = MIN(前兆设定(内部状态),32 - 上次当选的旋转数,前兆)
			ENDIF
			
			GOTO 抽选终わり
		ENDIF
	
	;8:ベル当选の场合
	CASE 当选小役_ベル
		
		;短周期连继续率变更抽选(ベルでは行わない)
		
		
		;继续确定抽选
		IF RAND(1000) < ベル_32G连中(设定)
			;次ゲームBOUNS当选(继续确定)
			IF 前兆 == -1
				前兆 = MIN(前兆设定(内部状态),32 - 上次当选的旋转数)
			ELSE
				前兆 = MIN(前兆设定(内部状态),32 - 上次当选的旋转数,前兆)
			ENDIF
			
			GOTO 抽选终わり
		ENDIF
	
	;9:回放当选の场合
	CASE 当选小役_回放
		
		;短周期连继续率变更抽选(回放では行わない)
		
		
		;继续确定抽选
		IF RAND(1000) < 回放_32G连中(设定)
			;次ゲームBOUNS当选(继续确定)
			IF 前兆 == -1
				前兆 = MIN(前兆设定(内部状态),32 - 上次当选的旋转数)
			ELSE
				前兆 = MIN(前兆设定(内部状态),32 - 上次当选的旋转数,前兆)
			ENDIF
			
			GOTO 抽选终わり
		ENDIF
	
	;99:落空了当选の场合
	CASE 当选小役_落空了
		
		;短周期连继续率变更抽选
		;25％の概率で短周期连继续率を增加
		SIF RAND(100) < 25
			短周期连继续率 += 短周期连继续率变更(设定)
		
		;继续确定抽选
		IF RAND(100) < 落空了_32G连中(设定)
			;次ゲームBOUNS当选(继续确定)
			IF 前兆 == -1
				前兆 = MIN(前兆设定(内部状态),32 - 上次当选的旋转数)
			ELSE
				前兆 = MIN(前兆设定(内部状态),32 - 上次当选的旋转数,前兆)
			ENDIF
			
			GOTO 抽选终わり
		ENDIF
	
	;其他(默认では存在しないはず)
	CASEELSE
		PRINTFORMW 存在不存在的小役当选了 小役番号:{当选的小役}
	ENDSELECT
	
;～～～～～～～～～～～～～～～～～～～～～～～
;通常,高确,超高确の场合
;～～～～～～～～～～～～～～～～～～～～～～～
ELSE
	;成立したフラグによって变化
	SELECTCASE 当选的小役
	
	;BOUNS当选时はBOUNS当选直后に短周期连突入抽选を行う
	;0:斯卡雷特BB当选の场合(1/2で短周期连突入)
	CASE 当选小役_赤7BOUNS
		IF !RAND(2)
			;内部状态を短周期连に
			内部状态 = 4
			;继续率の决定
			短周期连继续率 = 短周期连继续率设定(设定)
			;短周期连セット数の初期化(GOTOした后に1足されるのでここでは0)
			短周期连セット数 = 0
			短周期连开始时所持筹码 = MONEY:2
			SIF 内部状态 == 4
				累计短周期连セット数 ++
			;小役抽选开始地点に戻す
			GOTO 小役抽选开始
		ENDIF
	
	;BOUNS当选时はBOUNS当选直后に短周期连突入抽选を行う
	;1:十六夜BB当选の场合(1/3で短周期连突入)
	CASE 当选小役_青7BOUNS
		IF !RAND(3)
			;内部状态を短周期连に
			内部状态 = 4
			;继续率の决定
			短周期连继续率 = 短周期连继续率设定(设定)
			;短周期连セット数の初期化(GOTOした后に1足されるのでここでは0)
			短周期连セット数 = 0
			短周期连开始时所持筹码 = MONEY:2
			SIF 内部状态 == 4
				累计短周期连セット数 ++
			;小役抽选开始地点に戻す
			GOTO 小役抽选开始
		ENDIF
	
	;BOUNS当选时はBOUNS当选直后に短周期连突入抽选を行う
	;2:REG当选の场合(1/5で短周期连突入)
	CASE 当选小役_レギュラーBOUNS
		IF !RAND(5)
			;内部状态を短周期连に
			内部状态 = 4
			;继续率の决定
			短周期连继续率 = 短周期连继续率设定(设定)
			;短周期连セット数の初期化(GOTOした后に1足されるのでここでは0)
			短周期连セット数 = 0
			短周期连开始时所持筹码 = MONEY:2
			SIF 内部状态 == 4
				累计短周期连セット数 ++
			;小役抽选开始地点に戻す
			GOTO 小役抽选开始
		ENDIF
	
	;レア小役当选时はBOUNS当选抽选を行う
	;3:中樱桃当选の场合
	;中段樱桃の处理は特别なものになる
	;斯卡雷特BB确定＆继续率90％以上短周期连突入确定
	CASE 当选小役_中樱桃
		前兆 = 0
		GOTO 抽选终わり
	
	;レア小役当选时は内部状态抽选とBOUNS当选抽选を行う
	;4:大樱桃当选の场合
	CASE 当选小役_大樱桃
		
		;内部状态抽选
		;大樱桃は50％で内部状态が升格する
		IF 内部状态 < 3
			SIF !RAND(2)
				内部状态 ++
		ENDIF
		
		;BOUNS当选抽选
		IF 中奖_非32G连(当选的小役,设定,内部状态)
			;次ゲームBOUNS当选
			;前兆中にBOUNS当选した场合前兆の短いほうが选ばれもう片方は舍てられる
			IF 前兆 != -1
				前兆 = MIN(前兆,前兆设定(内部状态))
			ELSE
				前兆 = 前兆设定(内部状态)
			ENDIF
			
			GOTO 抽选终わり
		ENDIF
	
	;レア小役当选时は内部状态抽选とBOUNS当选抽选を行う
	;5:小樱桃当选の场合
	CASE 当选小役_小樱桃
		
		;内部状态抽选
		;小樱桃は30％で内部状态が升格する
		IF 内部状态 < 3
			SIF RAND(10) < 3
				内部状态 ++
		ENDIF
		
		;BOUNS当选抽选
		IF 中奖_非32G连(当选的小役,设定,内部状态)
			;次ゲームBOUNS当选
			;前兆中にBOUNS当选した场合前兆の短いほうが选ばれもう片方は舍てられる
			IF 前兆 != -1
				前兆 = MIN(前兆,前兆设定(内部状态))
			ELSE
				前兆 = 前兆设定(内部状态)
			ENDIF
			
			GOTO 抽选终わり
		ENDIF
	
	;レア小役当选时は内部状态抽选とBOUNS当选抽选を行う
	;6:强西瓜当选の场合
	CASE 当选小役_强西瓜
		
		;内部状态抽选
		;强西瓜は50％で内部状态が升格する
		IF 内部状态 < 3
			SIF !RAND(2)
				内部状态 ++
		ENDIF
		
		;BOUNS当选抽选
		IF 中奖_非32G连(当选的小役,设定,内部状态)
			;次ゲームBOUNS当选
			;前兆中にBOUNS当选した场合前兆の短いほうが选ばれもう片方は舍てられる
			IF 前兆 != -1
				前兆 = MIN(前兆,前兆设定(内部状态))
			ELSE
				前兆 = 前兆设定(内部状态)
			ENDIF
			
			GOTO 抽选终わり
		ENDIF
	
	;レア小役当选时は内部状态抽选とBOUNS当选抽选を行う
	;7:弱西瓜当选の场合
	CASE 当选小役_弱西瓜
		
		;内部状态抽选
		;弱西瓜は25％で内部状态が升格する
		IF 内部状态 < 3
			SIF !RAND(4)
				内部状态 ++
		ENDIF
		
		;BOUNS当选抽选
		IF 中奖_非32G连(当选的小役,设定,内部状态)
			;次ゲームBOUNS当选
			;前兆中にBOUNS当选した场合前兆の短いほうが选ばれもう片方は舍てられる
			IF 前兆 != -1
				前兆 = MIN(前兆,前兆设定(内部状态))
			ELSE
				前兆 = 前兆设定(内部状态)
			ENDIF
			
			GOTO 抽选终わり
		ENDIF
	
	;小役当选时は内部状态抽选とBOUNS当选抽选を行う
	;8:ベル当选の场合
	CASE 当选小役_ベル
		
		;BOUNS当选抽选
		IF 中奖_非32G连(当选的小役,设定,内部状态)
			;次ゲームBOUNS当选
			;前兆中にBOUNS当选した场合前兆の短いほうが选ばれもう片方は舍てられる
			IF 前兆 != -1
				前兆 = MIN(前兆,前兆设定(内部状态))
			ELSE
				前兆 = 前兆设定(内部状态)
			ENDIF
			
			GOTO 抽选终わり
		ENDIF
	
	;小役当选时は内部状态抽选とBOUNS当选抽选を行う
	;9:回放当选の场合
	CASE 当选小役_回放
		
		;BOUNS当选抽选
		IF 中奖_非32G连(当选的小役,设定,内部状态)
			;次ゲームBOUNS当选
			;前兆中にBOUNS当选した场合前兆の短いほうが选ばれもう片方は舍てられる
			IF 前兆 != -1
				前兆 = MIN(前兆,前兆设定(内部状态))
			ELSE
				前兆 = 前兆设定(内部状态)
			ENDIF
			
			GOTO 抽选终わり
		ENDIF
	
	;小役当选时は内部状态抽选とBOUNS当选抽选を行う
	;99:落空了当选の场合
	CASE 当选小役_落空了
		
		;内部状态抽选
		;落空了は2％で内部状态が降格する
		IF 内部状态 > 1
			SIF !RAND(50)
				内部状态 --
		ENDIF
		
		;BOUNS当选抽选
		IF 中奖_非32G连(当选的小役,设定,内部状态)
			;次ゲームBOUNS当选
			;前兆中にBOUNS当选した场合前兆の短いほうが选ばれもう片方は舍てられる
			IF 前兆 != -1
				前兆 = MIN(前兆,前兆设定(内部状态))
			ELSE
				前兆 = 前兆设定(内部状态)
			ENDIF
			
			GOTO 抽选终わり
		ENDIF
	
	;其他(默认では存在しないはず)
	CASEELSE
		PRINTFORMW 存在不存在的小役当选了 小役番号:{当选的小役}
	ENDSELECT
ENDIF


;当选ゲーム数の设定(短周期连→通常转落时)
IF 前兆 == -1 && 内部状态 < 4
	前兆 = 当选ゲーム数设定()
	上次当选的旋转数 = 0
ENDIF
$抽选终わり

IF オートモード == 1 && 总回转数 < 検定回数
	PRINTL 
	RESULT = 1
ELSE
	INPUT
ENDIF


IF RESULT == 1
	;=============================
	;所持筹码が足りない场合
	;※スロットをやめさせる
	;=============================
	IF MONEY:2 < 挂け金
		PRINTL 没有筹码用来投币
		GOTO GAME_END
	ENDIF
	
	;=============================
	;闭店时间の场合
	;※スロットをやめさせる
	;=============================
	IF 总回转数 >= 闭店までに可能な回转数 && オートモード == 0
		PRINTW 「…」
		PRINTW 「…」
		PRINTW 「……客……客…」
		PRINTW 「……客人！」
		PRINTL 
		PRINTW 回头一看、那里有一个店员的身影……
		PRINTW 「…客人、我们要关门了」
		PRINTL 
		PRINTFORML %NAME_OUTPUT_TRANSLATION("CALLNAME", MASTER)%环顾四周
		PRINTW …客人都已经散去的几乎没有了
		PRINTL 
		PRINTL 「本店现在停止今天的营业」
		PRINTW 「关店后的保障、第二天的结转等概不应对、请谅解」
		PRINTL 「回去的时候从那边的门的离开、感谢您今天光临本店」
		PRINTW 「回去的时候请小心」
		
		;マクロ使ってる人类への嫌がらせポイント
		;个人的にはマクロは使いたいなら胜手に使えばよろしいという立场
		;ツール使わず手动で回すぶんにはこんなスロット金策にもなりゃしないのに※设定３なら1万回回して+300程度の期待值
		;ツール使用すること前提のチートに对して对处しろだの考えとけ马鹿だの知らんがな(´・ω・`)
		;しかも、いい结果が出るまでセーブ＆ロードされるのが问题って…
		;良い设定ツモったら100％胜てるとか勘违いしてませんかね
		;とりあえず10万回程度じゃ概率收束なんて不会うに设计してるので、数千回程度で胜った负けたは设定じゃなくてヒキの问题です
		;负けたらリロードするんだからそりゃ甜だろうなぁ、低设定でも喷くときゃ喷くし
		;まぁ、これ入れときゃマクラーはほぼ坏灭
		;更にスロットの利用者更に减って谁も使わなくなるだろうからもう何も言われることもなくなるでしょう
		
		
		;まずは抽选する
		嫌がらせボタン番号 = RAND(1000000)
		;番号が1にはならないように退避
		SIF 嫌がらせボタン番号 >= 1
			嫌がらせボタン番号 ++
		PRINTL 
		PRINTFORM [{嫌がらせボタン番号}] 小心地走出店门
		
		LOCAL:1 = 0
		$IYAGARASE_INPUT
		INPUT
		;ちゃんとクリックしたら（まあ正しい番号を入力してもいいけど）退店できる
		IF RESULT == 嫌がらせボタン番号
			GOTO GAME_END
		;死ぬが良い、骨は拾ってやる
		ELSEIF RESULT == 1 && LOCAL:1 == 0
			;初回に1を押したらボタンまで消去される、これで正しい番号入れない限り退店できなくなる
			;2回目以降に1を押すとボタンまで消えないが、そういった人たちはマクロ使いではないのでセーフ
			;0～1000000の中から正しい数字をピンポイントで选んでね
			CLEARLINE 2
			SETCOLOR 0xFF0000
			PRINTL 「啊、请 小 心 点 地回去吧？」
			PRINTL 
			RESETCOLOR
			LOCAL:1 ++
		;穏当に警告　间违えて番号打っちゃった人はちゃんとボタンを押せばいいので大丈夫
		;マクラーは…ま、これが出てる时点で手遅れなんですけどね？
		ELSE
			CLEARLINE 1
			SIF LOCAL:1 == 1
				CLEARLINE 1
			PRINTL 「啊、请小心点儿回去吧？」
		ENDIF
		GOTO IYAGARASE_INPUT
	ENDIF
	
	;=============================
	;一回转分の挂け金征收
	;=============================
	MONEY:2 -= 挂け金
	
	;=============================
	;前回のスロット画面を消去
	;=============================
	CLEARLINE 削除行数
	;=============================
	;回转数を1增加
	;=============================
	总回转数 ++
	上次当选的旋转数 ++
	SIF 前兆 > 0
		前兆 --
	
	;=============================
	;死机(1/131072)
	;死机した场合は处理が特别になるのでここで记述
	;死机恩惠　斯卡雷特BB确定 继续率95％连
	;=============================
	IF !RAND(131072)
		;全リール暗转
		暗转_左上 = 1
		暗转_左中 = 1
		暗转_左下 = 1
		暗转_中上 = 1
		暗转_中中 = 1
		暗转_中下 = 1
		暗转_右上 = 1
		暗转_右中 = 1
		暗转_右下 = 1
		
		;死机したので内部状态を5にする
		内部状态 = 5
		
		CALL SLOT_情报パネル表示(情报パネル表示页,总回转数,上次当选的旋转数,累计短周期连セット数,当选履历,当选种类履历,当选枚数履历,小役カウンタ)
		CALL SLOT_全体表示(色_框,绘柄_左上,绘柄_左中,绘柄_左下,绘柄_中上,绘柄_中中,绘柄_中下,绘柄_右上,绘柄_右中,绘柄_右下,暗转_左上,暗转_左中,暗转_左下,暗转_中上,暗转_中中,暗转_中下,暗转_右上,暗转_右中,暗转_右下)
		DRAWLINE
		CALL 一言メッセージ(短周期连セット数,设定,前兆,当选したBB种类,内部状态,短周期连继续率,当选的小役,上次当选的旋转数,短周期连开始时所持筹码)
		PRINTFORML 所持筹码 {MONEY:2} 筹码差枚 {MONEY:2-初期所持筹码}
		PRINTFORML 回转数 {总回转数}G 距离上次的大奖{上次当选的旋转数}G
		PRINTL 
		PRINTL 
		PRINTL 
		
		;3秒间停止させる
		TWAIT 3000,1
		;=============================
		;前回のスロット画面を消去
		;=============================
		CLEARLINE 削除行数
		
		;全リール明るいままでの斯卡雷特BB(通常时とは异なる)
		绘柄_左上 = REP
		绘柄_左中 = RD7
		绘柄_左下 = CHE
		绘柄_中上 = CHE
		绘柄_中中 = RD7
		绘柄_中下 = CHE
		绘柄_右上 = BEL
		绘柄_右中 = RD7
		绘柄_右下 = MEL
		暗转_左上 = 0
		暗转_左中 = 0
		暗转_左下 = 0
		暗转_中上 = 0
		暗转_中中 = 0
		暗转_中下 = 0
		暗转_右上 = 0
		暗转_右中 = 0
		暗转_右下 = 0
		
		;斯卡雷特BB当选
		当选的小役 = 0
		
		死机回数 ++
		;死机恩惠 斯卡雷特BB确定 继续率95％连をセット
		当选したBB种类 = 0
		
		
		;=============================
		;筹码の获得
		;=============================
		CALL 小役支付戻し(当选的小役)
		
		
		;=============================
		;小役カウンタ
		;=============================
		小役カウンタ:当选的小役 ++
		
		FOR LOCAL,0,10
			SIF 当选种类履历:(9-LOCAL) == -1
				CONTINUE
			当选种类履历:(10-LOCAL) = 当选种类履历:(9-LOCAL)
			当选履历:(10-LOCAL) = 当选履历:(9-LOCAL)
			当选枚数履历:(10-LOCAL) = 当选枚数履历:(9-LOCAL)
		NEXT
		
		SIF 内部状态 == 5
			累计短周期连セット数 ++
		当选种类履历:0 = 当选的小役
		当选履历:0 = 上次当选的旋转数
		IF 短周期连セット数
			当选枚数履历:0 = MONEY:2 - 短周期连开始时所持筹码
		ELSE
			SELECTCASE 当选的小役
			CASE 当选小役_赤7BOUNS
				当选枚数履历:0 = 400
			CASE 当选小役_青7BOUNS
				当选枚数履历:0 = 200
			CASE 当选小役_レギュラーBOUNS
				当选枚数履历:0 = 100
			CASEELSE
			ENDSELECT
		ENDIF
		
		上次当选的旋转数 = 0
		短周期连继续率 = 95
		
		SIF 短周期连セット数 == 0
			短周期连开始时所持筹码 = MONEY:2
		
		;INPUT_LOOPへ
		GOTO INPUT_LOOP
	ENDIF
	
	;=============================
	;前回の结果を初期化
	;=============================
	绘柄_左上 = NUL
	绘柄_左中 = NUL
	绘柄_左下 = NUL
	绘柄_中上 = NUL
	绘柄_中中 = NUL
	绘柄_中下 = NUL
	绘柄_右上 = NUL
	绘柄_右中 = NUL
	绘柄_右下 = NUL
	暗转_左上 = 0
	暗转_左中 = 0
	暗转_左下 = 0
	暗转_中上 = 0
	暗转_中中 = 0
	暗转_中下 = 0
	暗转_右上 = 0
	暗转_右中 = 0
	暗转_右下 = 0
	
	;=============================
	;回转最中のスロット表示
	;=============================
	CALL SLOT_情报パネル表示(情报パネル表示页,总回转数,上次当选的旋转数,累计短周期连セット数,当选履历,当选种类履历,当选枚数履历,小役カウンタ)
	CALL SLOT_全体表示(色_框,绘柄_左上_回转中,绘柄_左中_回转中,绘柄_左下_回转中,绘柄_中上_回转中,绘柄_中中_回转中,绘柄_中下_回转中,绘柄_右上_回转中,绘柄_右中_回转中,绘柄_右下_回转中,暗转_左上_回转中,暗转_左中_回转中,暗转_左下_回转中,暗转_中上_回转中,暗转_中中_回转中,暗转_中下_回转中,暗转_右上_回转中,暗转_右中_回转中,暗转_右下_回转中)
	DRAWLINE
	PRINTL 
	PRINTFORML 所持筹码 {MONEY:2} 筹码差枚 {MONEY:2-初期所持筹码}
	PRINTFORML 回转数 {总回转数}G 距离上次的大奖{上次当选的旋转数}G
	PRINTL  
	PRINTL  
	PRINTFORML [1] - 停止转动
	;リール回转
	IF オートモード == 1 && 总回转数 < 検定回数
		PRINTL 
		RESULT = 1
	ELSE
		INPUT
	ENDIF
	CLEARLINE 削除行数
	
	;=============================
	;特殊な状态の场合は个々に记述する
	;=============================
	
	;=============================
	;前兆が0GならばBB当选
	;=============================
	IF 前兆 == 0
		SIF 当选的小役 == 当选小役_中樱桃
			GOTO 斯卡雷特BB
		IF RAND(2)
			;合计1/3で十六夜BB(200)
			IF RAND(3)
$十六夜BB
				;=============================
				;当选したBB种类に1(十六夜BB)を代入
				;=============================
				当选したBB种类 = 1
				
				;=============================
				;左绘柄决定
				;=============================
				绘柄_左上 = REP
				绘柄_左中 = BL7
				绘柄_左下 = CHE
				暗转_左上 = 1
				暗转_左中 = 0
				暗转_左下 = 1
				;=============================
				;回转最中のスロット表示
				;=============================
				CALL SLOT_情报パネル表示(情报パネル表示页,总回转数,上次当选的旋转数,累计短周期连セット数,当选履历,当选种类履历,当选枚数履历,小役カウンタ)
				CALL SLOT_全体表示(色_框,绘柄_左上,绘柄_左中,绘柄_左下,绘柄_中上,绘柄_中中,绘柄_中下,绘柄_右上,绘柄_右中,绘柄_右下,暗转_左上,暗转_左中,暗转_左下,暗转_中上,暗转_中中,暗转_中下,暗转_右上,暗转_右中,暗转_右下)
				DRAWLINE
				PRINTL 
				PRINTFORML 所持筹码 {MONEY:2} 筹码差枚 {MONEY:2-初期所持筹码}
				PRINTFORML 回转数 {总回转数}G 距离上次的大奖{上次当选的旋转数}G
				PRINTL  
				PRINTL  
				PRINTFORML [1] - 停止转动
				;リール回转
				IF オートモード == 1 && 总回转数 < 検定回数
					PRINTL 
					RESULT = 1
				ELSE
					INPUT
				ENDIF
				CLEARLINE 削除行数
				
				;=============================
				;中绘柄决定
				;=============================
				绘柄_中上 = MEL
				绘柄_中中 = BL7
				绘柄_中下 = REP
				暗转_中上 = 1
				暗转_中中 = 0
				暗转_中下 = 1
				;=============================
				;回转最中のスロット表示
				;=============================
				CALL SLOT_情报パネル表示(情报パネル表示页,总回转数,上次当选的旋转数,累计短周期连セット数,当选履历,当选种类履历,当选枚数履历,小役カウンタ)
				CALL SLOT_全体表示(色_框,绘柄_左上,绘柄_左中,绘柄_左下,绘柄_中上,绘柄_中中,绘柄_中下,绘柄_右上,绘柄_右中,绘柄_右下,暗转_左上,暗转_左中,暗转_左下,暗转_中上,暗转_中中,暗转_中下,暗转_右上,暗转_右中,暗转_右下)
				DRAWLINE
				PRINTL 
				PRINTFORML 所持筹码 {MONEY:2} 筹码差枚 {MONEY:2-初期所持筹码}
				PRINTFORML 回转数 {总回转数}G 距离上次的大奖{上次当选的旋转数}G
				PRINTL  
				PRINTL  
				PRINTFORML [1] - 停止转动
				;リール回转
				IF オートモード == 1 && 总回转数 < 検定回数
					PRINTL 
					RESULT = 1
				ELSE
					INPUT
				ENDIF
				CLEARLINE 削除行数
				
				;=============================
				;右绘柄决定
				;=============================
				绘柄_右上 = BEL
				绘柄_右中 = BL7
				绘柄_右下 = MEL
				暗转_右上 = 1
				暗转_右中 = 0
				暗转_右下 = 1
				;=============================
				;回转最中のスロット表示
				;=============================
				;CALL SLOT_全体表示(色_框,绘柄_左上,绘柄_左中,绘柄_左下,绘柄_中上,绘柄_中中,绘柄_中下,绘柄_右上,绘柄_右中,绘柄_右下,暗转_左上,暗转_左中,暗转_左下,暗转_中上,暗转_中中,暗转_中下,暗转_右上,暗转_右中,暗转_右下)
				
				;十六夜BB当选
				当选的小役 = 1
				
				;=============================
				;筹码の获得
				;=============================
				CALL 小役支付戻し(当选的小役)
			;合计1/6で斯卡雷特BB(400)
			ELSE
$斯卡雷特BB
				;=============================
				;当选したBB种类に0(斯卡雷特BB)を代入
				;=============================
				当选したBB种类 = 0
				
				;=============================
				;左绘柄决定
				;=============================
				绘柄_左上 = REP
				绘柄_左中 = RD7
				绘柄_左下 = CHE
				暗转_左上 = 1
				暗转_左中 = 0
				暗转_左下 = 1
				;=============================
				;回转最中のスロット表示
				;=============================
				CALL SLOT_情报パネル表示(情报パネル表示页,总回转数,上次当选的旋转数,累计短周期连セット数,当选履历,当选种类履历,当选枚数履历,小役カウンタ)
				CALL SLOT_全体表示(色_框,绘柄_左上,绘柄_左中,绘柄_左下,绘柄_中上,绘柄_中中,绘柄_中下,绘柄_右上,绘柄_右中,绘柄_右下,暗转_左上,暗转_左中,暗转_左下,暗转_中上,暗转_中中,暗转_中下,暗转_右上,暗转_右中,暗转_右下)
				DRAWLINE
				PRINTL 
				PRINTFORML 所持筹码 {MONEY:2} 筹码差枚 {MONEY:2-初期所持筹码}
				PRINTFORML 回转数 {总回转数}G 距离上次的大奖{上次当选的旋转数}G
				PRINTL  
				PRINTL  
				PRINTFORML [1] - 停止转动
				;リール回转
				IF オートモード == 1 && 总回转数 < 検定回数
					PRINTL 
					RESULT = 1
				ELSE
					INPUT
				ENDIF
				CLEARLINE 削除行数
				
				;=============================
				;中绘柄决定
				;=============================
				绘柄_中上 = CHE
				绘柄_中中 = RD7
				绘柄_中下 = CHE
				暗转_中上 = 1
				暗转_中中 = 0
				暗转_中下 = 1
				;=============================
				;回转最中のスロット表示
				;=============================
				CALL SLOT_情报パネル表示(情报パネル表示页,总回转数,上次当选的旋转数,累计短周期连セット数,当选履历,当选种类履历,当选枚数履历,小役カウンタ)
				CALL SLOT_全体表示(色_框,绘柄_左上,绘柄_左中,绘柄_左下,绘柄_中上,绘柄_中中,绘柄_中下,绘柄_右上,绘柄_右中,绘柄_右下,暗转_左上,暗转_左中,暗转_左下,暗转_中上,暗转_中中,暗转_中下,暗转_右上,暗转_右中,暗转_右下)
				DRAWLINE
				PRINTL 
				PRINTFORML 所持筹码 {MONEY:2} 筹码差枚 {MONEY:2-初期所持筹码}
				PRINTFORML 回转数 {总回转数}G 距离上次的大奖{上次当选的旋转数}G
				PRINTL  
				PRINTL  
				PRINTFORML [1] - 停止转动
				;リール回转
				IF オートモード == 1 && 总回转数 < 検定回数
					PRINTL 
					RESULT = 1
				ELSE
					INPUT
				ENDIF
				CLEARLINE 削除行数
				
				;=============================
				;右绘柄决定
				;=============================
				绘柄_右上 = BEL
				绘柄_右中 = RD7
				绘柄_右下 = MEL
				暗转_右上 = 1
				暗转_右中 = 0
				暗转_右下 = 1
				;=============================
				;回转最中のスロット表示
				;=============================
				;CALL SLOT_全体表示(色_框,绘柄_左上,绘柄_左中,绘柄_左下,绘柄_中上,绘柄_中中,绘柄_中下,绘柄_右上,绘柄_右中,绘柄_右下,暗转_左上,暗转_左中,暗转_左下,暗转_中上,暗转_中中,暗转_中下,暗转_右上,暗转_右中,暗转_右下)
				
				;=============================
				;中段樱桃から直接ここへ来た场合の处理
				;=============================
				IF 当选的小役 == 当选小役_中樱桃
					内部状态 = 4
					;短周期连セット数の初期化
					短周期连セット数 = 1
					短周期连开始时所持筹码 = MONEY:2
					短周期连继续率 = 90
					SIF !RAND(10)
						短周期连继续率 = 95
				ENDIF
				
				
				
				;斯卡雷特BB当选
				当选的小役 = 0
				
				;=============================
				;筹码の获得
				;=============================
				CALL 小役支付戻し(当选的小役)
			ENDIF
		;合计1/2でREG(100)
		ELSE
$REG
			;=============================
			;当选したBB种类に2(REG)を代入
			;=============================
			当选したBB种类 = 2
			;=============================
			;左绘柄决定
			;=============================
			绘柄_左上 = REP
			绘柄_左中 = RD7
			绘柄_左下 = CHE
			暗转_左上 = 1
			暗转_左中 = 0
			暗转_左下 = 1
			;=============================
			;回转最中のスロット表示
			;=============================
			CALL SLOT_情报パネル表示(情报パネル表示页,总回转数,上次当选的旋转数,累计短周期连セット数,当选履历,当选种类履历,当选枚数履历,小役カウンタ)
			CALL SLOT_全体表示(色_框,绘柄_左上,绘柄_左中,绘柄_左下,绘柄_中上,绘柄_中中,绘柄_中下,绘柄_右上,绘柄_右中,绘柄_右下,暗转_左上,暗转_左中,暗转_左下,暗转_中上,暗转_中中,暗转_中下,暗转_右上,暗转_右中,暗转_右下)
			DRAWLINE
			PRINTL 
			PRINTFORML 所持筹码 {MONEY:2} 筹码差枚 {MONEY:2-初期所持筹码}
			PRINTFORML 回转数 {总回转数}G 距离上次的大奖{上次当选的旋转数}G
			PRINTL  
			PRINTL  
			PRINTFORML [1] - 停止转动
			;リール回转
			IF オートモード == 1 && 总回转数 < 検定回数
				PRINTL 
				RESULT = 1
			ELSE
				INPUT
			ENDIF
			CLEARLINE 削除行数
			
			;=============================
			;中绘柄决定
			;=============================
			绘柄_中上 = CHE
			绘柄_中中 = RD7
			绘柄_中下 = CHE
			暗转_中上 = 1
			暗转_中中 = 0
			暗转_中下 = 1
			;=============================
			;回转最中のスロット表示
			;=============================
			CALL SLOT_情报パネル表示(情报パネル表示页,总回转数,上次当选的旋转数,累计短周期连セット数,当选履历,当选种类履历,当选枚数履历,小役カウンタ)
			CALL SLOT_全体表示(色_框,绘柄_左上,绘柄_左中,绘柄_左下,绘柄_中上,绘柄_中中,绘柄_中下,绘柄_右上,绘柄_右中,绘柄_右下,暗转_左上,暗转_左中,暗转_左下,暗转_中上,暗转_中中,暗转_中下,暗转_右上,暗转_右中,暗转_右下)
			DRAWLINE
			PRINTL 
			PRINTFORML 所持筹码 {MONEY:2} 筹码差枚 {MONEY:2-初期所持筹码}
			PRINTFORML 回转数 {总回转数}G 距离上次的大奖{上次当选的旋转数}G
			PRINTL  
			PRINTL  
			PRINTFORML [1] - 停止转动
			;リール回转
			IF オートモード == 1 && 总回转数 < 検定回数
				PRINTL 
				RESULT = 1
			ELSE
				INPUT
			ENDIF
			CLEARLINE 削除行数
			
			;=============================
			;右绘柄决定
			;=============================
			绘柄_右上 = BEL
			绘柄_右中 = B_A_R
			绘柄_右下 = MEL
			暗转_右上 = 1
			暗转_右中 = 0
			暗转_右下 = 1
			;=============================
			;回转最中のスロット表示
			;=============================
			;CALL SLOT_全体表示(色_框,绘柄_左上,绘柄_左中,绘柄_左下,绘柄_中上,绘柄_中中,绘柄_中下,绘柄_右上,绘柄_右中,绘柄_右下,暗转_左上,暗转_左中,暗转_左下,暗转_中上,暗转_中中,暗转_中下,暗转_右上,暗转_右中,暗转_右下)
			
			;REG当选
			当选的小役 = 2
			
			;=============================
			;筹码の获得
			;=============================
			CALL 小役支付戻し(当选的小役)
		ENDIF
		
		;=============================
		;小役カウンタ
		;=============================
		小役カウンタ:当选的小役 ++
		
		FOR LOCAL,0,10
			SIF 当选种类履历:(9-LOCAL) == -1
				CONTINUE
			当选种类履历:(10-LOCAL) = 当选种类履历:(9-LOCAL)
			当选履历:(10-LOCAL) = 当选履历:(9-LOCAL)
			当选枚数履历:(10-LOCAL) = 当选枚数履历:(9-LOCAL)
		NEXT
		
		SIF 内部状态 == 4
			累计短周期连セット数 ++
		当选种类履历:0 = 当选的小役
		当选履历:0 = 上次当选的旋转数
		IF 内部状态 == 4
			当选枚数履历:0 = MONEY:2 - 短周期连开始时所持筹码
		ELSE
			SELECTCASE 当选的小役
			CASE 当选小役_赤7BOUNS
				当选枚数履历:0 = 400
			CASE 当选小役_青7BOUNS
				当选枚数履历:0 = 200
			CASE 当选小役_レギュラーBOUNS
				当选枚数履历:0 = 100
			CASEELSE
			ENDSELECT
		ENDIF
		;=============================
		;各种情报の初期化
		;=============================
		上次当选的旋转数 = 0
		GOTO INPUT_LOOP
	ENDIF
	;=============================
	;BB当选时の记述ここまで
	;=============================
	
	;=============================
	;子役抽选
	;=============================
	当选的小役 = 小役抽选(内部状态)
	
	CALL スロット绘柄决定(当选的小役,绘柄_左上,绘柄_左中,绘柄_左下,绘柄_中上,绘柄_中中,绘柄_中下,绘柄_右上,绘柄_右中,绘柄_右下)
	
	
	;=============================
	;回转最中のスロット表示(左停止)
	;=============================
	CALL SLOT_情报パネル表示(情报パネル表示页,总回转数,上次当选的旋转数,累计短周期连セット数,当选履历,当选种类履历,当选枚数履历,小役カウンタ)
	;中リール右リールには「_回转中」が付いた变量を入れる
	CALL SLOT_全体表示(色_框,绘柄_左上,绘柄_左中,绘柄_左下,绘柄_中上_回转中,绘柄_中中_回转中,绘柄_中下_回转中,绘柄_右上_回转中,绘柄_右中_回转中,绘柄_右下_回转中,暗转_左上,暗转_左中,暗转_左下,暗转_中上_回转中,暗转_中中_回转中,暗转_中下_回转中,暗转_右上_回转中,暗转_右中_回转中,暗转_右下_回转中)
	DRAWLINE
	PRINTL 
	PRINTFORML 所持筹码 {MONEY:2} 筹码差枚 {MONEY:2-初期所持筹码}
	PRINTFORML 回转数 {总回转数}G 距离上次的大奖{上次当选的旋转数}G
	PRINTL  
	PRINTL  
	PRINTL  
	
	;左リールが通常と违う场合更に1秒间停止させる(目押し感の演出)
	SIF 绘柄_左上 != BEL
		TWAIT 1000,0
	;0.1秒间停止させる
	TWAIT 100,0
	;以下、コメントアウト
	;PRINTFORML [1] - 停止转动
	;リール回转
	;INPUT
	;CLEARLINE 削除行数
	
	CLEARLINE 削除行数 - 1
	
	;=============================
	;回转最中のスロット表示(中停止)
	;=============================
	CALL SLOT_情报パネル表示(情报パネル表示页,总回转数,上次当选的旋转数,累计短周期连セット数,当选履历,当选种类履历,当选枚数履历,小役カウンタ)
	;右リールには「_回转中」が付いた变量を入れる
	CALL SLOT_全体表示(色_框,绘柄_左上,绘柄_左中,绘柄_左下,绘柄_中上,绘柄_中中,绘柄_中下,绘柄_右上_回转中,绘柄_右下_回转中,绘柄_右下_回转中,暗转_左上,暗转_左中,暗转_左下,暗转_中上,暗转_中中,暗转_中下,暗转_右上_回转中,暗转_右中_回转中,暗转_右下_回转中)
	DRAWLINE
	PRINTL 
	PRINTFORML 所持筹码 {MONEY:2} 筹码差枚 {MONEY:2-初期所持筹码}
	PRINTFORML 回转数 {总回转数}G 距离上次的大奖{上次当选的旋转数}G
	PRINTL  
	PRINTL  
	PRINTL  
	
	;左リールが通常と违う场合更に1秒间停止させる(目押し感の演出)
	;左リール西瓜滑りからの中段ベルが存在するので「绘柄_中中 != BEL」が追加
	SIF 绘柄_左上 != BEL && 绘柄_中中 != BEL
		TWAIT 1000,0
	;0.1秒间停止させる
	TWAIT 100,0
	;以下、コメントアウト
	;PRINTFORML [1] - 停止转动
	;リール回转
	;INPUT
	;CLEARLINE 削除行数
	
	CLEARLINE 削除行数 - 1
	
	CALL 暗转设定(当选的小役,暗转_左上,暗转_左中,暗转_左下,暗转_中上,暗转_中中,暗转_中下,暗转_右上,暗转_右中,暗转_右下)
	
	;=============================
	;小役カウンタ
	;=============================
	小役カウンタ:当选的小役 ++
	;=============================
	;筹码支付戻し
	;=============================
	CALL 小役支付戻し(当选的小役)
	
	
	
	;=============================================================
	;全停止后のリール表示はINPUT_LOOPにループしたあと206行目で行う
	;=============================================================
	GOTO INPUT_LOOP

ELSEIF RESULT == 2
	情报パネル表示页 ++
	情报パネル表示页 %= 2
	CLEARLINE 削除行数
	小役抽选不会 = 1
	GOTO INPUT_LOOP
ELSEIF RESULT == 0
ELSE
	CLEARLINE 1
	REUSELASTLINE 无效な数字
	GOTO INPUT_LOOP
ENDIF
$GAME_END
;筹码会员用のカモられ指数を上升
;回放は in 0なのでそれを引いた（ゲーム数 * 3）が投入筹码
投入筹码 = (总回转数 - 小役カウンタ:当选小役_回放) * 3
CALL CASINO_MONEY("カモ", 投入筹码)
