;日记口上

;一日の结束时の流れ
;@DIARY_TEXT_K111（日记本文）→@DIARY_AFTER_CHECK_K111（フラグの处理）


;◆日记の仕样◆
;※１@DIARY_BEFORE_CHECK_K111で日记のフラグが立つ。
;→未读フラグ(2)が立っていると一日の终わりにデイリーイベントとして日记が读まれる（既读になる）。
;→※２未读フラグ(3)が立っていると[日记を读む]で读む事ができる。读むと既读(1)になる。
;※１各所イベント口上や指令口上でフラグを立たせても良いです。
;※２基本的には未读(2)推奖です。既读(1)、未读(3)はワンステップ必要。

;[日记を读む]には、持ち主が[恋慕]なら自由に读むことができ、
;そうでない场合は恋慕でない人物がその场に居ない时、もしくは时间停止することで盗み读みできる。
;据点住民でない角色は恋慕で那个ば自宅（待客室）で读むことができる。

;MAX_DIARY_PAGE:XX:0　角色番号XX的日记の最大页数　限度は101（1～100）
;DIARY:XX:YY　　　　　角色番号XX的日记番号YYの情报
;　　 3=未读　　　　　デイリーイベントで读まれない。[日记を读む]で读むと既读になる。
;　　 2=未读　　　　　デイリーイベントで读まれる。读まれるまでは[日记を读む]では读めない。读まれると既读になる。
;　　 1=既读　　　　　デイリーイベントで读まれない。[日记を读む]で读める。
;　　 0=读めない　　　未解禁。
;PAGESET:XX:YY　　　　角色番号XXの实际に书かれたYY页目的日记番号。
;=============================
@DIARY_K111_EXIST
;存在判定
;0だと日记は书かれません。
;=============================
RETURN 1

;=============================
@DIARY_AFTER_CHECK_K111
;デイリーイベントで日记が读まれた际の后处理。
;フラグの管理等自由に扱って良い。

;条件フラグのリセットや判定追加もここに 
;たとえば：今日构ったフラグ
;今日构った日记が表示した后、构ったフラグをリセット。
; CFLAG:XX:今日构ったフラグ = 0
;あるいは何かの状态が续くことがフラグの场合
;例：好感度がほぼ变わらない日が续くと
;「你」の态度が冷な～みたいな日记を书く
; SIF CFLAG:XX:好感度 <= LAST_LP+3
;   NOTOUCH_DAY ++
;=============================


;=============================
@DIARY_BEFORE_CHECK_K111
;常时チェックされる日记の状态情报。
;ここでDIARY:XX:YYの更新を行う。
;※DIARY:XX:0番は使えません。

;ここで泛用发生条件を记入する
;指令别の发生条件はM_KOJOの各ファイル中で追加してください。

;基本的に发生条件には"DIARY:XX:YY == 0"を入れること。
;そうしないと同じ日记が书かれたりしてしまう。

;DIARY:XX:YY　　　　角色番号XX的日记番号YYの情报
;　　 3=未读　　　　デイリーイベントで读まれない。[日记を读む]で读むと既读になる。
;　　 2=未读　　　　デイリーイベントで读まれる。读まれるまでは[日记を读む]では读めない。读まれると既读になる。
;　　 1=既读　　　　デイリーイベントで读まれない。[日记を读む]で读める。
;　　 0=读めない　　未解禁。

;○未读(2)にする场合（基本）
;未读(2)にするとデイリーイベントとして发生し、一日の终わりに１つだけ读まれる。
;复数の页が未读(2)になっている场合は番号が小さいものが读まれ、それ以外はリセット(0)される。
;その为、复数同时に发生すると、发生したのに读まれずリセットされる场合もある。
;未读(2)にするには单纯にフラグに2を入れるだけで良い。

;例１)初对面
;SIF DIARY:XX:YY == 0 && CFLAG:XX:认识
;	DIARY:XX:YY = 2

;○未读(3)にする场合（应用）
;未读(3)にするとデイリーイベントとして读まれず、书かれた时点で[日记を读む]によって读めるようになる。
;プレイヤーが自主的に读まない限り读まれず、一日に复数页追加される场合もある。
;未读(3)にするにはフラグに3を入れた上で、CALL CHARA_DIARY_PAGESETTING(XX, YY)をする必要がある。

;例２）好感度100以上
;IF DIARY:XX:YY == 0 && CFLAG:XX:好感度 >= 100
;	DIARY:XX:YY = 3
;	CALL CHARA_DIARY_PAGESETTING(XX, YY)
;ENDIF

;例３）例２的日记が读まれた上で好感度1000以上
;これをするとYYを读んだ直后にZZが书き込まれることも起こる。
;IF DIARY:XX:ZZ == 0 && DIARY:XX:YY == 1 && CFLAG:XX:好感度 >= 1000
;	DIARY:XX:ZZ = 3
;	CALL CHARA_DIARY_PAGESETTING(XX, ZZ)
;ENDIF

;▽おせっかいな注釈
;初吻は基本的に全员[无接吻经验]を所持しているので、"!TALENT:XX:无接吻经验"で判定できます。
;约会归りの接吻で分岐したいなら约会归りの接吻口上でフラグを立てます。
;その场合、通常の初吻丧失と重复不会うに气をつけましょう。
;处女丧失は初期设定で处女丧失している场合もあるので、处女丧失口上の方でフラグを立てた方が良いです。
;其他告白・陷落等のイベントは各种イベント口上でフラグを立てます。初对面はそっちでも大丈夫です。
;日期を正确に测るには别途フラグが必要です。例えば初めて会った日とか。
;=============================
SIF CHARANUM <= [[克劳恩皮丝]] + 1
	RETURN
;MAXPAGEはここで记入する
MAX_DIARY_PAGE:[[克劳恩皮丝]]:0 = 100

;以下、胜手な设定
;原作や书籍の话混ぜたかったけど、TWの设定と龃龉があるのでやめました。
;というか克劳恩皮丝は日记书かなそう。
;书いても绝对适当。というわけで适当な日记成为了。
;颜文字とか使おうと思ったけど、逆におっさんすぎるのでこれもやめ。
;句读点が无いのは仕样です。

;初期设定
CALL M_KOJO_DIARYSETTING_K111(1)
CALL M_KOJO_DIARYSETTING_K111(2)
CALL M_KOJO_DIARYSETTING_K111(3)
CALL M_KOJO_DIARYSETTING_K111(4)

;泛用
SIF TALENT:[[桑尼]]:无知 && !TALENT:[[克劳恩皮丝]]:无知 && ABL:[[克劳恩皮丝]]:亲密 >= 4 && ABL:[[桑尼]]:亲密 >= 4
	CALL M_KOJO_DIARYSETTING_K111(5)
SIF ABL:[[克劳恩皮丝]]:亲密 >= 3 && ABL:[[斯塔]]:亲密 >= 3
	CALL M_KOJO_DIARYSETTING_K111(6)
SIF ABL:[[克劳恩皮丝]]:亲密 >= 5 && ABL:[[露娜]]:亲密 >= 5
	CALL M_KOJO_DIARYSETTING_K111(7)
SIF ABL:[[克劳恩皮丝]]:亲密 >= 6 && ABL:[[拉尔瓦]]:亲密 >= 6
	CALL M_KOJO_DIARYSETTING_K111(8)
SIF ABL:[[克劳恩皮丝]]:亲密 >= 2 && ABL:[[拉尔瓦]]:亲密 >= 2
	CALL M_KOJO_DIARYSETTING_K111(9)
SIF ABL:[[克劳恩皮丝]]:亲密 >= 4 && ABL:[[大妖精]]:亲密 >= 4
	CALL M_KOJO_DIARYSETTING_K111(10)
SIF TALENT:[[克劳恩皮丝]]:心情 < 0 && ABL:[[克劳恩皮丝]]:亲密 >= 3
	CALL M_KOJO_DIARYSETTING_K111(11)
SIF ABL:[[克劳恩皮丝]]:亲密 >= 3 && ABL:[[赫卡提亚]]:亲密 >= 3
	CALL M_KOJO_DIARYSETTING_K111(12)
SIF ABL:[[克劳恩皮丝]]:亲密 >= 6 && ABL:[[赫卡提亚]]:亲密 >= 6 && DAY >= 90
	CALL M_KOJO_DIARYSETTING_K111(13)
SIF ABL:[[克劳恩皮丝]]:亲密 >= 5 && ABL:[[纯狐]]:亲密 >= 5
	CALL M_KOJO_DIARYSETTING_K111(14)
SIF DAY >= 123
	CALL M_KOJO_DIARYSETTING_K111(15)

;イベント系
SIF TALENT:[[克劳恩皮丝]]:思慕
	CALL M_KOJO_DIARYSETTING_K111(16)
SIF TALENT:[[克劳恩皮丝]]:恋慕
	CALL M_KOJO_DIARYSETTING_K111(17)
SIF !FIRSTTIME("初吻", 1, [[克劳恩皮丝]])
	CALL M_KOJO_DIARYSETTING_K111(18)
SIF GETBIT(CFLAG:[[克劳恩皮丝]]:既成事实, 1)
	CALL M_KOJO_DIARYSETTING_K111(19)
SIF CFLAG:[[克劳恩皮丝]]:允许无套 > 0 && TALENT:[[克劳恩皮丝]]:恋慕
	CALL M_KOJO_DIARYSETTING_K111(20)
;21:＠汉堡
IF GET_GIFTDATA(TCVAR:[[克劳恩皮丝]]:今天的礼物, "本体") == 154 && GET_GIFTDATA(TCVAR:[[克劳恩皮丝]]:今天的礼物, "得点") > 400
	IF TALENT:[[克劳恩皮丝]]:恋慕
		CALL M_KOJO_DIARYSETTING_K111(23)
	ELSE
		CALL M_KOJO_DIARYSETTING_K111(22)
	ENDIF
ENDIF
;=============================
@DIARY_TEXT_K111, PAGENUM, MODE, PAGECOUNT
;日记の内容
;PAGENUM   = 日记番号（日记のパターン）
;MODE      = "デイリー":一日结束时のデイリーイベントでの读み上げ
;          = "指令":[日记を读む]指令での读み上げ
;PAGECOUNT = 何页目に书かれているか
;=============================
#DIM PAGENUM
#DIMS MODE
#DIM PAGECOUNT

;口上色指定あるならコメントアウトを外す
CALL M_KOJO_COLOR_K111

;グループマッチに日记のIDを入れて、表示させたい颜绘を表示する
;表情・服装・特殊画像をオプション指定で表示（省略可）
;书式は\resources\颜.CSVと下の例を参照

;以下はサンプル
IF MODE == "デイリー"
;	IF GROUPMATCH(PAGENUM, 1) 
;		CALL PRINT_FACE, XX, "发情", "裸", "_1"
;	ELSEIF GROUPMATCH(PAGENUM, 2)
;		CALL PRINT_FACE, XX, "笑颜", "服1"
;	ELSEIF GROUPMATCH(PAGENUM, 3)
;		CALL PRINT_FACE, XX, "愤怒"
;	ELSE
;		CALL PRINT_FACE, XX
;	ENDIF
ENDIF

PRINTFORMDL - 克劳恩皮丝的日记　PAGE.{PAGECOUNT} --------------------------------------------------------------------------------------
SELECTCASE PAGECOUNT
CASE 3
	PRINT 　／　／　　
CASEELSE
	CALL M_KOJO_K111_适当日期设定(PAGECOUNT)
	PRINT ／20XX
ENDSELECT
PRINTL 

;※PAGENUM:0は使えません
SELECTCASE PAGENUM
	CASE 1
		PRINTFORML 终于从主人大人那儿得到日记本啦！！
		PRINTFORML 要不要写写日记？虽然这么说，但日记都是用来干嘛的？！
		PRINTFORML 
		PRINTFORML 
		PRINTFORML 
	CASE 2
		PRINTFORMDL 画着涂鸦
		PRINTFORML 
		PRINTFORML 
		PRINTFORML 
		PRINTFORML 
	CASE 3
		PRINTFORMDL 什么都没写下
		PRINTFORML 
		PRINTFORML 
		PRINTFORML 
		PRINTFORML 
	CASE 4
		PRINTFORML 久违的拿出了笔记本
		PRINTFORML 这回一定要写点什么
		PRINTFORML 难得来到幻想乡，不记录些什么就回去也太可惜了
		PRINTFORML 
		PRINTFORML 
	CASE 5
		PRINTFORML 桑尼居然对H一点想法都没有！
		PRINTFORML 幻想乡的妖精真是……一群小屁孩！
		PRINTFORML 
		PRINTFORML 
		PRINTFORML 
	CASE 6
		PRINTFORML 斯塔这家伙虽说力气很小，鬼点子倒是多的很！
		PRINTFORML 和地狱里那帮家伙完全不同～☆
		PRINTFORML 
		PRINTFORML 
		PRINTFORML 
	CASE 7
		PRINTFORML 主人很喜欢露娜
		PRINTFORML 居然喜欢那种小不点？
		PRINTFORML 
		PRINTFORML 
		PRINTFORML 
	CASE 8
		PRINTFORML 叫拉尔夫的蝴蝶很能干！
		PRINTFORML 幻想乡里那样的家伙很少见☆
		PRINTFORML 
		PRINTFORML 
		PRINTFORML 
	CASE 9
		PRINTFORML ☆★琪露诺是笨蛋★☆
		PRINTFORML 
		PRINTFORML 
		PRINTFORML 
		PRINTFORML 
	CASE 10
		PRINTFORML 幻想乡的妖精们实在弱的可怜啊！
		PRINTFORML 还想着要试试手呢，结果一个两个全哭着跑开了！
		PRINTFORML 
		PRINTFORML 
		PRINTFORML 
	CASE 11
		PRINTFORML 惹主人生气了
		PRINTFORML 对不起嘛
		PRINTFORML 
		PRINTFORML 
		PRINTFORML 
	CASE 12
		PRINTFORML 和主人一起吃了团子！！
		PRINTFORML 味道很不错！！
		PRINTFORML 
		PRINTFORML 
		PRINTFORML 
	CASE 13
		PRINTFORML 买了件新的洋服！！
		PRINTFORML 超保暖！！
		PRINTFORML 
		PRINTFORML 
		PRINTFORML 
	CASE 14
		PRINTFORML 和友人大人玩了！！
		PRINTFORML 真是非常非常开心啊%UNICODE(0x2764)%
		PRINTFORML 
		PRINTFORML 
		PRINTFORML 
	CASE 15
		PRINTFORML 到春天了哦～！！
		PRINTFORML 到了春天就一定要这么说！
		PRINTFORML 是一个奇怪的妖精教给我的！
		PRINTFORML 
		PRINTFORML 
	CASE 16
		PRINTFORML 和%CALLNAME:MASTER%玩得很开心！
		PRINTFORML 明明只是人类没想到那么有趣！
		PRINTFORML 下次再找他玩吧！
		PRINTFORML 
		PRINTFORML 
	CASE 17
		PRINTFORMDL 画着 %CALLNAME:MASTER%的肖像
		PRINTFORML 
		PRINTFORML 
		PRINTFORML 
		PRINTFORML %CALLNAME:MASTER%%UNICODE(0x2764)%
	CASE 18
		PRINTFORML 和%CALLNAME:MASTER%kiss了！！！！
		PRINTFORML 这样一来我也成为大人了吧！！！！
		PRINTFORML 
		PRINTFORML 
		PRINTFORML 
	CASE 19
		PRINTFORML 把第一次H献给了%CALLNAME:MASTER%%UNICODE(0x2764)%
		PRINTFORML 虽说很舒服，但刚开始看到欧金金的样子实在被吓到了！
		PRINTFORML 明天也还想再做啊～☆
		PRINTFORML 
		PRINTFORML 
	CASE 20
		PRINTFORML 和%CALLNAME:MASTER%爱爱了%UNICODE(0x2764)%
		PRINTFORML 又被他灌的子宫里像燃烧一样躁动着！
		PRINTFORML 天天这样做的话，怀上宝宝也只是时间问题吧～%UNICODE(0x2764)%
		PRINTFORML 
		PRINTFORML 
	CASE 21
		PRINTFORML %CALLNAME:MASTER%教我做了汉堡！
		PRINTFORML 汉堡是在厨房做的啊～
		PRINTFORML 
		PRINTFORML 
		PRINTFORML 
	CASE 22
		PRINTFORMDL 贴着克劳恩皮斯制作的贴纸
		PRINTFORML 
		PRINTFORML 
		PRINTFORML 
		PRINTFORML 
	CASE 23
		PRINTFORMDL 贴着克劳恩皮斯制作的贴纸
		PRINTFORML 
		PRINTFORML 
		PRINTFORML 
		PRINTFORML 
		PRINTFORML 喜欢%CALLNAME:MASTER%%UNICODE(0x2764)%
ENDSELECT

RESETCOLOR

;=============================
@M_KOJO_MESSAGE_COM_K111_406
;=============================
CALL M_KOJO_MESSAGE_COM_K111_406_1
RETURN RESULT

;=============================
@M_KOJO_MESSAGE_COM_K111_406_1
;指令口上
;TFLAG:194（谁的日记を读んでいるか）
;TFLAG:194がXXでない场合は他人的日记なので注意。
;PAGEは书かれてある页数。
;SHIRAHU(XX)は角色XXの状态が正常かどうか。
;=============================

CALL M_KOJO_COLOR_K111
IF SHIRAHU([[克劳恩皮丝]]) && TFLAG:194 == [[克劳恩皮丝]]
	PRINTFORMW 「怎么样？ 有趣吗？？」
ENDIF

;=============================
@M_KOJO_DIARYSETTING_K111(ARG)
;日记发生处理の批量管理函数
;=============================
SELECTCASE ARG
	;不一致なら何度でも发生（やりすぎるとバグるかも）
	CASE 22, 23
		SIF TCVAR:[[克劳恩皮丝]]:今天的礼物 == CFLAG:[[克劳恩皮丝]]:1004
			RETURN
		CFLAG:[[克劳恩皮丝]]:1004 = TCVAR:[[克劳恩皮丝]]:今天的礼物
	CASEELSE
		SIF DIARY:[[克劳恩皮丝]]:ARG != 0
			RETURN
ENDSELECT
DIARY:[[克劳恩皮丝]]:ARG = 3
CALL CHARA_DIARY_PAGESETTING([[克劳恩皮丝]], ARG)

;=============================
@M_KOJO_K111_适当日期设定(ARG)
;日记用に作った随意日期を付ける函数
;=============================
SELECTCASE ARG % 12
CASE 1, 2, 3
	PRINT ○／
CASE 4, 5, 6
	PRINT ☆／
CASE 7, 8, 9
	PRINT ★／
CASEELSE
	PRINT ●／
ENDSELECT
SELECTCASE ARG % 10
CASE 1
	PRINT ×
CASE 2
	PRINT ☆
CASE 3
	PRINT ●
CASE 4
	PRINT ◇
CASE 5
	PRINT ★
CASE 6
	PRINT ◎
CASE 7
	PRINT ＋
CASE 8
	PRINT ◆
CASE 9
	PRINT ○
CASE 0
	PRINT ★
ENDSELECT
