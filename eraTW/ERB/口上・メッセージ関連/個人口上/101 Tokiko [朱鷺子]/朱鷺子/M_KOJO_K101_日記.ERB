;日记口上
;テンプレ的日记口上と小铃口上を参考にして顶きました。それに倣って设定とかを书きます


;朱鹭子さんは读书好きだけど书くのはそんなに……ってタイプ
;あと知识はともかく自头は若干缓い印象があるのでたまに硬い文体が崩れる


;一日の结束时の流れ
;@DIARY_TEXT_K101（日记本文）→@DIARY_AFTER_CHECK_K101（フラグの处理）


;◆日记の仕样◆
;※１@DIARY_BEFORE_CHECK_KXで日记のフラグが立つ。
;→未读フラグ(2)が立っていると一日の终わりにデイリーイベントとして日记が读まれる（既读になる）。
;→※２未读フラグ(3)が立っていると[日记を读む]で读む事ができる。读むと既读(1)になる。
;※１各所イベント口上や指令口上でフラグを立たせても良いです。
;※２基本的には未读(2)推奖です。既读(1)、未读(3)はワンステップ必要。

;[日记を读む]には、持ち主が[恋慕]なら自由に读むことができ、
;そうでない场合は恋慕でない人物がその场に居ない时、もしくは时间停止することで盗み读みできる。
;据点住民でない角色は恋慕で那个ば自宅（待客室）で读むことができる。

;MAX_DIARY_PAGE:XX:0　角色番号XX的日记の最大页数　限度は101（1～100）
;DIARY:XX:YY　　　　　角色番号XX的日记番号YYの情报
;　　 3=未读　　　　　デイリーイベントで读まれない。[日记を读む]で读むと既读になる。
;　　 2=未读　　　　　デイリーイベントで读まれる。读まれるまでは[日记を读む]では读めない。读まれると既读になる。
;　　 1=既读　　　　　デイリーイベントで读まれない。[日记を读む]で读める。
;　　 0=读めない　　　未解禁。
;PAGESET:XX:YY　　　　角色番号XXの实际に书かれたYY页目的日记番号。
;=============================
@DIARY_K101_EXIST
;存在判定
;0だと日记は书かれません。
;=============================
RETURN 1

;=============================
@DIARY_AFTER_CHECK_K101
;デイリーイベントで日记が读まれた际の后处理。
;フラグの管理等自由に扱って良い。

;条件フラグのリセットや判定追加もここに 
;たとえば：今日构ったフラグ
;今日构った日记が表示した后、构ったフラグをリセット。
; CFLAG:XX:今日构ったフラグ = 0
;あるいは何かの状态が续くことがフラグの场合
;例：好感度がほぼ变わらない日が续くと
;「你」の态度が冷な～みたいな日记を书く
; SIF CFLAG:XX:好感度 <= LAST_LP+3
;   NOTOUCH_DAY ++
;=============================


;=============================
@DIARY_BEFORE_CHECK_K101
;常时チェックされる日记の状态情报。
;ここでDIARY:XX:YYの更新を行う。
;※DIARY:XX:0番は使えません。

;ここで泛用发生条件を记入する
;指令别の发生条件はM_KOJOの各ファイル中で追加してください。

;基本的に发生条件には"DIARY:XX:YY == 0"を入れること。
;そうしないと同じ日记が书かれたりしてしまう。

;DIARY:XX:YY　　　　角色番号XX的日记番号YYの情报
;　　 3=未读　　　　デイリーイベントで读まれない。[日记を读む]で读むと既读になる。
;　　 2=未读　　　　デイリーイベントで读まれる。读まれるまでは[日记を读む]では读めない。读まれると既读になる。
;　　 1=既读　　　　デイリーイベントで读まれない。[日记を读む]で读める。
;　　 0=读めない　　未解禁。

;○未读(2)にする场合（基本）
;未读(2)にするとデイリーイベントとして发生し、一日の终わりに１つだけ读まれる。
;复数の页が未读(2)になっている场合は番号が小さいものが读まれ、それ以外はリセット(0)される。
;その为、复数同时に发生すると、发生したのに读まれずリセットされる场合もある。
;未读(2)にするには单纯にフラグに2を入れるだけで良い。

;例１)初对面
;SIF DIARY:XX:YY == 0 && CFLAG:XX:认识
;	DIARY:XX:YY = 2

;○未读(3)にする场合（应用）
;未读(3)にするとデイリーイベントとして读まれず、书かれた时点で[日记を读む]によって读めるようになる。
;プレイヤーが自主的に读まない限り读まれず、一日に复数页追加される场合もある。
;未读(3)にするにはフラグに3を入れた上で、CALL CHARA_DIARY_PAGESETTING(XX, YY)をする必要がある。

;例２）好感度100以上
;IF DIARY:XX:YY == 0 && CFLAG:XX:好感度 >= 100
;	DIARY:XX:YY = 3
;	CALL CHARA_DIARY_PAGESETTING(XX, YY)
;ENDIF

;例３）例２的日记が读まれた上で好感度1000以上
;これをするとYYを读んだ直后にZZが书き込まれることも起こる。
;IF DIARY:XX:ZZ == 0 && DIARY:XX:YY == 1 && CFLAG:XX:好感度 >= 1000
;	DIARY:XX:ZZ = 3
;	CALL CHARA_DIARY_PAGESETTING(XX, ZZ)
;ENDIF

;▽おせっかいな注釈
;初吻は基本的に全员[无接吻经验]を所持しているので、"!TALENT:XX:无接吻经验"で判定できます。
;约会归りの接吻で分岐したいなら约会归りの接吻口上でフラグを立てます。
;その场合、通常の初吻丧失と重复不会うに气をつけましょう。
;处女丧失は初期设定で处女丧失している场合もあるので、处女丧失口上の方でフラグを立てた方が良いです。
;其他告白・陷落等のイベントは各种イベント口上でフラグを立てます。初对面はそっちでも大丈夫です。
;日期を正确に测るには别途フラグが必要です。例えば初めて会った日とか。
;=============================
;MAXPAGEはここで记入する
MAX_DIARY_PAGE:101:0 = 100

;初对面
SIF CFLAG:101:认识
CALL CHARA_DIARY_PAGESETTING(1)


;好感度100
IF CFLAG:101:好感度 >= 100
	CALL CHARA_DIARY_PAGESETTING(2)
ENDIF

;好感度300
IF CFLAG:101:好感度 >= 300
	CALL CHARA_DIARY_PAGESETTING(3)
ENDIF

;好感度600
IF CFLAG:101:好感度 >= 600
	CALL CHARA_DIARY_PAGESETTING(4)
ENDIF

;好感度1000
IF CFLAG:101:好感度 >= 1000
	CALL CHARA_DIARY_PAGESETTING(5)
ENDIF

;思慕
IF TALENT:101:思慕
	CALL CHARA_DIARY_PAGESETTING(6)
ENDIF

;思慕+好感度2000
IF TALENT:101:思慕 && CFLAG:101:好感度 >= 2000
	CALL CHARA_DIARY_PAGESETTING(7)
ENDIF

;思慕+好感度2500
IF TALENT:101:思慕 && CFLAG:101:好感度 >= 2500
	CALL CHARA_DIARY_PAGESETTING(8)
ENDIF

;思慕+好感度2500+信赖度300
IF TALENT:101:思慕 && CFLAG:101:好感度 >= 2500 && CFLAG:101:信赖度 >= 300
	CALL CHARA_DIARY_PAGESETTING(9)
ENDIF

;恋慕
IF TALENT:101:恋慕
	CALL CHARA_DIARY_PAGESETTING(10)
ENDIF

;恋人
IF TALENT:101:恋人
	CALL CHARA_DIARY_PAGESETTING(11)
ENDIF

;初期から存在
CALL CHARA_DIARY_PAGESETTING(12)
CALL CHARA_DIARY_PAGESETTING(13)
CALL CHARA_DIARY_PAGESETTING(14)
CALL CHARA_DIARY_PAGESETTING(15)
CALL CHARA_DIARY_PAGESETTING(16)

;泛用(10日以降)
IF DAY >= 10 
CALL CHARA_DIARY_PAGESETTING(17)
CALL CHARA_DIARY_PAGESETTING(18)
CALL CHARA_DIARY_PAGESETTING(19)
ENDIF

;泛用(30日以降)
IF DAY >= 30 
CALL CHARA_DIARY_PAGESETTING(20)
CALL CHARA_DIARY_PAGESETTING(21)
CALL CHARA_DIARY_PAGESETTING(22)
ENDIF


;泛用(60日以降)
IF DAY >= 60
CALL CHARA_DIARY_PAGESETTING(23)
CALL CHARA_DIARY_PAGESETTING(24)
CALL CHARA_DIARY_PAGESETTING(25)
ENDIF

;泛用(100日以降)
IF DAY >= 100 
CALL CHARA_DIARY_PAGESETTING(26)
CALL CHARA_DIARY_PAGESETTING(27)
CALL CHARA_DIARY_PAGESETTING(28)
ENDIF

;泛用(150日以降)
IF DAY >= 150 
CALL CHARA_DIARY_PAGESETTING(29)
CALL CHARA_DIARY_PAGESETTING(30)
CALL CHARA_DIARY_PAGESETTING(31)
ENDIF

;好感度5000
IF CFLAG:101:好感度 >= 5000
	CALL CHARA_DIARY_PAGESETTING(95)
ENDIF

;好感度10000
IF CFLAG:101:好感度 >= 10000
	CALL CHARA_DIARY_PAGESETTING(96)
ENDIF

;好感度20000
IF CFLAG:101:好感度 >= 20000
	CALL CHARA_DIARY_PAGESETTING(97)
ENDIF

;好感度30000
IF CFLAG:101:好感度 >= 30000
	CALL CHARA_DIARY_PAGESETTING(98)
ENDIF

;好感度40000
IF CFLAG:101:好感度 >= 40000
	CALL CHARA_DIARY_PAGESETTING(99)
ENDIF

;好感度50000
IF CFLAG:101:好感度 >= 50000
	CALL CHARA_DIARY_PAGESETTING(100)
ENDIF
;=============================
@DIARY_TEXT_K101, PAGENUM, MODE, PAGECOUNT
;日记の内容
;PAGENUM   = 日记番号（日记のパターン）
;MODE      = "デイリー":一日结束时のデイリーイベントでの读み上げ
;          = "指令":[日记を读む]指令での读み上げ
;PAGECOUNT = 何页目に书かれているか
;=============================
#DIM PAGENUM
#DIMS MODE
#DIM PAGECOUNT

;口上色指定あるならコメントアウトを外す
;CALL M_KOJO_COLOR_KX

;グループマッチに日记のIDを入れて、表示させたい颜绘を表示する
;表情・服装・特殊画像をオプション指定で表示（省略可）
;书式は\resources\颜.CSVと下の例を参照

;以下はサンプル
;IF MODE == "デイリー"
;	IF GROUPMATCH(PAGENUM, 1) 
;		CALL PRINT_FACE, XX, "发情", "裸", "_1"
;	ELSEIF GROUPMATCH(PAGENUM, 2)
;		CALL PRINT_FACE, XX, "笑颜", "服1"
;	ELSEIF GROUPMATCH(PAGENUM, 3)
;		CALL PRINT_FACE, XX, "愤怒"
;	ELSE
;		CALL PRINT_FACE, XX
;	ENDIF
;ENDIF

PRINTFORMDL - 朱鹭子的日记　PAGE.{PAGECOUNT} --------------------------------------------------------------------------------------
PRINTL

;※PAGENUM:0は使えません
SELECTCASE PAGENUM
	CASE 1
		PRINTFORML 今天遇到了个没见过的人。
		PRINTFORML 问我说能不能称呼我为朱鹭子。
		PRINTFORML 奇怪的人。
	CASE 2
		PRINTFORML 最近、偶尔会跟那个人类谈话。
		PRINTFORML 奇怪的家伙还是称呼我为朱鹭子、虽然不讨厌。
		PRINTFORML 但被当成名称感觉还是很奇怪。
	CASE 3
		PRINTFORML 今天也和那个人类谈了。
		PRINTFORML 见几次面后有些稍微理解他的个性。
		PRINTFORML 应该不是坏人、但却感到一种奇妙的余裕……神秘的家伙。
	CASE 4
		PRINTFORML 比较熟识那个人类了。
		PRINTFORML 也蛮习惯被称呼为朱鹭子。
		PRINTFORML 下次见面时去聊些什么吧。
	CASE 5
		PRINTFORML 不知何时已经和那个人类关系不错了。
		PRINTFORML 一开始想说是奇怪的人、但跟他聊天却令人投入。
		PRINTFORML 也该好好记住他的名字了……。
	CASE 6
		PRINTFORML 那个人类的名字……%CALLNAME:MASTER%的名称真好。
		PRINTFORML 虽然如此、想着%CALLNAME:MASTER%的事时总有种不可思议的感觉。
		PRINTFORML ………跟一个奇怪的人打好关系是不是也很奇怪。
		PRINTFORML 不过我一点都不讨厌就是。
	CASE 7
		PRINTFORML 今天也见了%CALLNAME:MASTER%。
		PRINTFORML 果然和%CALLNAME:MASTER%聊天很开心。
		PRINTFORML 和读书差不多、或许还不止。
	CASE 8
		PRINTFORML 为何最近越来越常想着%CALLNAME:MASTER%的事情。
		PRINTFORML 越想胸口就更加燥热、怎么说呢………。
		PRINTFORML 这时候就在睡前读些书好冷静下来。
	CASE 9
		PRINTFORML ………无法专心看书。
		PRINTFORML 试图想要专注时又会想到%CALLNAME:MASTER%。
		PRINTFORML 我这是怎么了………。
	CASE 10
		PRINTFORML 我注意到了。
		PRINTFORML 不、其实在更早之前就意识到了。
		PRINTFORML 但我一直回避着不敢去注意这件事。
		PRINTFORML 所以我不能再逃避这个感情。
		PRINTFORML 我爱%CALLNAME:MASTER%。
		PRINTFORML 无可救药的喜欢。
		PRINTFORML 把日记的下一页空着。 …………成为恋人时在填上跳过的那页吧。
	CASE 11
		PRINTFORML 从没想到会有这么一天。
		PRINTFORML 跟%CALLNAME:MASTER%成为恋人了。
		PRINTFORML 写着日记的手还在震着。
		PRINTFORML 真的真的……越想着就越开心的不得了。
		PRINTFORML 谢谢、%CALLNAME:MASTER%。最喜欢、%CALLNAME:MASTER%。
		PRINTFORML 现在心里已经想不了其他的事。
		PRINTFORML 将来我的寿命还很久、但绝对不会忘记今天的事。
	CASE 12
		PRINTFORML 今天把人里的借书屋借来的书看完了。
		PRINTFORML 推理小说似乎不错、而读那本言情小说真令人害臊。
		PRINTFORML 之后要去借什么呢。
	CASE 13
		PRINTFORML 在整理房间的时候发现了一直找不到的书。
		PRINTFORML 脏兮兮的、更糟的是因为发霉已经不能读了。
	CASE 14
		PRINTFORML 散步的时候发现一个形状恰好的树桩。
		PRINTFORML 照来的阳光也暖呼呼地。
		PRINTFORML 下次试着带本书去。
	CASE 15
		PRINTFORML 随意逛逛的时候看到了偷书的巫女。
		PRINTFORML 试着用奇袭弹幕复仇时被打了回来。
		PRINTFORML 全身都疼。
	CASE 16
		PRINTFORML 今天读了一本从外界来写着"p rogram ming"相关的书。
		PRINTFORML 基本上理解不了内容、但看起来是类似式神的东西。
		PRINTFORML 反正都是与我无关的事物。
	CASE 17
		PRINTFORML 今天和竹林摊贩老板娘见面。
		PRINTFORML 被邀请去最近要开的演唱会。
		PRINTFORML 那天没预定的事、应该能去。
	CASE 18
		PRINTFORML 注意到借来的书还书日期是明天。
		PRINTFORML 有及时想到真是庆幸。
	CASE 19
		PRINTFORML 从人里的回程去间居酒屋吃顿饭。
		PRINTFORML 第一次去这家店、给人的感觉很不错。
		PRINTFORML 会再去看看。
	CASE 20
		PRINTFORML 去了鸟兽伎乐的演唱会。
		PRINTFORML 平时不看演唱会、但这场很好玩。
		PRINTFORML 下次再约还会去。
	CASE 21
		PRINTFORML 想写日记时笔坏了。
		PRINTFORML 所以买了只新的笔。
		PRINTFORML 用起来还不顺手、但之后总会习惯。
	CASE 22
		PRINTFORML 找到一本很有意思的书。
		PRINTFORML 真的有趣的书要好好带回家读。
		PRINTFORML 这是从之前被偷书的经验得来的教训。
	CASE 23
		PRINTFORML 试着整理房内累积的书。
		PRINTFORML 但时间都被花在读有趣的书让整理都没进展。
		PRINTFORML 明天再继续。
	CASE 24
		PRINTFORML 从空中看着弹幕游戏。
		PRINTFORML 我的弹幕完全是初见杀、可不适合胡乱的出手。
		PRINTFORML ………是否该考虑些正面弹幕。
	CASE 25
		PRINTFORML 今天散步时捡到奇怪的书。
		PRINTFORML 那恐怕是个妖魔书。
		PRINTFORMW 在出麻烦事前找地方把它丢了。
		PRINTFORML 
		PRINTFORML 追记：人里的借书屋的孩子似乎有本书很像那丢掉的妖魔书……。感觉像错觉。
	CASE 26
		PRINTFORML 开始写日记感觉也过好一段时间了。
		PRINTFORML 觉得自己有保持下去很好。
		PRINTFORML 那就持续到厌倦为止。
	CASE 27
		PRINTFORML 进行弹幕改良。
		PRINTFORML 感觉做得很不错、去试着挑战魔法之森的黑白看看。
		PRINTFORML 打不赢就跑吧。
	CASE 28
		PRINTFORML 又去了人里回程上的那间居酒屋。
		PRINTFORML 很好吃。
		PRINTFORML 若有事就再去。
	CASE 29
		PRINTFORML 对黑白复仇的挑战失败了。
		PRINTFORML 在逃跑时试着用了还不太成熟的符卡。
		PRINTFORML 还需要改良……。
	CASE 30
		PRINTFORML 去了竹林摊贩。
		PRINTFORML 和老板娘谈笑之间喝的有些醉。
		PRINTFORML 头很痛。
	CASE 31
		PRINTFORML 今天去了借书屋。
		PRINTFORML 不知为何借的都是言情小说、不过都蛮不错的。
		PRINTFORML 应该会在期限内再读几遍。
	CASE 95
		PRINTFORML 今天和%CALLNAME:MASTER%见面。
		PRINTFORML 感情方面以外的部分也很合得来。
		PRINTFORML 反正聊得很开心。我想大概就是喜欢这样子。
	CASE 96
		PRINTFORML 和%CALLNAME:MASTER%认识一段时间了。
		PRINTFORML …………比起过去的事、多想想将来的事会更好吧。
		PRINTFORML 希望能一直陪着%CALLNAME:MASTER%～。
	CASE 97
		PRINTFORML 我思念着%CALLNAME:MASTER%的感情停不住。
		PRINTFORML 老实说、本来以为喜欢的感情会安稳住。
		PRINTFORML 意外的。到现在还是持续增长着。
		PRINTFORML 喜欢到底能到什么地步呢。
	CASE 98
		PRINTFORML 写着%CALLNAME:MASTER%的页数越来越多了。
		PRINTFORML 现在读到前面写的『奇怪的人』真的很好笑。
		PRINTFORML 一直以来%CALLNAME:MASTER%都是奇怪的人。
		PRINTFORML 不一样的是我对%CALLNAME:MASTER%抱持的感情。
	CASE 99
		PRINTFORML 和%CALLNAME:MASTER%见面后的日子每天都很充实。
		PRINTFORML 尽管有些讨厌的事、但都能抛诸脑后。
		PRINTFORML 希望这种日子能继续下去。
		PRINTFORML ………这个日记也剩没几页了。差不多要再买一个了。
	CASE 100
		PRINTFORML 终于最后一页了。
		PRINTFORML 但没什么特别要写的事所以停下了笔。
		PRINTFORMW 虽然并没有意图要交给谁看、就以对%CALLNAME:MASTER%的感谢之情作为日记的结尾。
		PRINTFORMW 
		CALL PRINT_FACE, 101, "笑颜", "服"
		PRINTFORML 谢谢、%CALLNAME:MASTER%。我很开心能认识你。
		PRINTFORML 以后也多多指教！
ENDSELECT

RESETCOLOR

;=============================
@M_KOJO_MESSAGE_COM_K101_406
;=============================
CALL M_KOJO_MESSAGE_COM_K101_406_1
RETURN RESULT

;=============================
@M_KOJO_MESSAGE_COM_K101_406_1
;指令口上
;TFLAG:194（谁的日记を读んでいるか）
;TFLAG:194がXXでない场合は他人的日记なので注意。
;PAGEは书かれてある页数。
;SHIRAHU(XX)は角色XXの状态が正常かどうか。
;=============================
#DIM PAGE

;以下はサンプル
PAGE = 0
FOR LOCAL, 0, MAX_DIARY_PAGE:(TFLAG:194):0
	IF GROUPMATCH(DIARY:(TFLAG:194):LOCAL, 1, 3)
		PAGE ++
	ENDIF
NEXT

;IF SHIRAHU(XX) && TFLAG:194 == XX
;日记を读み终わった后の反应
;	IF PAGE > 2
;		CALL SPTALK, XX,"通常",0,@"「日记を见せるって…なんだか耻ずかしいな…」//%CALLNAME:XX%はまじまじとこちらを看了过来"
;		;画像つきトークは最大６行まで。
;	ELSE
;		PRINTFORML 
;	ENDIF
;ENDIF

;=============================
@M_KOJO_PAGESETTING(ARG)
;日记发生处理の批量管理函数
;=============================
SIF DIARY:[[朱鹭子]]:ARG != 0
	RETURN

	DIARY:[[朱鹭子]]:ARG = 3
CALL CHARA_DIARY_PAGESETTING([[朱鹭子]], ARG)