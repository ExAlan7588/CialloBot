;==================================================
;hate comment
;==================================================
@K15_HATE_COMMENT
#DIM iRoll
	;-------------------------------------------------
	;will never hate if love or is Remilia's lover
		;コメントアウト译：恋人かおぜう样の恋人なら嫌われない
			;以下、コメントアウト译は字下げして省略
	IF TALENT:恋慕 == 1 || K15_PLAYER_LOVER_REMILIA()
		;PRINTFORMDW %CALLNAME:15% looks angry at you.
		;PRINTFORMDW %CALLNAME:15%は心情不快そうにあなたを见ている。
			;「腹を立てているようだ」「怒っている」も微妙なんで「心情不快そうに见つめている」と译した 08/01/2023
		PRINTFORMDW %CALLNAME:15%对你怒目而视。
		RETURN 1
	ENDIF
	;-------------------------------------------------
	;special
	
	;Player is in Remilia's room while she sleeps and is not players bedroom
		;プレイヤーがレミリアが寝ている状态かつレミリアと私室を共有していない状态で发动
	IF K15_SAME_LOCATION_AS(16) && CFLAG:16:睡眠 && !K15_BED_ROOM(1)
		;PRINTFORMW 「I won't let you disturb the Mistress.」
		;PRINTFORMW 「お娘样の邪魔はさせませんわ」
			;「邪魔」じゃなくて「眠りの妨げ」の方がいいかも 08/01/2023
		PRINTFORMW 「我不会允许你打扰大小姐的。」
		CALL K15_KNIFEATTACK_SPELLCARD()
		RETURN 1
	ENDIF
	;-------------------------------------------------
	
	iRoll = 48 - 6 * MARK:反抗刻印
	
	;-------------------------------------------------
	;comment or attack
	;30
	SELECTCASE RAND:iRoll
		;-------------------------------------------------
		CASE 0,1,2
			;PRINTFORMDL You suddenly trip while walking.
			;PRINTFORMW 「Ara, so useless.」
			;PRINTFORMDL あなたが歩いていると突如として全裸になってしまった。
			;PRINTFORMW 「あら、ダメじゃないの。」
				;Ara!? 感叹词の输入とかあるんすねぇ＾～ 08/01/2023
			PRINTFORMDL 你在路上走着不知道被什么绊了一下。
			PRINTFORMW 「哎呀，真没用。」
			BASE:MASTER:体力 -= 25
			EXP:嗜虐快乐经验 += 1
		;-------------------------------------------------
		CASE 3,4,5
			;PRINTFORML 「Please don't come near me.」
			;PRINTFORMW 「I just cleaned my clothes and I'm not in the mood to rewash them.」
			;PRINTFORML 「近づかないでよ」
			;PRINTFORMW 「服洗ったばかりなんだから洗濯し直したくないの」
			PRINTFORML 「请不要靠近我。」
			PRINTFORMW 「我刚清洁好自己的衣服，现在没心情再洗一遍。」
		;-------------------------------------------------
		CASE 6,7,8,9
			;PRINTFORMDL %CALLNAME:15% looks annoyed as she notices you.
			;PRINTFORML 「%CALLNAME:MASTER%, I just cleaned this place.」
			;PRINTFORMW 「You made it all dirty again just by coming here.」
			;PRINTFORMDL %CALLNAME:15% はあなたに注意をしている。
				;annoyed:心情不快そう notices:警告、通知。注意くらいが适当か？ 08/01/2023
			;PRINTFORML 「%CALLNAME:MASTER%、ここ扫除したばかりなの」
			;PRINTFORMW 「それなのにもう灭茶苦茶にしてくれちゃって……！」
			PRINTFORMDL %CALLNAME:15%注意到你时看起来很恼火。
			PRINTFORML 「%CALLNAME:MASTER%，我才刚好好打扫过这地方。」
			PRINTFORMW 「阁下的到来让我的工夫全然白费了。」
		;-------------------------------------------------
		CASE 11,12,10,13
			;PRINTFORMW 「Ara, good timing.」
			;PRINTFORMW 「There is this dirty window I want you to lick clean.」
			;PRINTFORMW 「あら、いいところに」
			;PRINTFORMW 「ここの窓污れてるから绮丽にしときなさいよ」
			PRINTFORMW 「哎呀，来得真好。」
			PRINTFORMW 「刚好这边的窗户要人来舔干净。」
		;-------------------------------------------------
		CASE 19,18,17
			CALL K15_KNIFEATTACK_STEALTH
			;PRINTFORMW 「Ara, my apologies. I thought you were just a rat.」
			;PRINTFORMW 「あらごめんなさい。ネズミかと思っちゃった」
			PRINTFORMW 「哎呀，不好意思了，还以为是什么老鼠呢。」
			
			IF MARK:反抗刻印 == 3
				CALL K15_KNIFEATTACK_STEALTH
				CALL K15_KNIFEATTACK_STEALTH
				
				EXP:嗜虐快乐经验 += 1
			ENDIF
		;-------------------------------------------------
		CASE 20,21,22,23,24
			;hates the player or wants to punish
				;プレイヤーを嫌っているか罚したいと思っている
					;punishの上手い译わからん 08/01/2023
			IF MARK:反抗刻印 == 3 || CFLAG:掌握把柄
				CALL K15_KNIFEATTACK_STEALTH
			ENDIF
			;PRINTFORMDW %CALLNAME:15% pretends to ignore you.
			;PRINTFORMDW %CALLNAME:15% はあなた存在しないかのように振舞っている。
			PRINTFORMDW %CALLNAME:15%假装没看到你。
		;-------------------------------------------------
		CASEELSE
			;PRINTFORMDW %CALLNAME:15% glares at you.
			PRINTFORMDW %CALLNAME:15%狠狠瞪了你一眼。
	ENDSELECT
RETURN 1

;==================================================
;attack
;ARG 1 = no commentary
;==================================================
;roll attack
@K15_DO_KNIFEATTACK(ARG)
#DIM iRoll

	iRoll = 25
	iRoll += ABL:MASTER:战斗能力*3
	;sakuya is drunk
		;烂醉中
	SIF TCVAR:15:烂醉
		iRoll += 15
	;sakuya is lustful
		;发情中
	SIF K15_LUST(750)
		iRoll += 5
		
	iRoll -= ABL:战斗能力*3
	
	;15 is minimum
	SIF iRoll < 15
		iRoll = 15
	
	;roll
	iRoll = RAND:iRoll
	
	SELECTCASE iRoll
	CASE 0,1
		CALL K15_KNIFEATTACK_SPELLCARD(ARG)
	CASE 2,3,4,5,6
		CALL K15_KNIFEATTACK_HITMANY(ARG)
	CASE 7,8,9,10,11,12,13,14,15,16,17
		CALL K15_KNIFEATTACK_HIT(ARG)
	CASE 18,19,20,21,22,23,24,25
		CALL K15_KNIFEATTACK_MISS(ARG)
	CASEELSE
		CALL K15_KNIFEATTACK_DODGE(ARG)
	ENDSELECT
RETURN 1

;==================================================
;attack - fatal
;ARG 1 = no commentary
;==================================================
@K15_KNIFEATTACK_SPELLCARD(ARG)
#DIM iRoll
	
	iRoll = 12
	iRoll += ABL:MASTER:战斗能力
	iRoll -= ABL:战斗能力
	
	;sakuya is drunk
	SIF TCVAR:15:烂醉
		iRoll += 6
	;sakuya is lustful
	SIF K15_LUST(750)
		iRoll += 2
		
	;8 is minimum
	SIF iRoll < 8
		iRoll = 8

	IF !ARG
		;PRINTFORMW 「Die.」
		PRINTFORMW 「死吧。」
	ENDIF
	
	;roll
	iRoll = RAND:iRoll
		
	SELECTCASE iRoll
		CASE 0,1,2,3,4,5,6,7,8
			;PRINTFORMDW You get hit by one of %CALLNAME:15%'s spellcards, needling you with many silver knives.
			;PRINTFORMDW あなたは%CALLNAME:15%のスペルカード攻击に当たってしまった、银のナイフで串刺しになった。
			PRINTFORMDW 你没反应过来，完全着了%CALLNAME:15%符卡的道，被打个正着，身体似是被万针齐穿。
			;damage
			CALL K15_KNIFEATTACK_DODAMAGE(9999)
		CASE 9,10,11,12
			;PRINTFORMDW You get hit by one of %CALLNAME:15%'s spellcards, somehow you still managed to dodge a lot of knives.
			;PRINTFORMDW あなたは%CALLNAME:15%のスペルカード攻击に袭われた！ なんとか最小限の被弹にとどめた！
				;somehow→なんとかして, かわせることからhitは奇袭的な意味か？ 08/01/2023
			PRINTFORMDW %CALLNAME:15%对你突施符卡，霎时之间，场上银光处处。但你歪打正着，躲过了不少飞刀。
			;damage
			CALL K15_KNIFEATTACK_DODAMAGE(1300)
		CASE 13,14,15,16
			;PRINTFORMDW You get hit by one of %CALLNAME:15%'s spellcards, somehow you still managed to dodge most of the knives.
			;PRINTFORMDW あなたは%CALLNAME:15%のスペルカード攻击に袭われた！ 殆どのナイフをかわしてみせた！
			PRINTFORMDW %CALLNAME:15%对你突施符卡，霎时之间，场上银光处处。但你身法飘逸，躲过了大部分的飞刀。
			;damage
			CALL K15_KNIFEATTACK_DODAMAGE(500)
		CASEELSE
			;PRINTFORMDL You get attacked by one of %CALLNAME:15%'s spellcards, yet somehow you managed to dodge all the knives.
			;PRINTFORMW 「Tssk...」
			;PRINTFORMDW あなたは%CALLNAME:15%のスペルカード攻击に袭われた！ なんとかすべてのナイフをかわしきった！
			;PRINTFORMDW 「ﾁｯ...」
				;舌打ち？ 英语の拟音语わからぬん 08/01/2023
			PRINTFORMDW %CALLNAME:15%对你突施符卡，霎时之间，场上银光处处。但你身法飘逸、闪避得宜，躲过了全部的飞刀。
			PRINTFORMDW 「啧…」
	ENDSELECT
	
	EXP:战斗经验 += 3
RETURN 1

;==================================================
;attack - hit many
;ARG 1 = no commentary
;==================================================
@K15_KNIFEATTACK_HITMANY(ARG)
	;PRINTFORMDW You get hit by multiple of %CALLNAME:15%'s knife throws.
	;PRINTFORMDW %CALLNAME:15%の投げたナイフが数本あなたに刺さった。
		;multipleなナイフ投げ？ 08/01/2023
	PRINTFORMDW 你被数柄%CALLNAME:15%投出的银刀击中。
	
	IF !ARG
		PRINTDATAW
			;DATAFORM 「Did you learn your lesson yet?」
			;DATAFORM 「Does it hurt?」
			;DATAFORM 「いい勉强になったでしょう？」
				;「学习しないわね」程度だけど传わりづらそう 08/01/2023
			;DATAFORM 「ちゃんと痛かったかしら？」
				;痛かった？だけじゃニュアンスでないかもなので"ちゃんと"を入れておく 08/01/2023
			DATAFORM 「有受到教训了吗？」
			DATAFORM 「痛吧？」
		ENDDATA
	ENDIF
	
	;damage
	CALL K15_KNIFEATTACK_DODAMAGE(800)
	
	EXP:战斗经验 += 2
RETURN 1

;==================================================
;attack - hit
;ARG 1 = no commentary
;==================================================
@K15_KNIFEATTACK_HIT(ARG)
	;PRINTFORMDW You get hit by one of %CALLNAME:15%'s knife throws.
	;PRINTFORMDW あなたは%CALLNAME:15%の投げたナイフに袭われた！
		;one of -- とか单数形は敢えて译す必要ないよね？ 08/01/2023
		;ゆうて复数形も要らんと思う 08/01/2023
	PRINTFORMDW 你被%CALLNAME:15%投出的其中一柄银刀击中。
	
	IF !ARG
		PRINTDATAW
			;DATAFORM 「I'm sorry, I accidentally hit that one.」
			;DATAFORM 「Does it hurt?」
			;DATAFORM 「ごめんなさい、ついうっかり」
				;that one なんで丁宁な扱いしてないのはわかるが、二人称单数代名词で适当なのわからん。ボカす。 08/01/2023
			;DATAFORM 「痛かったかしら？」
				;こっちは慇懃无礼な感じだから"ちゃんと"を入れなくてもよさそう 08/01/2023
					;that one成分をこっちに"ちゃんと"を入れる事で表现できるか？ 08/01/2023
			DATAFORM 「真抱歉，那是意外。」
			DATAFORM 「痛吗？」
		ENDDATA
	ENDIF
	
	;damage
	CALL K15_KNIFEATTACK_DODAMAGE(350)
	
	EXP:战斗经验 += 1
RETURN 1

;==================================================
;attack - miss
;ARG 1 = no commentary
;==================================================
@K15_KNIFEATTACK_MISS(ARG)
	;PRINTFORMDW One of %CALLNAME:15%'s throwing knives just misses you by a tiny amount.
	;PRINTFORMDW %CALLNAME:15%の投げたナイフがあなたの鼻先を掠めた。
	PRINTFORMDW %CALLNAME:15%投出的银刀以毫釐之差掠过你的身子。
	IF !ARG
		PRINTDATAW
			;DATAFORM 「That was a warning.」
			;DATAFORM 「Ara, I missed.」
			;DATAFORM 「今のは警告よ」
			;DATAFORM 「あら、手が滑りましたわ。」
			DATAFORM 「这次是警告。」
			DATAFORM 「哎呀，失手了。」
		ENDDATA
	ENDIF
	
	EXP:战斗经验 += 1
RETURN 1

;==================================================
;attack - dodge
;==================================================
@K15_KNIFEATTACK_DODGE(ARG)
	;PRINTFORMDW You dodge her knives throws.
	PRINTFORMDW 你躲开了%CALLNAME:15%的飞刀。
	IF !ARG
		PRINTDATAW
			;DATAFORM 「Tssk.」
			;DATAFORM 「Ara, I missed.」
			;DATAFORM 「ﾁｯ」
			;DATAFORM 「あら、手が滑りましたわ。」
			DATAFORM 「啧。」
			DATAFORM 「哎呀，失手了。」
		ENDDATA
	ENDIF
	
	EXP:MASTER:战斗经验 += 1
	EXP:战斗经验 += 1
RETURN 1

;==================================================
;stealth attack
;==================================================
;roll attack
@K15_KNIFEATTACK_STEALTH
#DIM iRoll
	
	iRoll = 25
	iRoll += ABL:MASTER:战斗能力*3
	;sakuya is drunk
	SIF TCVAR:15:烂醉
		iRoll += 15
	;sakuya is lustful
	SIF K15_LUST(750)
		iRoll += 5
	
	iRoll -= ABL:战斗能力*3
	
	;15 is minimum
	SIF iRoll < 13
		iRoll = 13
	
	;roll
	iRoll = RAND:iRoll
	
	SELECTCASE iRoll
	CASE 0,1,2,3,4,5,6,7,8,9,10
		CALL K15_KNIFEATTACK_STEALTH_HIT
	CASE 12,13,14,15,16,17,18,19,20
		CALL K15_KNIFEATTACK_STEALTH_HIT_CUT
	CASEELSE
		CALL K15_KNIFEATTACK_STEALTH_DODGE
	ENDSELECT
	
RETURN 1

;==================================================
;stealth attack - hit
;==================================================
@K15_KNIFEATTACK_STEALTH_HIT
	;PRINTFORMDL You suddenly get hit by a knife thrown at you.
	;PRINTFORMDL 突如として投げられてきたナイフが刺さった！
		;ここ违和感あるんご 08/01/2023
	PRINTFORMDL 你突然被一柄飞刀击中了。
	
	;damage
	CALL K15_KNIFEATTACK_DODAMAGE(500)
	
	EXP:战斗经验 += 1
RETURN 1

;==================================================
;stealth attack - hit
;==================================================
@K15_KNIFEATTACK_STEALTH_HIT_CUT
	;PRINTFORMDL You suddenly get graced by a knife thrown at you, leaving a cut.
	;PRINTFORMDL 投げられたナイフがあなたにかすり伤を残した！
		;graced优雅なor幸运にもの译わからん、グレイス避けの事だと思うけど 08/01/2023
	PRINTFORMDL 突然一柄飞刀掠过，擦破了你的皮肤。
		;我比较怀疑是grazed
	;damage
	CALL K15_KNIFEATTACK_DODAMAGE(250)
	
	EXP:战斗经验 += 1
RETURN 1

;==================================================
;stealth attack - dodge
;==================================================
@K15_KNIFEATTACK_STEALTH_DODGE
	;PRINTFORMDW You somehow managed to dodge a knife thrown at you.
	;PRINTFORMDW あなたはなんとか飞んでくるナイフをかわしてみせた。
	PRINTFORMDW 你躲过了一柄不知从哪而来的飞刀。
	
	EXP:MASTER:战斗经验 += 1
	EXP:战斗经验 += 1
RETURN 0

;==================================================
;stealth attack - dodge
;==================================================
@K15_KNIFEATTACK_DODAMAGE(ARG)
	SIF BASE:MASTER:体力 <= 0
		RETURN 1
	
	;full damage
	IF ARG == 9999
		BASE:MASTER:体力 = 0
		BASE:MASTER:气力 = 0
	ELSE
		;damage
		BASE:MASTER:体力 -= ARG
		;SETCOLOR C_RED
		;PRINTFROMW STA {ARG}
		;RESETCOLOR
	ENDIF
	
RETURN 1